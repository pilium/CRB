"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}window.addEventListener("load",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=q?(document.body.style.paddingTop=y.offsetHeight+"px",y.classList.add("fixed-nav")):(y.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}function o(){if(k.classList.contains("starblind")){var e=_toConsumableArray(C.querySelectorAll("button")),t=C.querySelector(".blind-fontSize--low"),o=C.querySelector(".blind-fontSize--normal"),n=C.querySelector(".blind-fontSize--big"),s=document.querySelector("html"),a=window.getComputedStyle(s,null).getPropertyValue("font-size"),i=parseFloat(a);console.log(i),e.forEach(function(t){t.addEventListener("click",function(){e.filter(function(e){return t.getAttribute("data-group")==e.getAttribute("data-group")}).map(function(e){k.classList.remove(e.getAttribute("data-test"))}),t.hasAttribute("data-test")&&k.classList.add(t.getAttribute("data-test"))})}),t.onclick=function(){s.style.fontSize=i-2+"px"},o.onclick=function(){s.style.fontSize=i+"px"},n.onclick=function(){s.style.fontSize=i+6+"px"}}}var n=document.getElementById("preloader");n&&setTimeout(function(){n.classList.add("active"),document.body.style.overflow="visible"},100);var s=document.querySelector(".js-hero-slider"),a=document.querySelector(".blog-slider"),i=document.querySelector(".news-slider"),r=document.getElementById("map"),l=document.querySelector(".js-header-info__writeToUs-link"),c=document.querySelector(".modal"),d=c.querySelector(".modal-close__btn"),u=c.querySelector("[name=login]"),m=document.querySelector(".wrapper-menu"),f=document.querySelector(".js-sidenav"),g=document.querySelector(".sidenav-overlay"),p=document.getElementsByClassName("acc-header"),w=document.querySelector(".testimonials-slider"),v=document.querySelector(".gallery"),y=document.querySelector("#nav-main");if(function(){var e=document.querySelector(".modal-overlay");l.addEventListener("click",function(t){t.preventDefault(),c.classList.toggle("modal-show"),e.classList.toggle("show"),u.focus()}),d.addEventListener("click",function(t){t.preventDefault(),c.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(c.classList.remove("modal-show"),e.classList.toggle("show"))})}(),s){new Swiper(".swiper-container",{loop:!0,parallax:!0,autoplay:{delay:5e3},speed:1e3,mousewheelControl:!0})}if(a){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(i){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"3",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1230:{slidesPerView:3},900:{slidesPerView:2},650:{slidesPerView:1,spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(w){new Swiper(w,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}if(r){var L=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(L)}setTimeout(e,100),m&&m.addEventListener("click",function(){m.classList.toggle("open"),f.classList.toggle("show"),g.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(m.classList.toggle("open"),f.classList.toggle("show"),g.classList.toggle("show"))});for(var b=0;b<p.length;b++)p[b].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),v&&baguetteBox.run(".gallery-wrap",{async:!0});for(var S=document.querySelectorAll("form"),h=0;h<S.length;h++)!function(e){S[e].onsubmit=function(t){t.preventDefault(),S[e].classList.add("signed")}}(h);var q=y.offsetTop;window.addEventListener("scroll",t);for(var E=document.querySelectorAll(".fixed-width"),A=0;A<E.length;A++)!function(e){E[e].addEventListener("keyup",function(t){if(13===t.keyCode){var o=E[e].querySelector(".menu");E[e].classList.toggle("fixed-width--show"),o.addEventListener("blur",function(){o.style.display="none"})}})}(A);var _=document.querySelector(".js-starblind-trigger"),k=document.querySelector(".main-wrapper"),T=document.querySelectorAll(".js-sliderNews--blind"),x=document.querySelector(".js-blindTestimonials"),j=document.querySelector(".js-organizationBlind"),C=document.querySelector(".js-blindHeaderPanel");_.addEventListener("click",function(){if(localStorage.setItem("blind","active"),C.classList.toggle("blindHeaderPanel--show"),k.classList.toggle("starblind"),x&&x.classList.toggle("cd-testimonials__blind--show"),T)for(var e=0;e<T.length;e++)T[e].classList.toggle("blindSliderNews--show");j&&j.classList.toggle("organizations-main__wrapper--blind"),o()})}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>i?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>r&&n(a,"cd-top--fade-out"),l=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,i=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,i),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],i=300,r=1200,l=!1;a&&(window.addEventListener("scroll",function(t){l||(l=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImFkZFRpbWVGb290ZXIiLCJkYXRlIiwiRGF0ZSIsIm9wdGlvbnMiLCJ5ZWFyIiwibW9udGgiLCJkYXkiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJ0b0xvY2FsZVN0cmluZyIsImZpeE5hdiIsInNjcm9sbFkiLCJ0b3BPZk5hdiIsImJvZHkiLCJzdHlsZSIsInBhZGRpbmdUb3AiLCJuYXYiLCJvZmZzZXRIZWlnaHQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJ0ZXN0IiwiY29udGFpbnMiLCJidXR0b25zIiwiYmxpbmRQYW5lbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25Mb3dGb250U2l6ZSIsImJ1dHRvbk5vcm1hbEZvbnRTaXplIiwiYnV0dG9uQmlnRm9udFNpemUiLCJodG1sRWxlbSIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiZGVmYXVsdEZvbnRTaXplIiwicGFyc2VGbG9hdCIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwiYnV0dG9uIiwiZmlsdGVyIiwib2JqIiwiZ2V0QXR0cmlidXRlIiwibWFwIiwiaGFzQXR0cmlidXRlIiwib25jbGljayIsImZvbnRTaXplIiwicHJlbG9hZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZXRUaW1lb3V0Iiwib3ZlcmZsb3ciLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ3cmFwcGVyTWVudSIsInNpZGVuYXYiLCJvdmVybGF5IiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRlc3RpbW9uaWFsc1NsaWRlciIsImdhbGxlcnkiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwiZm9jdXMiLCJlIiwidGFyZ2V0IiwiU3dpcGVyIiwibG9vcCIsInBhcmFsbGF4IiwiYXV0b3BsYXkiLCJkZWxheSIsInNwZWVkIiwibW91c2V3aGVlbENvbnRyb2wiLCJzcGFjZUJldHdlZW4iLCJlZmZlY3QiLCJncmFiQ3Vyc29yIiwicGFnaW5hdGlvbiIsImVsIiwiY2xpY2thYmxlIiwiY2VudGVyZWRTbGlkZXMiLCJrZXlib2FyZCIsInNsaWRlc1BlclZpZXciLCJjb3ZlcmZsb3dFZmZlY3QiLCJyb3RhdGUiLCJzdHJldGNoIiwiZGVwdGgiLCJtb2RpZmllciIsInNsaWRlU2hhZG93cyIsImJyZWFrcG9pbnRzIiwiMTIzMCIsIjkwMCIsIjY1MCIsInNpbXVsYXRlVG91Y2giLCJuYXZpZ2F0aW9uIiwibmV4dEVsIiwicHJldkVsIiwiYXV0b0hlaWdodCIsImluaXQiLCJteU1hcCIsInltYXBzIiwiTWFwIiwiY2VudGVyIiwiY29udHJvbHMiLCJ6b29tIiwiZ2V0Iiwicm91dGVQYW5lbCIsInN0YXRlIiwic2V0IiwibXlQbGFjZW1hcmsiLCJQbGFjZW1hcmsiLCJoaW50Q29udGVudCIsImJhbGxvb25Db250ZW50IiwicHJlc2V0IiwiZ2VvT2JqZWN0cyIsInJlYWR5IiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsInBlb3BsZUNhcmQiLCJfaSIsImNhcmQiLCJwYXJlbnROb2RlIiwiaWNvbiIsImJhZ3VldHRlQm94IiwicnVuIiwiYXN5bmMiLCJmb3JtcyIsIl9pMiIsIm9uc3VibWl0Iiwib2Zmc2V0VG9wIiwiZHJvcGRvd25JdGVtcyIsIl9pMyIsImtleUNvZGUiLCJzdWJNZW51IiwiZGlzcGxheSIsImJsaW5kdHJpZ2dlciIsInNsaWRlck5ld3NCbGluZCIsInRlc3RpbW9uYWxzQmxpbmQiLCJvcmdhbml6YXRpb25CbGluZCIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJfaTQiLCJjaGVja0JhY2tUb1RvcCIsIndpbmRvd1RvcCIsImRvY3VtZW50RWxlbWVudCIsInNjcm9sbFRvcCIsIm9mZnNldCIsImFkZENsYXNzIiwiYmFja1RvcCIsInJlbW92ZUNsYXNzIiwib2Zmc2V0T3BhY2l0eSIsInNjcm9sbGluZyIsImR1cmF0aW9uIiwic3RhcnQiLCJjdXJyZW50VGltZSIsImFuaW1hdGVTY3JvbGwiLCJ0aW1lc3RhbXAiLCJwcm9ncmVzcyIsInZhbCIsIk1hdGgiLCJtYXgiLCJlYXNlSW5PdXRRdWFkIiwic2Nyb2xsVG8iLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJoYXNDbGFzcyIsImNsYXNzTmFtZSIsIm1hdGNoIiwiUmVnRXhwIiwiY29uY2F0Iiwic3BsaXQiLCJzbGljZSIsImpvaW4iLCJyZWciLCJyZXBsYWNlIiwidCIsImIiLCJjIiwiZCJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxTQUFBQSxvQkFBQUMsR0FBQSxNQUFBQyxvQkFBQUQsSUFBQUUsaUJBQUFGLElBQUFHLHFCQUVBLFFBQUFBLHNCQUFBLEtBQUEsSUFBQUMsV0FBQSxtREFFQSxRQUFBRixrQkFBQUcsR0FBQSxHQUFBQyxPQUFBQyxXQUFBQyxRQUFBSCxJQUFBLHVCQUFBRyxPQUFBQyxVQUFBQyxTQUFBQyxLQUFBTixHQUFBLE1BQUFPLE9BQUFDLEtBQUFSLEdBRUEsUUFBQUosb0JBQUFELEdBQUEsR0FBQVksTUFBQUUsUUFBQWQsR0FBQSxDQUFBLElBQUEsR0FBQWUsR0FBQSxFQUFBQyxFQUFBLEdBQUFKLE9BQUFaLEVBQUFpQixRQUFBRixFQUFBZixFQUFBaUIsT0FBQUYsSUFBQUMsRUFBQUQsR0FBQWYsRUFBQWUsRUFBQSxPQUFBQyxJQUVBRSxPQUFBQyxpQkFBQSxPQUFB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VUFBQUUsT0FBQUYsRUFBQSxRQUFBLElBQUFxSixFQUFBdEYsRUFBQS9ELEVBQUEsSUFBQSxDQUNBLEdBQUE2SixHQUFBLEdBQUFMLFFBQUEsVUFBQUMsT0FBQXpKLEVBQUEsR0FBQSxXQUNBK0QsR0FBQXVGLFVBQUF2RixFQUFBdUYsVUFBQVEsUUFBQUQsRUFBQSxLQUVBN0osRUFBQXRCLE9BQUEsR0FBQTRKLEVBQUF2RSxFQUFBL0QsRUFBQTJKLE1BQUEsR0FBQUMsS0FBQSxNQXJFQSxHQUFBdkIsR0FBQWpKLFNBQUF1RCx1QkFBQSxhQUFBLEdBQ0F3RixFQUFBLElBQ0FJLEVBQUEsS0FFQUMsR0FBQSxDQUVBSCxLQUNBMUosT0FBQUMsaUJBQUEsU0FBQSxTQUFBa0UsR0FDQTBGLElBQ0FBLEdBQUEsRUFDQTdKLE9BQUF5SyxzQkFBQXpLLE9BQUF5SyxzQkFBQXJCLEdBQUFsRyxXQUFBa0csRUFBQSxRQUlBTSxFQUFBekosaUJBQUEsUUFBQSxTQUFBa0UsR0FDQUEsRUFBQUMsaUJBQ0FwRSxPQUFBeUssc0JBQUFsQixFQWJBLEtBYUF2SixPQUFBd0ssU0FBQSxFQUFBLE1BNkJBSCxLQUFBRSxjQUFBLFNBQUFhLEVBQUFDLEVBQUFDLEVBQUFDLEdBRUEsT0FEQUgsR0FBQUcsRUFBQSxHQUNBLEVBQUFELEVBQUEsRUFBQUYsRUFBQUEsRUFBQUMsR0FDQUQsS0FDQUUsRUFBQSxHQUFBRixHQUFBQSxFQUFBLEdBQUEsR0FBQUMiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikgeyByZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpOyB9XG5cbmZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlXCIpOyB9XG5cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikgeyBpZiAoU3ltYm9sLml0ZXJhdG9yIGluIE9iamVjdChpdGVyKSB8fCBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlcikgPT09IFwiW29iamVjdCBBcmd1bWVudHNdXCIpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpOyB9XG5cbmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHsgaWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgeyBmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShhcnIubGVuZ3RoKTsgaSA8IGFyci5sZW5ndGg7IGkrKykgeyBhcnIyW2ldID0gYXJyW2ldOyB9IHJldHVybiBhcnIyOyB9IH1cblxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gIC8vIHByZWxvYWRlclxuICB2YXIgcHJlbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZWxvYWRlcicpO1xuXG4gIGlmIChwcmVsb2FkZXIpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHByZWxvYWRlci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAndmlzaWJsZSc7XG4gICAgfSwgMTAwKTtcbiAgfSAvLyBFTkQgUHJlbG9hZGVyXG5cblxuICB2YXIgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWhlcm8tc2xpZGVyJyk7XG4gIHZhciBibG9nU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2ctc2xpZGVyJyk7XG4gIHZhciBuZXdzU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ld3Mtc2xpZGVyJyk7XG4gIHZhciBtYXBDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XG4gIHZhciBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWhlYWRlci1pbmZvX193cml0ZVRvVXMtbGluaycpO1xuICB2YXIgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgdmFyIGNsb3NlID0gcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsLWNsb3NlX19idG4nKTtcbiAgdmFyIGxvZ2luID0gcG9wdXAucXVlcnlTZWxlY3RvcignW25hbWU9bG9naW5dJyk7XG4gIHZhciB3cmFwcGVyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53cmFwcGVyLW1lbnUnKTtcbiAgdmFyIHNpZGVuYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc2lkZW5hdicpO1xuICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlbmF2LW92ZXJsYXknKTtcbiAgdmFyIGFjYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FjYy1oZWFkZXInKTtcbiAgdmFyIHRlc3RpbW9uaWFsc1NsaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZXN0aW1vbmlhbHMtc2xpZGVyJyk7XG4gIHZhciBnYWxsZXJ5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbGxlcnknKTtcbiAgdmFyIG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuYXYtbWFpbicpOyAvLyBNb2RhbFxuXG4gIHZhciBtb2RhbCA9IGZ1bmN0aW9uIG1vZGFsKCkge1xuICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLW92ZXJsYXknKTtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnRvZ2dsZSgnbW9kYWwtc2hvdycpO1xuICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBsb2dpbi5mb2N1cygpO1xuICAgIH0pO1xuICAgIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWwtb3ZlcmxheScpKSB7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsLXNob3cnKTtcbiAgICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgbW9kYWwoKTsgLy8gRU5EIE1vZGFsXG4gIC8vIFNsaWRlcnNcblxuICBpZiAoc2xpZGVyQ29udGFpbmVyKSB7XG4gICAgdmFyIG15U3dpcGVyID0gbmV3IFN3aXBlcignLnN3aXBlci1jb250YWluZXInLCB7XG4gICAgICBsb29wOiB0cnVlLFxuICAgICAgcGFyYWxsYXg6IHRydWUsXG4gICAgICBhdXRvcGxheToge1xuICAgICAgICBkZWxheTogNTAwMFxuICAgICAgfSxcbiAgICAgIHNwZWVkOiAxMDAwLFxuICAgICAgbW91c2V3aGVlbENvbnRyb2w6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChibG9nU2xpZGVyKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5ibG9nLXNsaWRlcicsIHtcbiAgICAgIHNwYWNlQmV0d2VlbjogMzAsXG4gICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgYXV0b3BsYXk6IHtcbiAgICAgICAgZGVsYXk6IDcwMDBcbiAgICAgIH0sXG4gICAgICAvLyBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5ibG9nLXNsaWRlcl9fcGFnaW5hdGlvbicsXG4gICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG5ld3NTbGlkZXIpIHtcbiAgICB2YXIgbmV3c1N3aXBlciA9IG5ldyBTd2lwZXIoJy5uZXdzLXNsaWRlcicsIHtcbiAgICAgIGVmZmVjdDogJ2NvdmVyZmxvdycsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgbG9vcDogZmFsc2UsXG4gICAgICBjZW50ZXJlZFNsaWRlczogZmFsc2UsXG4gICAgICBrZXlib2FyZDogdHJ1ZSxcbiAgICAgIHNwYWNlQmV0d2VlbjogMTAsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnMycsXG4gICAgICBzcGVlZDogMzAwLFxuICAgICAgY292ZXJmbG93RWZmZWN0OiB7XG4gICAgICAgIHJvdGF0ZTogMCxcbiAgICAgICAgc3RyZXRjaDogMCxcbiAgICAgICAgZGVwdGg6IDAsXG4gICAgICAgIG1vZGlmaWVyOiAxLFxuICAgICAgICBzbGlkZVNoYWRvd3M6IGZhbHNlXG4gICAgICB9LFxuICAgICAgYnJlYWtwb2ludHM6IHtcbiAgICAgICAgMTIzMDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDNcbiAgICAgICAgfSxcbiAgICAgICAgOTAwOiB7XG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogMlxuICAgICAgICB9LFxuICAgICAgICA2NTA6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgICAgICAgIHNwYWNlQmV0d2VlbjogMCxcbiAgICAgICAgICBjZW50ZXJlZFNsaWRlczogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2ltdWxhdGVUb3VjaDogdHJ1ZSxcbiAgICAgIG5hdmlnYXRpb246IHtcbiAgICAgICAgbmV4dEVsOiAnLm5ld3Mtc2xpZGVyLW5leHQnLFxuICAgICAgICBwcmV2RWw6ICcubmV3cy1zbGlkZXItcHJldidcbiAgICAgIH0sXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLm5ld3Mtc2xpZGVyX19wYWdpbmF0aW9uJyxcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpZiAodGVzdGltb25pYWxzU2xpZGVyKSB7XG4gICAgdmFyIGZlZWRTd2lwZXIgPSBuZXcgU3dpcGVyKHRlc3RpbW9uaWFsc1NsaWRlciwge1xuICAgICAgYXV0b0hlaWdodDogdHJ1ZSxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgIG5leHRFbDogJy5zd2lwZXItYnV0dG9uLW5leHQnLFxuICAgICAgICBwcmV2RWw6ICcuc3dpcGVyLWJ1dHRvbi1wcmV2J1xuICAgICAgfVxuICAgIH0pO1xuICB9IC8vIEVORCBTbGlkZXJzXG4gIC8vIE1hcFxuXG5cbiAgaWYgKG1hcENvbnRhaW5lcikge1xuICAgIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbNDcuNTM5NiwgNDIuMDE1MV0sXG4gICAgICAgIGNvbnRyb2xzOiBbJ3R5cGVTZWxlY3RvcicsICdmdWxsc2NyZWVuQ29udHJvbCcsICdnZW9sb2NhdGlvbkNvbnRyb2wnLCAncnVsZXJDb250cm9sJywgJ3JvdXRlQnV0dG9uQ29udHJvbCddLFxuICAgICAgICB6b29tOiAxNlxuICAgICAgfSk7XG4gICAgICB2YXIgY29udHJvbCA9IG15TWFwLmNvbnRyb2xzLmdldCgncm91dGVCdXR0b25Db250cm9sJyk7XG4gICAgICBjb250cm9sLnJvdXRlUGFuZWwuc3RhdGUuc2V0KCdmcm9tJywgJ9Cg0L7QvNCw0L3QvtCy0YHQutCw0Y8g0YHQvtGO0LfQvdGL0LkgOTfQsCcpO1xuICAgICAgdmFyIG15UGxhY2VtYXJrID0gbmV3IHltYXBzLlBsYWNlbWFyayhbNDcuNTM5OCwgNDIuMDE1M10sIHtcbiAgICAgICAgaGludENvbnRlbnQ6ICfQo9C7LiDQodC+0Y7Qt9C90LDRjyA5N9CwJyxcbiAgICAgICAgYmFsbG9vbkNvbnRlbnQ6ICfQn9C+0LvQuNC60LvQuNC90LjQutCwJ1xuICAgICAgfSwge1xuICAgICAgICBwcmVzZXQ6ICdpc2xhbmRzI2JsdWVNZWRpY2FsSWNvbidcbiAgICAgIH0pO1xuICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmspO1xuICAgIH07XG5cbiAgICB5bWFwcy5yZWFkeShpbml0KTtcbiAgfSAvLyBFTkQgTWFwXG4gIC8vIFRpbWUgdG8gZm9vdGVyXG5cblxuICBmdW5jdGlvbiBhZGRUaW1lRm9vdGVyKCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIG1vbnRoOiAnbG9uZycsXG4gICAgICBkYXk6ICdudW1lcmljJ1xuICAgIH07XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1mb290ZXItaW5mb19fZGF0ZScpO1xuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBkYXRlLnRvTG9jYWxlU3RyaW5nKCdydScsIG9wdGlvbnMpO1xuICB9XG5cbiAgc2V0VGltZW91dChhZGRUaW1lRm9vdGVyLCAxMDApOyAvLyBFTkQgVGltZSB0byBmb290ZXJcbiAgLy8gU2lkZW1lbnVcblxuICBpZiAod3JhcHBlck1lbnUpIHdyYXBwZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIHdyYXBwZXJNZW51LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTtcbiAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaWRlbmF2LW92ZXJsYXknKSkge1xuICAgICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgICAgc2lkZW5hdi5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9XG4gIH0pOyAvLyBFTkQgU2lkZW1lbnVcbiAgLy8gYWNjb3JkaW9uXG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY2MubGVuZ3RoOyBpKyspIHtcbiAgICBhY2NbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgLyogVG9nZ2xlIGJldHdlZW4gYWRkaW5nIGFuZCByZW1vdmluZyB0aGUgXCJhY3RpdmVcIiBjbGFzcyxcbiAgICAgIHRvIGhpZ2hsaWdodCB0aGUgYnV0dG9uIHRoYXQgY29udHJvbHMgdGhlIHBhbmVsICovXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgICAgLyogVG9nZ2xlIGJldHdlZW4gaGlkaW5nIGFuZCBzaG93aW5nIHRoZSBhY3RpdmUgcGFuZWwgKi9cblxuICAgICAgdmFyIHBhbmVsID0gdGhpcy5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICBwYW5lbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgICB9KTtcbiAgfSAvLyBFTkQgQWNjb3JkaW9uXG4gIC8vIHBlb3BsZUNhcmRcblxuXG4gIGZ1bmN0aW9uIHBlb3BsZUNhcmQoKSB7XG4gICAgdmFyIHBlb3BsZUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWF0ZXJpYWwtY2FyZCA+IC5tYy1idG4tYWN0aW9uJyk7XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcGVvcGxlQ2FyZC5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHBlb3BsZUNhcmRbX2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2FyZCA9IHRoaXMucGFyZW50Tm9kZTtcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ2knKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1zcGluLWZhc3QnKTtcblxuICAgICAgICBpZiAoY2FyZC5jbGFzc0xpc3QuY29udGFpbnMoJ21jLWFjdGl2ZScpKSB7XG4gICAgICAgICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKCdtYy1hY3RpdmUnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtYXJyb3ctbGVmdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1zcGluLWZhc3QnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtYmFycycpO1xuICAgICAgICAgIH0sIDgwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCdtYy1hY3RpdmUnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtYmFycycpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1zcGluLWZhc3QnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtYXJyb3ctbGVmdCcpO1xuICAgICAgICAgIH0sIDgwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHBlb3BsZUNhcmQoKTsgLy8gRU5EIFBlb3BsZUNhcmRcbiAgLy8gR2FsbGVyeVxuXG4gIGlmIChnYWxsZXJ5KSB7XG4gICAgYmFndWV0dGVCb3gucnVuKCcuZ2FsbGVyeS13cmFwJywge1xuICAgICAgYXN5bmM6IHRydWVcbiAgICB9KTtcbiAgfSAvLyBFTkQgR2FsbGVyeVxuICAvLyBGb3JtU3VibWl0XG5cblxuICB2YXIgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdmb3JtJyk7XG5cbiAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoX2kyKSB7XG4gICAgZm9ybXNbX2kyXS5vbnN1Ym1pdCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgZm9ybXNbX2kyXS5jbGFzc0xpc3QuYWRkKCdzaWduZWQnKTtcbiAgICB9O1xuICB9O1xuXG4gIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGZvcm1zLmxlbmd0aDsgX2kyKyspIHtcbiAgICBfbG9vcChfaTIpO1xuICB9IC8vIEVORCBGb3JtU3VibWl0XG4gIC8vIEZpeGVkTmF2XG5cblxuICB2YXIgdG9wT2ZOYXYgPSBuYXYub2Zmc2V0VG9wO1xuXG4gIGZ1bmN0aW9uIGZpeE5hdigpIHtcbiAgICBpZiAod2luZG93LnNjcm9sbFkgPj0gdG9wT2ZOYXYpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IG5hdi5vZmZzZXRIZWlnaHQgKyAncHgnO1xuICAgICAgbmF2LmNsYXNzTGlzdC5hZGQoJ2ZpeGVkLW5hdicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuYXYuY2xhc3NMaXN0LnJlbW92ZSgnZml4ZWQtbmF2Jyk7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmdUb3AgPSAwO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmaXhOYXYpOyAvLyBFTkQgRml4ZWROYXZcbiAgLy8gTWVudSBkcm9wZG93blxuXG4gIHZhciBkcm9wZG93bkl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZpeGVkLXdpZHRoJyk7XG5cbiAgdmFyIF9sb29wMiA9IGZ1bmN0aW9uIF9sb29wMihfaTMpIHtcbiAgICBkcm9wZG93bkl0ZW1zW19pM10uYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xuICAgICAgICB2YXIgc3ViTWVudSA9IGRyb3Bkb3duSXRlbXNbX2kzXS5xdWVyeVNlbGVjdG9yKCcubWVudScpO1xuXG4gICAgICAgIGRyb3Bkb3duSXRlbXNbX2kzXS5jbGFzc0xpc3QudG9nZ2xlKCdmaXhlZC13aWR0aC0tc2hvdycpO1xuXG4gICAgICAgIHN1Yk1lbnUuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBzdWJNZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIGZvciAodmFyIF9pMyA9IDA7IF9pMyA8IGRyb3Bkb3duSXRlbXMubGVuZ3RoOyBfaTMrKykge1xuICAgIF9sb29wMihfaTMpO1xuICB9IC8vIEVORCBNZW51IGRyb3Bkb3duXG4gIC8vIEJsaW5kXG5cblxuICB2YXIgYmxpbmR0cmlnZ2VyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLXN0YXJibGluZC10cmlnZ2VyJyk7XG4gIHZhciBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4td3JhcHBlcicpO1xuICB2YXIgc2xpZGVyTmV3c0JsaW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmpzLXNsaWRlck5ld3MtLWJsaW5kJyk7XG4gIHZhciB0ZXN0aW1vbmFsc0JsaW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWJsaW5kVGVzdGltb25pYWxzJyk7XG4gIHZhciBvcmdhbml6YXRpb25CbGluZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1vcmdhbml6YXRpb25CbGluZCcpO1xuICB2YXIgYmxpbmRQYW5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1ibGluZEhlYWRlclBhbmVsJyk7XG4gIGJsaW5kdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmxpbmQnLCAnYWN0aXZlJyk7XG4gICAgYmxpbmRQYW5lbC5jbGFzc0xpc3QudG9nZ2xlKCdibGluZEhlYWRlclBhbmVsLS1zaG93Jyk7XG4gICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdzdGFyYmxpbmQnKTtcblxuICAgIGlmICh0ZXN0aW1vbmFsc0JsaW5kKSB7XG4gICAgICB0ZXN0aW1vbmFsc0JsaW5kLmNsYXNzTGlzdC50b2dnbGUoJ2NkLXRlc3RpbW9uaWFsc19fYmxpbmQtLXNob3cnKTtcbiAgICB9XG5cbiAgICBpZiAoc2xpZGVyTmV3c0JsaW5kKSB7XG4gICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCBzbGlkZXJOZXdzQmxpbmQubGVuZ3RoOyBfaTQrKykge1xuICAgICAgICBzbGlkZXJOZXdzQmxpbmRbX2k0XS5jbGFzc0xpc3QudG9nZ2xlKCdibGluZFNsaWRlck5ld3MtLXNob3cnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob3JnYW5pemF0aW9uQmxpbmQpIHtcbiAgICAgIG9yZ2FuaXphdGlvbkJsaW5kLmNsYXNzTGlzdC50b2dnbGUoJ29yZ2FuaXphdGlvbnMtbWFpbl9fd3JhcHBlci0tYmxpbmQnKTtcbiAgICB9XG5cbiAgICB0ZXN0KCk7XG4gIH0pO1xuXG4gIGZ1bmN0aW9uIHRlc3QoKSB7XG4gICAgaWYgKGJvZHkuY2xhc3NMaXN0LmNvbnRhaW5zKCdzdGFyYmxpbmQnKSkge1xuICAgICAgdmFyIGJ1dHRvbnMgPSBfdG9Db25zdW1hYmxlQXJyYXkoYmxpbmRQYW5lbC5xdWVyeVNlbGVjdG9yQWxsKCdidXR0b24nKSk7XG5cbiAgICAgIHZhciBidXR0b25Mb3dGb250U2l6ZSA9IGJsaW5kUGFuZWwucXVlcnlTZWxlY3RvcignLmJsaW5kLWZvbnRTaXplLS1sb3cnKTtcbiAgICAgIHZhciBidXR0b25Ob3JtYWxGb250U2l6ZSA9IGJsaW5kUGFuZWwucXVlcnlTZWxlY3RvcignLmJsaW5kLWZvbnRTaXplLS1ub3JtYWwnKTtcbiAgICAgIHZhciBidXR0b25CaWdGb250U2l6ZSA9IGJsaW5kUGFuZWwucXVlcnlTZWxlY3RvcignLmJsaW5kLWZvbnRTaXplLS1iaWcnKTtcbiAgICAgIHZhciBodG1sRWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKTtcbiAgICAgIHZhciBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGh0bWxFbGVtLCBudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKCdmb250LXNpemUnKTtcbiAgICAgIHZhciBkZWZhdWx0Rm9udFNpemUgPSBwYXJzZUZsb2F0KHN0eWxlKTsgLy8gbm93IHlvdSBoYXZlIGEgcHJvcGVyIGZsb2F0IGZvciB0aGUgZm9udCBzaXplICh5ZXMsIGl0IGNhbiBiZSBhIGZsb2F0LCBub3QganVzdCBhbiBpbnRlZ2VyKVxuICAgICAgLy8gaHRtbEVsZW0uc3R5bGUuZm9udFNpemUgPSAoZGVmYXVsdEZvbnRTaXplICsgMTApICsgJ3B4JztcblxuICAgICAgY29uc29sZS5sb2coZGVmYXVsdEZvbnRTaXplKTtcbiAgICAgIGJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBidXR0b25zLmZpbHRlcihmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gYnV0dG9uLmdldEF0dHJpYnV0ZSgnZGF0YS1ncm91cCcpID09IG9iai5nZXRBdHRyaWJ1dGUoJ2RhdGEtZ3JvdXAnKTtcbiAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgYm9keS5jbGFzc0xpc3QucmVtb3ZlKG9iai5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGVzdCcpKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGlmIChidXR0b24uaGFzQXR0cmlidXRlKCdkYXRhLXRlc3QnKSkge1xuICAgICAgICAgICAgYm9keS5jbGFzc0xpc3QuYWRkKGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtdGVzdCcpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGJ1dHRvbkxvd0ZvbnRTaXplLm9uY2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGh0bWxFbGVtLnN0eWxlLmZvbnRTaXplID0gZGVmYXVsdEZvbnRTaXplIC0gMiArICdweCc7XG4gICAgICB9O1xuXG4gICAgICBidXR0b25Ob3JtYWxGb250U2l6ZS5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBodG1sRWxlbS5zdHlsZS5mb250U2l6ZSA9IGRlZmF1bHRGb250U2l6ZSArICdweCc7XG4gICAgICB9O1xuXG4gICAgICBidXR0b25CaWdGb250U2l6ZS5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBodG1sRWxlbS5zdHlsZS5mb250U2l6ZSA9IGRlZmF1bHRGb250U2l6ZSArIDYgKyAncHgnO1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn0pO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgYmFja1RvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2pzLWNkLXRvcCcpWzBdO1xuICB2YXIgb2Zmc2V0ID0gMzAwO1xuICB2YXIgb2Zmc2V0T3BhY2l0eSA9IDEyMDA7XG4gIHZhciBzY3JvbGxEdXJhdGlvbiA9IDcwMDtcbiAgdmFyIHNjcm9sbGluZyA9IGZhbHNlO1xuXG4gIGlmIChiYWNrVG9wKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKCFzY3JvbGxpbmcpIHtcbiAgICAgICAgc2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyBzZXRUaW1lb3V0KGNoZWNrQmFja1RvVG9wLCAyNTApIDogd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjaGVja0JhY2tUb1RvcCk7XG4gICAgICB9XG4gICAgfSk7IC8vc21vb3RoIHNjcm9sbCB0byB0b3BcblxuICAgIGJhY2tUb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IHdpbmRvdy5zY3JvbGxUbygwLCAwKSA6IHNjcm9sbFRvcChzY3JvbGxEdXJhdGlvbik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0JhY2tUb1RvcCgpIHtcbiAgICB2YXIgd2luZG93VG9wID0gd2luZG93LnNjcm9sbFkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXQgPyBhZGRDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JykgOiByZW1vdmVDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JywgJ2NkLXRvcC0tZmFkZS1vdXQnKTtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXRPcGFjaXR5ICYmIGFkZENsYXNzKGJhY2tUb3AsICdjZC10b3AtLWZhZGUtb3V0Jyk7XG4gICAgc2Nyb2xsaW5nID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxUb3AoZHVyYXRpb24pIHtcbiAgICB2YXIgc3RhcnQgPSB3aW5kb3cuc2Nyb2xsWSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIHZhciBjdXJyZW50VGltZSA9IG51bGw7XG5cbiAgICB2YXIgYW5pbWF0ZVNjcm9sbCA9IGZ1bmN0aW9uIGFuaW1hdGVTY3JvbGwodGltZXN0YW1wKSB7XG4gICAgICBpZiAoIWN1cnJlbnRUaW1lKSBjdXJyZW50VGltZSA9IHRpbWVzdGFtcDtcbiAgICAgIHZhciBwcm9ncmVzcyA9IHRpbWVzdGFtcCAtIGN1cnJlbnRUaW1lO1xuICAgICAgdmFyIHZhbCA9IE1hdGgubWF4KE1hdGguZWFzZUluT3V0UXVhZChwcm9ncmVzcywgc3RhcnQsIC1zdGFydCwgZHVyYXRpb24pLCAwKTtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCB2YWwpO1xuXG4gICAgICBpZiAocHJvZ3Jlc3MgPCBkdXJhdGlvbikge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICB9XG5cbiAgTWF0aC5lYXNlSW5PdXRRdWFkID0gZnVuY3Rpb24gKHQsIGIsIGMsIGQpIHtcbiAgICB0IC89IGQgLyAyO1xuICAgIGlmICh0IDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKyBiO1xuICAgIHQtLTtcbiAgICByZXR1cm4gLWMgLyAyICogKHQgKiAodCAtIDIpIC0gMSkgKyBiO1xuICB9OyAvL2NsYXNzIG1hbmlwdWxhdGlvbnMgLSBuZWVkZWQgaWYgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWRcblxuXG4gIGZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSk7ZWxzZSByZXR1cm4gISFlbC5jbGFzc05hbWUubWF0Y2gobmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc05hbWUsIFwiKFxcXFxzfCQpXCIpKSk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgdmFyIGNsYXNzTGlzdCA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIGVsLmNsYXNzTGlzdC5hZGQoY2xhc3NMaXN0WzBdKTtlbHNlIGlmICghaGFzQ2xhc3MoZWwsIGNsYXNzTGlzdFswXSkpIGVsLmNsYXNzTmFtZSArPSBcIiBcIi5jb25jYXQoY2xhc3NMaXN0WzBdKTtcbiAgICBpZiAoY2xhc3NMaXN0Lmxlbmd0aCA+IDEpIGFkZENsYXNzKGVsLCBjbGFzc0xpc3Quc2xpY2UoMSkuam9pbignICcpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICB2YXIgY2xhc3NMaXN0ID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgZWwuY2xhc3NMaXN0LnJlbW92ZShjbGFzc0xpc3RbMF0pO2Vsc2UgaWYgKGhhc0NsYXNzKGVsLCBjbGFzc0xpc3RbMF0pKSB7XG4gICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc0xpc3RbMF0sIFwiKFxcXFxzfCQpXCIpKTtcbiAgICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKHJlZywgJyAnKTtcbiAgICB9XG4gICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPiAxKSByZW1vdmVDbGFzcyhlbCwgY2xhc3NMaXN0LnNsaWNlKDEpLmpvaW4oJyAnKSk7XG4gIH1cbn0pKCk7Il19
