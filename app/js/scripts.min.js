"use strict";window.addEventListener("load",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=b?(document.body.style.paddingTop=y.offsetHeight+"px",y.classList.add("fixed-nav")):(y.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}function o(){var e=document.documentElement.clientHeight-50;console.log(e),function t(){window.pageYOffset<e&&(window.scrollBy(0,10),setTimeout(t,0)),window.pageYOffset>e&&window.scrollTo(0,e)}()}var n=document.getElementById("preloader");n&&setTimeout(function(){n.classList.add("active"),document.body.style.overflow="visible"},1e3);var s=document.querySelector(".js-hero-slider"),a=document.querySelector(".blog-slider"),i=document.querySelector(".news-slider"),l=document.getElementById("map"),r=document.querySelector(".js-header-info__writeToUs-link"),c=document.querySelector(".modal"),d=c.querySelector(".modal-close__btn"),u=c.querySelector("[name=login]"),m=document.querySelector(".wrapper-menu"),f=document.querySelector(".js-sidenav"),w=document.querySelector(".sidenav-overlay"),v=document.getElementsByClassName("acc-header"),p=document.querySelector(".testimonials-slider"),g=document.querySelector(".gallery"),y=document.querySelector("#nav-main");if(function(){var e=document.querySelector(".modal-overlay");r.addEventListener("click",function(t){t.preventDefault(),c.classList.toggle("modal-show"),e.classList.toggle("show"),u.focus()}),d.addEventListener("click",function(t){t.preventDefault(),c.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(c.classList.remove("modal-show"),e.classList.toggle("show"))})}(),s){new Swiper(".swiper-container",{loop:!0,parallax:!0,autoplay:{delay:5e3},speed:1e3,mousewheelControl:!0})}if(a){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(i){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"4",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1230:{slidesPerView:3},900:{slidesPerView:2},650:{slidesPerView:1,spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(p){new Swiper(p,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}if(l){var L=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(L)}setTimeout(e,100),m&&m.addEventListener("click",function(){m.classList.toggle("open"),f.classList.toggle("show"),w.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(m.classList.toggle("open"),f.classList.toggle("show"),w.classList.toggle("show"))});for(var h=0;h<v.length;h++)v[h].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),g&&baguetteBox.run(".gallery-wrap",{async:!0});for(var S=document.querySelectorAll("form"),E=0;E<S.length;E++)!function(e){S[e].onsubmit=function(t){t.preventDefault(),S[e].classList.add("signed")}}(E);var b=y.offsetTop;window.addEventListener("scroll",t);var q=document.querySelector(".scroll-down");q&&q.addEventListener("click",o);for(var k=document.querySelectorAll(".fixed-width"),T=0;T<k.length;T++)!function(e){k[e].addEventListener("keyup",function(t){if(13===t.keyCode){var o=k[e].querySelector(".menu");k[e].classList.toggle("fixed-width--show"),o.addEventListener("blur",function(){o.style.display="none"})}})}(T);var x=document.querySelector(".js-starblind-trigger"),C=document.querySelector(".main-wrapper");x.addEventListener("click",function(){C.classList.toggle("starblind"),document.roo})}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>i?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>l&&n(a,"cd-top--fade-out"),r=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,i=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,i),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],i=300,l=1200,r=!1;a&&(window.addEventListener("scroll",function(t){r||(r=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwiYWRkVGltZUZvb3RlciIsImRhdGUiLCJEYXRlIiwib3B0aW9ucyIsInllYXIiLCJtb250aCIsImRheSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRvTG9jYWxlU3RyaW5nIiwiZml4TmF2Iiwic2Nyb2xsWSIsInRvcE9mTmF2IiwiYm9keSIsInN0eWxlIiwicGFkZGluZ1RvcCIsIm5hdiIsIm9mZnNldEhlaWdodCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNjcm9sbERvd24iLCJ3aW5kb3dDb29yZHMiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJjb25zb2xlIiwibG9nIiwic2Nyb2xsIiwicGFnZVlPZmZzZXQiLCJzY3JvbGxCeSIsInNldFRpbWVvdXQiLCJzY3JvbGxUbyIsInByZWxvYWRlciIsImdldEVsZW1lbnRCeUlkIiwib3ZlcmZsb3ciLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ3cmFwcGVyTWVudSIsInNpZGVuYXYiLCJvdmVybGF5IiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRlc3RpbW9uaWFsc1NsaWRlciIsImdhbGxlcnkiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwiZm9jdXMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJTd2lwZXIiLCJsb29wIiwicGFyYWxsYXgiLCJhdXRvcGxheSIsImRlbGF5Iiwic3BlZWQiLCJtb3VzZXdoZWVsQ29udHJvbCIsInNwYWNlQmV0d2VlbiIsImVmZmVjdCIsImdyYWJDdXJzb3IiLCJwYWdpbmF0aW9uIiwiZWwiLCJjbGlja2FibGUiLCJjZW50ZXJlZFNsaWRlcyIsImtleWJvYXJkIiwic2xpZGVzUGVyVmlldyIsImNvdmVyZmxvd0VmZmVjdCIsInJvdGF0ZSIsInN0cmV0Y2giLCJkZXB0aCIsIm1vZGlmaWVyIiwic2xpZGVTaGFkb3dzIiwiYnJlYWtwb2ludHMiLCIxMjMwIiwiOTAwIiwiNjUwIiwic2ltdWxhdGVUb3VjaCIsIm5hdmlnYXRpb24iLCJuZXh0RWwiLCJwcmV2RWwiLCJhdXRvSGVpZ2h0IiwiaW5pdCIsIm15TWFwIiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJjb250cm9scyIsInpvb20iLCJnZXQiLCJyb3V0ZVBhbmVsIiwic3RhdGUiLCJzZXQiLCJteVBsYWNlbWFyayIsIlBsYWNlbWFyayIsImhpbnRDb250ZW50IiwiYmFsbG9vbkNvbnRlbnQiLCJwcmVzZXQiLCJnZW9PYmplY3RzIiwicmVhZHkiLCJpIiwibGVuZ3RoIiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsInBlb3BsZUNhcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2kiLCJjYXJkIiwicGFyZW50Tm9kZSIsImljb24iLCJiYWd1ZXR0ZUJveCIsInJ1biIsImFzeW5jIiwiZm9ybXMiLCJfaTIiLCJvbnN1Ym1pdCIsIm9mZnNldFRvcCIsImJ0blNjcm9sbERvd24iLCJkcm9wZG93bkl0ZW1zIiwiX2kzIiwia2V5Q29kZSIsInN1Yk1lbnUiLCJkaXNwbGF5IiwiYmxpbmR0cmlnZ2VyIiwibWFpbldyYXBwZXIiLCJyb28iLCJjaGVja0JhY2tUb1RvcCIsIndpbmRvd1RvcCIsInNjcm9sbFRvcCIsIm9mZnNldCIsImFkZENsYXNzIiwiYmFja1RvcCIsInJlbW92ZUNsYXNzIiwib2Zmc2V0T3BhY2l0eSIsInNjcm9sbGluZyIsImR1cmF0aW9uIiwic3RhcnQiLCJjdXJyZW50VGltZSIsImFuaW1hdGVTY3JvbGwiLCJ0aW1lc3RhbXAiLCJwcm9ncmVzcyIsInZhbCIsIk1hdGgiLCJtYXgiLCJlYXNlSW5PdXRRdWFkIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiaGFzQ2xhc3MiLCJjbGFzc05hbWUiLCJtYXRjaCIsIlJlZ0V4cCIsImNvbmNhdCIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwicmVnIiwicmVwbGFjZSIsInQiLCJiIiwiYyIsImQiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUFBLFFBQUFDLGlCQUFBLE9BQUEsV0ErSkEsUUFBQUMsS0FDQSxHQUFBQyxHQUFBLEdBQUFDLE1BQ0FDLEdBQ0FDLEtBQUEsVUFDQUMsTUFBQSxPQUNBQyxJQUFBLFVBRUFDLFVBQUFDLGNBQUEseUJBQ0FDLFVBQUFSLEVBQUFTLGVBQUEsS0FBQVAsR0E0RkEsUUFBQVEsS0FDQWIsT0FBQWMsU0FBQUMsR0FDQU4sU0FBQU8sS0FBQUMsTUFBQUMsV0FBQUMsRUFBQUMsYUFBQSxLQUNBRCxFQUFBRSxVQUFBQyxJQUFBLGVBRUFILEVBQUFFLFVBQUFFLE9BQUEsYUFDQWQsU0FBQU8sS0FBQUMsTUFBQUMsV0FBQSxHQVNBLFFBQUFNLEtBQ0EsR0FBQUMsR0FBQWhCLFNBQUFpQixnQkFBQUMsYUFBQSxFQUNBQyxTQUFBQyxJQUFBSixHQUVBLFFBQUFLLEtBQ0E5QixPQUFBK0IsWUFBQU4sSUFDQXpCLE9BQUFnQyxTQUFBLEVBQUEsSUFDQUMsV0FBQUgsRUFBQSxJQUdBOUIsT0FBQStCLFlBQUFOLEdBQ0F6QixPQUFBa0MsU0FBQSxFQUFBVCxNQTNSQSxHQUFBVSxHQUFBMUIsU0FBQTJCLGVBQUEsWUFFQUQsSUFDQUYsV0FBQSxXQUNBRSxFQUFBZCxVQUFBQyxJQUFBLFVBQ0FiLFNBQUFPLEtBQUFDLE1BQUFvQixTQUFBLFdBQ0EsSUFJQSxJQUFBQyxHQUFBN0IsU0FBQUMsY0FBQSxtQkFDQTZCLEVBQUE5QixTQUFBQyxjQUFBLGdCQUNBOEIsRUFBQS9CLFNBQUFDLGNBQUEsZ0JBQ0ErQixFQUFBaEMsU0FBQTJCLGVBQUEsT0FDQU0sRUFBQWpDLFNBQUFDLGNBQUEsbUNBQ0FpQyxFQUFBbEMsU0FBQUMsY0FBQSxVQUNBa0MsRUFBQUQsRUFBQWpDLGNBQUEscUJBQ0FtQyxFQUFBRixFQUFBakMsY0FBQSxnQkFDQW9DLEVBQUFyQyxTQUFBQyxjQUFB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Q0FELEtBQ0FFLEVBQUEsR0FBQUYsR0FBQUEsRUFBQSxHQUFBLEdBQUFDIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAvLyBwcmVsb2FkZXJcbiAgdmFyIHByZWxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmVsb2FkZXInKTtcblxuICBpZiAocHJlbG9hZGVyKSB7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBwcmVsb2FkZXIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gJ3Zpc2libGUnO1xuICAgIH0sIDEwMDApO1xuICB9IC8vIEVORCBQcmVsb2FkZXJcblxuXG4gIHZhciBzbGlkZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtaGVyby1zbGlkZXInKTtcbiAgdmFyIGJsb2dTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvZy1zbGlkZXInKTtcbiAgdmFyIG5ld3NTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3cy1zbGlkZXInKTtcbiAgdmFyIG1hcENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcbiAgdmFyIGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtaGVhZGVyLWluZm9fX3dyaXRlVG9Vcy1saW5rJyk7XG4gIHZhciBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtY2xvc2VfX2J0bicpO1xuICB2YXIgbG9naW4gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1sb2dpbl0nKTtcbiAgdmFyIHdyYXBwZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXItbWVudScpO1xuICB2YXIgc2lkZW5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1zaWRlbmF2Jyk7XG4gIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGVuYXYtb3ZlcmxheScpO1xuICB2YXIgYWNjID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWNjLWhlYWRlcicpO1xuICB2YXIgdGVzdGltb25pYWxzU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlc3RpbW9uaWFscy1zbGlkZXInKTtcbiAgdmFyIGdhbGxlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FsbGVyeScpO1xuICB2YXIgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi1tYWluJyk7IC8vIE1vZGFsXG5cbiAgdmFyIG1vZGFsID0gZnVuY3Rpb24gbW9kYWwoKSB7XG4gICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtb3ZlcmxheScpO1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QudG9nZ2xlKCdtb2RhbC1zaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIGxvZ2luLmZvY3VzKCk7XG4gICAgfSk7XG4gICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbC1zaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbC1vdmVybGF5JykpIHtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBtb2RhbCgpOyAvLyBFTkQgTW9kYWxcbiAgLy8gU2xpZGVyc1xuXG4gIGlmIChzbGlkZXJDb250YWluZXIpIHtcbiAgICB2YXIgbXlTd2lwZXIgPSBuZXcgU3dpcGVyKCcuc3dpcGVyLWNvbnRhaW5lcicsIHtcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBwYXJhbGxheDogdHJ1ZSxcbiAgICAgIGF1dG9wbGF5OiB7XG4gICAgICAgIGRlbGF5OiA1MDAwXG4gICAgICB9LFxuICAgICAgc3BlZWQ6IDEwMDAsXG4gICAgICBtb3VzZXdoZWVsQ29udHJvbDogdHJ1ZVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGJsb2dTbGlkZXIpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcignLmJsb2ctc2xpZGVyJywge1xuICAgICAgc3BhY2VCZXR3ZWVuOiAzMCxcbiAgICAgIGVmZmVjdDogJ2ZhZGUnLFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgIGdyYWJDdXJzb3I6IHRydWUsXG4gICAgICBhdXRvcGxheToge1xuICAgICAgICBkZWxheTogNzAwMFxuICAgICAgfSxcbiAgICAgIC8vIGF1dG9IZWlnaHQ6IHRydWUsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLmJsb2ctc2xpZGVyX19wYWdpbmF0aW9uJyxcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpZiAobmV3c1NsaWRlcikge1xuICAgIHZhciBuZXdzU3dpcGVyID0gbmV3IFN3aXBlcignLm5ld3Mtc2xpZGVyJywge1xuICAgICAgZWZmZWN0OiAnY292ZXJmbG93JyxcbiAgICAgIGdyYWJDdXJzb3I6IHRydWUsXG4gICAgICBsb29wOiBmYWxzZSxcbiAgICAgIGNlbnRlcmVkU2xpZGVzOiBmYWxzZSxcbiAgICAgIGtleWJvYXJkOiB0cnVlLFxuICAgICAgc3BhY2VCZXR3ZWVuOiAxMCxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICc0JyxcbiAgICAgIHNwZWVkOiAzMDAsXG4gICAgICBjb3ZlcmZsb3dFZmZlY3Q6IHtcbiAgICAgICAgcm90YXRlOiAwLFxuICAgICAgICBzdHJldGNoOiAwLFxuICAgICAgICBkZXB0aDogMCxcbiAgICAgICAgbW9kaWZpZXI6IDEsXG4gICAgICAgIHNsaWRlU2hhZG93czogZmFsc2VcbiAgICAgIH0sXG4gICAgICBicmVha3BvaW50czoge1xuICAgICAgICAxMjMwOiB7XG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogM1xuICAgICAgICB9LFxuICAgICAgICA5MDA6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAyXG4gICAgICAgIH0sXG4gICAgICAgIDY1MDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICAgIGNlbnRlcmVkU2xpZGVzOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzaW11bGF0ZVRvdWNoOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcubmV3cy1zbGlkZXItbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5uZXdzLXNsaWRlci1wcmV2J1xuICAgICAgfSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcubmV3cy1zbGlkZXJfX3BhZ2luYXRpb24nLFxuICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmICh0ZXN0aW1vbmlhbHNTbGlkZXIpIHtcbiAgICB2YXIgZmVlZFN3aXBlciA9IG5ldyBTd2lwZXIodGVzdGltb25pYWxzU2xpZGVyLCB7XG4gICAgICBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgIG5hdmlnYXRpb246IHtcbiAgICAgICAgbmV4dEVsOiAnLnN3aXBlci1idXR0b24tbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5zd2lwZXItYnV0dG9uLXByZXYnXG4gICAgICB9XG4gICAgfSk7XG4gIH0gLy8gRU5EIFNsaWRlcnNcbiAgLy8gTWFwXG5cblxuICBpZiAobWFwQ29udGFpbmVyKSB7XG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIG15TWFwID0gbmV3IHltYXBzLk1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFs0Ny41Mzk2LCA0Mi4wMTUxXSxcbiAgICAgICAgY29udHJvbHM6IFsndHlwZVNlbGVjdG9yJywgJ2Z1bGxzY3JlZW5Db250cm9sJywgJ2dlb2xvY2F0aW9uQ29udHJvbCcsICdydWxlckNvbnRyb2wnLCAncm91dGVCdXR0b25Db250cm9sJ10sXG4gICAgICAgIHpvb206IDE2XG4gICAgICB9KTtcbiAgICAgIHZhciBjb250cm9sID0gbXlNYXAuY29udHJvbHMuZ2V0KCdyb3V0ZUJ1dHRvbkNvbnRyb2wnKTtcbiAgICAgIGNvbnRyb2wucm91dGVQYW5lbC5zdGF0ZS5zZXQoJ2Zyb20nLCAn0KDQvtC80LDQvdC+0LLRgdC60LDRjyDRgdC+0Y7Qt9C90YvQuSA5N9CwJyk7XG4gICAgICB2YXIgbXlQbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs0Ny41Mzk4LCA0Mi4wMTUzXSwge1xuICAgICAgICBoaW50Q29udGVudDogJ9Cj0LsuINCh0L7RjtC30L3QsNGPIDk30LAnLFxuICAgICAgICBiYWxsb29uQ29udGVudDogJ9Cf0L7Qu9C40LrQu9C40L3QuNC60LAnXG4gICAgICB9LCB7XG4gICAgICAgIHByZXNldDogJ2lzbGFuZHMjYmx1ZU1lZGljYWxJY29uJ1xuICAgICAgfSk7XG4gICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XG4gICAgfTtcblxuICAgIHltYXBzLnJlYWR5KGluaXQpO1xuICB9IC8vIEVORCBNYXBcbiAgLy8gVGltZSB0byBmb290ZXJcblxuXG4gIGZ1bmN0aW9uIGFkZFRpbWVGb290ZXIoKSB7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgbW9udGg6ICdsb25nJyxcbiAgICAgIGRheTogJ251bWVyaWMnXG4gICAgfTtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWZvb3Rlci1pbmZvX19kYXRlJyk7XG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoJ3J1Jywgb3B0aW9ucyk7XG4gIH1cblxuICBzZXRUaW1lb3V0KGFkZFRpbWVGb290ZXIsIDEwMCk7IC8vIEVORCBUaW1lIHRvIGZvb3RlclxuICAvLyBTaWRlbWVudVxuXG4gIGlmICh3cmFwcGVyTWVudSkgd3JhcHBlck1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgIHNpZGVuYXYuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICB9KTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NpZGVuYXYtb3ZlcmxheScpKSB7XG4gICAgICB3cmFwcGVyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJyk7XG4gICAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgIH1cbiAgfSk7IC8vIEVORCBTaWRlbWVudVxuICAvLyBhY2NvcmRpb25cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFjYy5sZW5ndGg7IGkrKykge1xuICAgIGFjY1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBhZGRpbmcgYW5kIHJlbW92aW5nIHRoZSBcImFjdGl2ZVwiIGNsYXNzLFxuICAgICAgdG8gaGlnaGxpZ2h0IHRoZSBidXR0b24gdGhhdCBjb250cm9scyB0aGUgcGFuZWwgKi9cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBoaWRpbmcgYW5kIHNob3dpbmcgdGhlIGFjdGl2ZSBwYW5lbCAqL1xuXG4gICAgICB2YXIgcGFuZWwgPSB0aGlzLm5leHRFbGVtZW50U2libGluZztcbiAgICAgIHBhbmVsLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuICB9IC8vIEVORCBBY2NvcmRpb25cbiAgLy8gcGVvcGxlQ2FyZFxuXG5cbiAgZnVuY3Rpb24gcGVvcGxlQ2FyZCgpIHtcbiAgICB2YXIgcGVvcGxlQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYXRlcmlhbC1jYXJkID4gLm1jLWJ0bi1hY3Rpb24nKTtcblxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBwZW9wbGVDYXJkLmxlbmd0aDsgX2krKykge1xuICAgICAgcGVvcGxlQ2FyZFtfaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjYXJkID0gdGhpcy5wYXJlbnROb2RlO1xuICAgICAgICB2YXIgaWNvbiA9IHRoaXMucXVlcnlTZWxlY3RvcignaScpO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLXNwaW4tZmFzdCcpO1xuXG4gICAgICAgIGlmIChjYXJkLmNsYXNzTGlzdC5jb250YWlucygnbWMtYWN0aXZlJykpIHtcbiAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5yZW1vdmUoJ21jLWFjdGl2ZScpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1hcnJvdy1sZWZ0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLXNwaW4tZmFzdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1iYXJzJyk7XG4gICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ21jLWFjdGl2ZScpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1iYXJzJyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLXNwaW4tZmFzdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1hcnJvdy1sZWZ0Jyk7XG4gICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcGVvcGxlQ2FyZCgpOyAvLyBFTkQgUGVvcGxlQ2FyZFxuICAvLyBHYWxsZXJ5XG5cbiAgaWYgKGdhbGxlcnkpIHtcbiAgICBiYWd1ZXR0ZUJveC5ydW4oJy5nYWxsZXJ5LXdyYXAnLCB7XG4gICAgICBhc3luYzogdHJ1ZVxuICAgIH0pO1xuICB9IC8vIEVORCBHYWxsZXJ5XG4gIC8vIEZvcm1TdWJtaXRcblxuXG4gIHZhciBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKTtcblxuICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChfaTIpIHtcbiAgICBmb3Jtc1tfaTJdLm9uc3VibWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBmb3Jtc1tfaTJdLmNsYXNzTGlzdC5hZGQoJ3NpZ25lZCcpO1xuICAgIH07XG4gIH07XG5cbiAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgZm9ybXMubGVuZ3RoOyBfaTIrKykge1xuICAgIF9sb29wKF9pMik7XG4gIH0gLy8gRU5EIEZvcm1TdWJtaXRcbiAgLy8gRml4ZWROYXZcblxuXG4gIHZhciB0b3BPZk5hdiA9IG5hdi5vZmZzZXRUb3A7XG5cbiAgZnVuY3Rpb24gZml4TmF2KCkge1xuICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+PSB0b3BPZk5hdikge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nVG9wID0gbmF2Lm9mZnNldEhlaWdodCArICdweCc7XG4gICAgICBuYXYuY2xhc3NMaXN0LmFkZCgnZml4ZWQtbmF2Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZC1uYXYnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IDA7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZpeE5hdik7IC8vIEVORCBGaXhlZE5hdlxuICAvLyBzY3JvbGwtZG93blxuXG4gIHZhciBidG5TY3JvbGxEb3duID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjcm9sbC1kb3duJyk7XG5cbiAgZnVuY3Rpb24gc2Nyb2xsRG93bigpIHtcbiAgICB2YXIgd2luZG93Q29vcmRzID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIDUwO1xuICAgIGNvbnNvbGUubG9nKHdpbmRvd0Nvb3Jkcyk7XG5cbiAgICAoZnVuY3Rpb24gc2Nyb2xsKCkge1xuICAgICAgaWYgKHdpbmRvdy5wYWdlWU9mZnNldCA8IHdpbmRvd0Nvb3Jkcykge1xuICAgICAgICB3aW5kb3cuc2Nyb2xsQnkoMCwgMTApO1xuICAgICAgICBzZXRUaW1lb3V0KHNjcm9sbCwgMCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh3aW5kb3cucGFnZVlPZmZzZXQgPiB3aW5kb3dDb29yZHMpIHtcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHdpbmRvd0Nvb3Jkcyk7XG4gICAgICB9XG4gICAgfSkoKTtcbiAgfVxuXG4gIGlmIChidG5TY3JvbGxEb3duKSB7XG4gICAgYnRuU2Nyb2xsRG93bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNjcm9sbERvd24pO1xuICB9IC8vIEVORCBzY3JvbGwtZG93blxuICAvLyBNZW51IGRyb3Bkb3duXG5cblxuICB2YXIgZHJvcGRvd25JdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXhlZC13aWR0aCcpO1xuXG4gIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoX2kzKSB7XG4gICAgZHJvcGRvd25JdGVtc1tfaTNdLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgdmFyIHN1Yk1lbnUgPSBkcm9wZG93bkl0ZW1zW19pM10ucXVlcnlTZWxlY3RvcignLm1lbnUnKTtcblxuICAgICAgICBkcm9wZG93bkl0ZW1zW19pM10uY2xhc3NMaXN0LnRvZ2dsZSgnZml4ZWQtd2lkdGgtLXNob3cnKTtcblxuICAgICAgICBzdWJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3ViTWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBkcm9wZG93bkl0ZW1zLmxlbmd0aDsgX2kzKyspIHtcbiAgICBfbG9vcDIoX2kzKTtcbiAgfSAvLyBFTkQgTWVudSBkcm9wZG93blxuICAvLyBCbGluZFxuXG5cbiAgdmFyIGJsaW5kdHJpZ2dlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1zdGFyYmxpbmQtdHJpZ2dlcicpO1xuICB2YXIgbWFpbldyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbi13cmFwcGVyJyk7XG4gIGJsaW5kdHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBtYWluV3JhcHBlci5jbGFzc0xpc3QudG9nZ2xlKCdzdGFyYmxpbmQnKTtcbiAgICBkb2N1bWVudC5yb287XG4gIH0pO1xufSk7IC8vIHZhciBodG1sRWxlbWVudCA9IGRvY3VtZW50LmJvZHkucGFyZW50Tm9kZTtcbi8vIGh0bWxFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gJzI4cHgnXG4vLyBjb25zb2xlLmxvZyhodG1sRWxlbWVudCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBiYWNrVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtY2QtdG9wJylbMF07XG4gIHZhciBvZmZzZXQgPSAzMDA7XG4gIHZhciBvZmZzZXRPcGFjaXR5ID0gMTIwMDtcbiAgdmFyIHNjcm9sbER1cmF0aW9uID0gNzAwO1xuICB2YXIgc2Nyb2xsaW5nID0gZmFsc2U7XG5cbiAgaWYgKGJhY2tUb3ApIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAoIXNjcm9sbGluZykge1xuICAgICAgICBzY3JvbGxpbmcgPSB0cnVlO1xuICAgICAgICAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IHNldFRpbWVvdXQoY2hlY2tCYWNrVG9Ub3AsIDI1MCkgOiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNoZWNrQmFja1RvVG9wKTtcbiAgICAgIH1cbiAgICB9KTsgLy9zbW9vdGggc2Nyb2xsIHRvIHRvcFxuXG4gICAgYmFja1RvcC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gd2luZG93LnNjcm9sbFRvKDAsIDApIDogc2Nyb2xsVG9wKHNjcm9sbER1cmF0aW9uKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrQmFja1RvVG9wKCkge1xuICAgIHZhciB3aW5kb3dUb3AgPSB3aW5kb3cuc2Nyb2xsWSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIHdpbmRvd1RvcCA+IG9mZnNldCA/IGFkZENsYXNzKGJhY2tUb3AsICdjZC10b3AtLXNob3cnKSA6IHJlbW92ZUNsYXNzKGJhY2tUb3AsICdjZC10b3AtLXNob3cnLCAnY2QtdG9wLS1mYWRlLW91dCcpO1xuICAgIHdpbmRvd1RvcCA+IG9mZnNldE9wYWNpdHkgJiYgYWRkQ2xhc3MoYmFja1RvcCwgJ2NkLXRvcC0tZmFkZS1vdXQnKTtcbiAgICBzY3JvbGxpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNjcm9sbFRvcChkdXJhdGlvbikge1xuICAgIHZhciBzdGFydCA9IHdpbmRvdy5zY3JvbGxZIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgdmFyIGN1cnJlbnRUaW1lID0gbnVsbDtcblxuICAgIHZhciBhbmltYXRlU2Nyb2xsID0gZnVuY3Rpb24gYW5pbWF0ZVNjcm9sbCh0aW1lc3RhbXApIHtcbiAgICAgIGlmICghY3VycmVudFRpbWUpIGN1cnJlbnRUaW1lID0gdGltZXN0YW1wO1xuICAgICAgdmFyIHByb2dyZXNzID0gdGltZXN0YW1wIC0gY3VycmVudFRpbWU7XG4gICAgICB2YXIgdmFsID0gTWF0aC5tYXgoTWF0aC5lYXNlSW5PdXRRdWFkKHByb2dyZXNzLCBzdGFydCwgLXN0YXJ0LCBkdXJhdGlvbiksIDApO1xuICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHZhbCk7XG5cbiAgICAgIGlmIChwcm9ncmVzcyA8IGR1cmF0aW9uKSB7XG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZVNjcm9sbCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZVNjcm9sbCk7XG4gIH1cblxuICBNYXRoLmVhc2VJbk91dFF1YWQgPSBmdW5jdGlvbiAodCwgYiwgYywgZCkge1xuICAgIHQgLz0gZCAvIDI7XG4gICAgaWYgKHQgPCAxKSByZXR1cm4gYyAvIDIgKiB0ICogdCArIGI7XG4gICAgdC0tO1xuICAgIHJldHVybiAtYyAvIDIgKiAodCAqICh0IC0gMikgLSAxKSArIGI7XG4gIH07IC8vY2xhc3MgbWFuaXB1bGF0aW9ucyAtIG5lZWRlZCBpZiBjbGFzc0xpc3QgaXMgbm90IHN1cHBvcnRlZFxuXG5cbiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIHJldHVybiBlbC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKTtlbHNlIHJldHVybiAhIWVsLmNsYXNzTmFtZS5tYXRjaChuZXcgUmVnRXhwKFwiKFxcXFxzfF4pXCIuY29uY2F0KGNsYXNzTmFtZSwgXCIoXFxcXHN8JClcIikpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZENsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICB2YXIgY2xhc3NMaXN0ID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgZWwuY2xhc3NMaXN0LmFkZChjbGFzc0xpc3RbMF0pO2Vsc2UgaWYgKCFoYXNDbGFzcyhlbCwgY2xhc3NMaXN0WzBdKSkgZWwuY2xhc3NOYW1lICs9IFwiIFwiLmNvbmNhdChjbGFzc0xpc3RbMF0pO1xuICAgIGlmIChjbGFzc0xpc3QubGVuZ3RoID4gMSkgYWRkQ2xhc3MoZWwsIGNsYXNzTGlzdC5zbGljZSgxKS5qb2luKCcgJykpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xuICAgIHZhciBjbGFzc0xpc3QgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSBlbC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTGlzdFswXSk7ZWxzZSBpZiAoaGFzQ2xhc3MoZWwsIGNsYXNzTGlzdFswXSkpIHtcbiAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKFwiKFxcXFxzfF4pXCIuY29uY2F0KGNsYXNzTGlzdFswXSwgXCIoXFxcXHN8JClcIikpO1xuICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lLnJlcGxhY2UocmVnLCAnICcpO1xuICAgIH1cbiAgICBpZiAoY2xhc3NMaXN0Lmxlbmd0aCA+IDEpIHJlbW92ZUNsYXNzKGVsLCBjbGFzc0xpc3Quc2xpY2UoMSkuam9pbignICcpKTtcbiAgfVxufSkoKTsiXX0=
