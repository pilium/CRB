"use strict";document.addEventListener("DOMContentLoaded",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=b?(document.body.style.paddingTop=y.offsetHeight+"px",y.classList.add("fixed-nav")):(y.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}function o(){var e=document.documentElement.clientHeight-50;console.log(e),function t(){window.pageYOffset<e&&(window.scrollBy(0,10),setTimeout(t,0)),window.pageYOffset>e&&window.scrollTo(0,e)}()}var n=document.getElementById("preloader");n&&setTimeout(function(){n.classList.add("active"),document.body.style.overflow="visible"},3e3);var s=document.querySelector(".js-hero-slider"),a=document.querySelector(".blog-slider"),i=document.querySelector(".news-slider"),l=document.getElementById("map"),r=document.querySelector(".js-header-info__writeToUs-link"),c=document.querySelector(".modal"),d=c.querySelector(".modal-close__btn"),u=c.querySelector("[name=login]"),m=document.querySelector(".wrapper-menu"),f=document.querySelector(".js-sidenav"),w=document.querySelector(".sidenav-overlay"),v=document.getElementsByClassName("acc-header"),p=document.querySelector(".testimonials-slider"),g=document.querySelector(".gallery"),y=document.querySelector("#nav-main");if(function(){var e=document.querySelector(".modal-overlay");r.addEventListener("click",function(t){t.preventDefault(),c.classList.toggle("modal-show"),e.classList.toggle("show"),u.focus()}),d.addEventListener("click",function(t){t.preventDefault(),c.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(c.classList.remove("modal-show"),e.classList.toggle("show"))})}(),s){new Swiper(".swiper-container",{loop:!0,parallax:!0,autoplay:{delay:5e3},speed:1e3,mousewheelControl:!0})}if(a){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(i){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"4",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1230:{slidesPerView:3},900:{slidesPerView:2},650:{slidesPerView:1,spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(p){new Swiper(p,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}if(l){var L=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(L)}setTimeout(e,100),m&&m.addEventListener("click",function(){m.classList.toggle("open"),f.classList.toggle("show"),w.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(m.classList.toggle("open"),f.classList.toggle("show"),w.classList.toggle("show"))});for(var h=0;h<v.length;h++)v[h].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),g&&baguetteBox.run(".gallery-wrap",{async:!0});for(var S=document.querySelectorAll("form"),E=0;E<S.length;E++)!function(e){S[e].onsubmit=function(t){t.preventDefault(),S[e].classList.add("signed")}}(E);var b=y.offsetTop;window.addEventListener("scroll",t);var q=document.querySelector(".scroll-down");q&&q.addEventListener("click",o);for(var k=document.querySelectorAll(".fixed-width"),T=0;T<k.length;T++)!function(e){k[e].addEventListener("keyup",function(t){if(13===t.keyCode){var o=k[e].querySelector(".menu");k[e].classList.toggle("fixed-width--show"),o.addEventListener("blur",function(){o.style.display="none"})}})}(T);var x=document.querySelector(".js-starblind-trigger"),C=document.querySelector(".main-wrapper");x.addEventListener("click",function(){C.classList.toggle("starblind"),document.roo})}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>i?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>l&&n(a,"cd-top--fade-out"),r=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,i=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,i),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],i=300,l=1200,r=!1;a&&(window.addEventListener("scroll",function(t){r||(r=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRUaW1lRm9vdGVyIiwiZGF0ZSIsIkRhdGUiLCJvcHRpb25zIiwieWVhciIsIm1vbnRoIiwiZGF5IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRvTG9jYWxlU3RyaW5nIiwiZml4TmF2Iiwid2luZG93Iiwic2Nyb2xsWSIsInRvcE9mTmF2IiwiYm9keSIsInN0eWxlIiwicGFkZGluZ1RvcCIsIm5hdiIsIm9mZnNldEhlaWdodCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNjcm9sbERvd24iLCJ3aW5kb3dDb29yZHMiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJjb25zb2xlIiwibG9nIiwic2Nyb2xsIiwicGFnZVlPZmZzZXQiLCJzY3JvbGxCeSIsInNldFRpbWVvdXQiLCJzY3JvbGxUbyIsInByZWxvYWRlciIsImdldEVsZW1lbnRCeUlkIiwib3ZlcmZsb3ciLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ3cmFwcGVyTWVudSIsInNpZGVuYXYiLCJvdmVybGF5IiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRlc3RpbW9uaWFsc1NsaWRlciIsImdhbGxlcnkiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwiZm9jdXMiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJTd2lwZXIiLCJsb29wIiwicGFyYWxsYXgiLCJhdXRvcGxheSIsImRlbGF5Iiwic3BlZWQiLCJtb3VzZXdoZWVsQ29udHJvbCIsInNwYWNlQmV0d2VlbiIsImVmZmVjdCIsImdyYWJDdXJzb3IiLCJwYWdpbmF0aW9uIiwiZWwiLCJjbGlja2FibGUiLCJjZW50ZXJlZFNsaWRlcyIsImtleWJvYXJkIiwic2xpZGVzUGVyVmlldyIsImNvdmVyZmxvd0VmZmVjdCIsInJvdGF0ZSIsInN0cmV0Y2giLCJkZXB0aCIsIm1vZGlmaWVyIiwic2xpZGVTaGFkb3dzIiwiYnJlYWtwb2ludHMiLCIxMjMwIiwiOTAwIiwiNjUwIiwic2ltdWxhdGVUb3VjaCIsIm5hdmlnYXRpb24iLCJuZXh0RWwiLCJwcmV2RWwiLCJhdXRvSGVpZ2h0IiwiaW5pdCIsIm15TWFwIiwieW1hcHMiLCJNYXAiLCJjZW50ZXIiLCJjb250cm9scyIsInpvb20iLCJnZXQiLCJyb3V0ZVBhbmVsIiwic3RhdGUiLCJzZXQiLCJteVBsYWNlbWFyayIsIlBsYWNlbWFyayIsImhpbnRDb250ZW50IiwiYmFsbG9vbkNvbnRlbnQiLCJwcmVzZXQiLCJnZW9PYmplY3RzIiwicmVhZHkiLCJpIiwibGVuZ3RoIiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsInBlb3BsZUNhcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2kiLCJjYXJkIiwicGFyZW50Tm9kZSIsImljb24iLCJiYWd1ZXR0ZUJveCIsInJ1biIsImFzeW5jIiwiZm9ybXMiLCJfaTIiLCJvbnN1Ym1pdCIsIm9mZnNldFRvcCIsImJ0blNjcm9sbERvd24iLCJkcm9wZG93bkl0ZW1zIiwiX2kzIiwia2V5Q29kZSIsInN1Yk1lbnUiLCJkaXNwbGF5IiwiYmxpbmR0cmlnZ2VyIiwibWFpbldyYXBwZXIiLCJyb28iLCJjaGVja0JhY2tUb1RvcCIsIndpbmRvd1RvcCIsInNjcm9sbFRvcCIsIm9mZnNldCIsImFkZENsYXNzIiwiYmFja1RvcCIsInJlbW92ZUNsYXNzIiwib2Zmc2V0T3BhY2l0eSIsInNjcm9sbGluZyIsImR1cmF0aW9uIiwic3RhcnQiLCJjdXJyZW50VGltZSIsImFuaW1hdGVTY3JvbGwiLCJ0aW1lc3RhbXAiLCJwcm9ncmVzcyIsInZhbCIsIk1hdGgiLCJtYXgiLCJlYXNlSW5PdXRRdWFkIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiaGFzQ2xhc3MiLCJjbGFzc05hbWUiLCJtYXRjaCIsIlJlZ0V4cCIsImNvbmNhdCIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwicmVnIiwicmVwbGFjZSIsInQiLCJiIiwiYyIsImQiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUFBLFVBQUFDLGlCQUFBLG1CQUFBLFdBK0pBLFFBQUFDLEtBQ0EsR0FBQUMsR0FBQSxHQUFBQyxNQUNBQyxHQUNBQyxLQUFBLFVBQ0FDLE1BQUEsT0FDQUMsSUFBQSxVQUVBUixVQUFBUyxjQUFBLHlCQUNBQyxVQUFBUCxFQUFBUSxlQUFBLEtBQUFOLEdBNEZBLFFBQUFPLEtBQ0FDLE9BQUFDLFNBQUFDLEdBQ0FmLFNBQUFnQixLQUFBQyxNQUFBQyxXQUFBQyxFQUFBQyxhQUFBLEtBQ0FELEVBQUFFLFVBQUFDLElBQUEsZUFFQUgsRUFBQUUsVUFBQUUsT0FBQSxhQUNBdkIsU0FBQWdCLEtBQUFDLE1BQUFDLFdBQUEsR0FTQSxRQUFBTSxLQUNBLEdBQUFDLEdBQUF6QixTQUFBMEIsZ0JBQUFDLGFBQUEsRUFDQUMsU0FBQUMsSUFBQUosR0FFQSxRQUFBSyxLQUNBakIsT0FBQWtCLFlBQUFOLElBQ0FaLE9BQUFtQixTQUFBLEVBQUEsSUFDQUMsV0FBQUgsRUFBQSxJQUdBakIsT0FBQWtCLFlBQUFOLEdBQ0FaLE9BQUFxQixTQUFBLEVBQUFULE1BM1JBLEdBQUFVLEdBQUFuQyxTQUFBb0MsZUFBQSxZQUVBRCxJQUNBRixXQUFBLFdBQ0FFLEVBQUFkLFVBQUFDLElBQUEsVUFDQXRCLFNBQUFnQixLQUFBQyxNQUFBb0IsU0FBQSxXQUNBLElBSUEsSUFBQUMsR0FBQXRDLFNBQUFTLGNBQUEsbUJBQ0E4QixFQUFBdkMsU0FBQVMsY0FBQSxnQkFDQStCLEVBQUF4QyxTQUFBUyxjQUFBLGdCQUNBZ0MsRUFBQXpDLFNBQUFvQyxlQUFBLE9BQ0FNLEVBQUExQyxTQUFBUyxjQUFBLG1DQUNBa0MsRUFBQTNDLFNBQUFTLGNBQUEsVUFDQW1DLEVBQUFELEVBQUFsQyxjQUFBLHFCQUNBb0MsRUFBQUYsRUFBQWxDLGNBQUEsZ0JBQ0FxQyxFQUFBOUMsU0FBQVMs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QUMsR0FDQUQsS0FDQUUsRUFBQSxHQUFBRixHQUFBQSxFQUFBLEdBQUEsR0FBQUMiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgLy8gcHJlbG9hZGVyXG4gIHZhciBwcmVsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlbG9hZGVyJyk7XG5cbiAgaWYgKHByZWxvYWRlcikge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgcHJlbG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICd2aXNpYmxlJztcbiAgICB9LCAzMDAwKTtcbiAgfSAvLyBFTkQgUHJlbG9hZGVyXG5cblxuICB2YXIgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWhlcm8tc2xpZGVyJyk7XG4gIHZhciBibG9nU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJsb2ctc2xpZGVyJyk7XG4gIHZhciBuZXdzU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5ld3Mtc2xpZGVyJyk7XG4gIHZhciBtYXBDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyk7XG4gIHZhciBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWhlYWRlci1pbmZvX193cml0ZVRvVXMtbGluaycpO1xuICB2YXIgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwnKTtcbiAgdmFyIGNsb3NlID0gcG9wdXAucXVlcnlTZWxlY3RvcignLm1vZGFsLWNsb3NlX19idG4nKTtcbiAgdmFyIGxvZ2luID0gcG9wdXAucXVlcnlTZWxlY3RvcignW25hbWU9bG9naW5dJyk7XG4gIHZhciB3cmFwcGVyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy53cmFwcGVyLW1lbnUnKTtcbiAgdmFyIHNpZGVuYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc2lkZW5hdicpO1xuICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlbmF2LW92ZXJsYXknKTtcbiAgdmFyIGFjYyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2FjYy1oZWFkZXInKTtcbiAgdmFyIHRlc3RpbW9uaWFsc1NsaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50ZXN0aW1vbmlhbHMtc2xpZGVyJyk7XG4gIHZhciBnYWxsZXJ5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmdhbGxlcnknKTtcbiAgdmFyIG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuYXYtbWFpbicpOyAvLyBNb2RhbFxuXG4gIHZhciBtb2RhbCA9IGZ1bmN0aW9uIG1vZGFsKCkge1xuICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLW92ZXJsYXknKTtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnRvZ2dsZSgnbW9kYWwtc2hvdycpO1xuICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBsb2dpbi5mb2N1cygpO1xuICAgIH0pO1xuICAgIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWwtb3ZlcmxheScpKSB7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoJ21vZGFsLXNob3cnKTtcbiAgICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgbW9kYWwoKTsgLy8gRU5EIE1vZGFsXG4gIC8vIFNsaWRlcnNcblxuICBpZiAoc2xpZGVyQ29udGFpbmVyKSB7XG4gICAgdmFyIG15U3dpcGVyID0gbmV3IFN3aXBlcignLnN3aXBlci1jb250YWluZXInLCB7XG4gICAgICBsb29wOiB0cnVlLFxuICAgICAgcGFyYWxsYXg6IHRydWUsXG4gICAgICBhdXRvcGxheToge1xuICAgICAgICBkZWxheTogNTAwMFxuICAgICAgfSxcbiAgICAgIHNwZWVkOiAxMDAwLFxuICAgICAgbW91c2V3aGVlbENvbnRyb2w6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChibG9nU2xpZGVyKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5ibG9nLXNsaWRlcicsIHtcbiAgICAgIHNwYWNlQmV0d2VlbjogMzAsXG4gICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgYXV0b3BsYXk6IHtcbiAgICAgICAgZGVsYXk6IDcwMDBcbiAgICAgIH0sXG4gICAgICAvLyBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5ibG9nLXNsaWRlcl9fcGFnaW5hdGlvbicsXG4gICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG5ld3NTbGlkZXIpIHtcbiAgICB2YXIgbmV3c1N3aXBlciA9IG5ldyBTd2lwZXIoJy5uZXdzLXNsaWRlcicsIHtcbiAgICAgIGVmZmVjdDogJ2NvdmVyZmxvdycsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgbG9vcDogZmFsc2UsXG4gICAgICBjZW50ZXJlZFNsaWRlczogZmFsc2UsXG4gICAgICBrZXlib2FyZDogdHJ1ZSxcbiAgICAgIHNwYWNlQmV0d2VlbjogMTAsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnNCcsXG4gICAgICBzcGVlZDogMzAwLFxuICAgICAgY292ZXJmbG93RWZmZWN0OiB7XG4gICAgICAgIHJvdGF0ZTogMCxcbiAgICAgICAgc3RyZXRjaDogMCxcbiAgICAgICAgZGVwdGg6IDAsXG4gICAgICAgIG1vZGlmaWVyOiAxLFxuICAgICAgICBzbGlkZVNoYWRvd3M6IGZhbHNlXG4gICAgICB9LFxuICAgICAgYnJlYWtwb2ludHM6IHtcbiAgICAgICAgMTIzMDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDNcbiAgICAgICAgfSxcbiAgICAgICAgOTAwOiB7XG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogMlxuICAgICAgICB9LFxuICAgICAgICA2NTA6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgICAgICAgIHNwYWNlQmV0d2VlbjogMCxcbiAgICAgICAgICBjZW50ZXJlZFNsaWRlczogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc2ltdWxhdGVUb3VjaDogdHJ1ZSxcbiAgICAgIG5hdmlnYXRpb246IHtcbiAgICAgICAgbmV4dEVsOiAnLm5ld3Mtc2xpZGVyLW5leHQnLFxuICAgICAgICBwcmV2RWw6ICcubmV3cy1zbGlkZXItcHJldidcbiAgICAgIH0sXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLm5ld3Mtc2xpZGVyX19wYWdpbmF0aW9uJyxcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpZiAodGVzdGltb25pYWxzU2xpZGVyKSB7XG4gICAgdmFyIGZlZWRTd2lwZXIgPSBuZXcgU3dpcGVyKHRlc3RpbW9uaWFsc1NsaWRlciwge1xuICAgICAgYXV0b0hlaWdodDogdHJ1ZSxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBuYXZpZ2F0aW9uOiB7XG4gICAgICAgIG5leHRFbDogJy5zd2lwZXItYnV0dG9uLW5leHQnLFxuICAgICAgICBwcmV2RWw6ICcuc3dpcGVyLWJ1dHRvbi1wcmV2J1xuICAgICAgfVxuICAgIH0pO1xuICB9IC8vIEVORCBTbGlkZXJzXG4gIC8vIE1hcFxuXG5cbiAgaWYgKG1hcENvbnRhaW5lcikge1xuICAgIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcbiAgICAgICAgY2VudGVyOiBbNDcuNTM5NiwgNDIuMDE1MV0sXG4gICAgICAgIGNvbnRyb2xzOiBbJ3R5cGVTZWxlY3RvcicsICdmdWxsc2NyZWVuQ29udHJvbCcsICdnZW9sb2NhdGlvbkNvbnRyb2wnLCAncnVsZXJDb250cm9sJywgJ3JvdXRlQnV0dG9uQ29udHJvbCddLFxuICAgICAgICB6b29tOiAxNlxuICAgICAgfSk7XG4gICAgICB2YXIgY29udHJvbCA9IG15TWFwLmNvbnRyb2xzLmdldCgncm91dGVCdXR0b25Db250cm9sJyk7XG4gICAgICBjb250cm9sLnJvdXRlUGFuZWwuc3RhdGUuc2V0KCdmcm9tJywgJ9Cg0L7QvNCw0L3QvtCy0YHQutCw0Y8g0YHQvtGO0LfQvdGL0LkgOTfQsCcpO1xuICAgICAgdmFyIG15UGxhY2VtYXJrID0gbmV3IHltYXBzLlBsYWNlbWFyayhbNDcuNTM5OCwgNDIuMDE1M10sIHtcbiAgICAgICAgaGludENvbnRlbnQ6ICfQo9C7LiDQodC+0Y7Qt9C90LDRjyA5N9CwJyxcbiAgICAgICAgYmFsbG9vbkNvbnRlbnQ6ICfQn9C+0LvQuNC60LvQuNC90LjQutCwJ1xuICAgICAgfSwge1xuICAgICAgICBwcmVzZXQ6ICdpc2xhbmRzI2JsdWVNZWRpY2FsSWNvbidcbiAgICAgIH0pO1xuICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlQbGFjZW1hcmspO1xuICAgIH07XG5cbiAgICB5bWFwcy5yZWFkeShpbml0KTtcbiAgfSAvLyBFTkQgTWFwXG4gIC8vIFRpbWUgdG8gZm9vdGVyXG5cblxuICBmdW5jdGlvbiBhZGRUaW1lRm9vdGVyKCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIHllYXI6ICdudW1lcmljJyxcbiAgICAgIG1vbnRoOiAnbG9uZycsXG4gICAgICBkYXk6ICdudW1lcmljJ1xuICAgIH07XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1mb290ZXItaW5mb19fZGF0ZScpO1xuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSBkYXRlLnRvTG9jYWxlU3RyaW5nKCdydScsIG9wdGlvbnMpO1xuICB9XG5cbiAgc2V0VGltZW91dChhZGRUaW1lRm9vdGVyLCAxMDApOyAvLyBFTkQgVGltZSB0byBmb290ZXJcbiAgLy8gU2lkZW1lbnVcblxuICBpZiAod3JhcHBlck1lbnUpIHdyYXBwZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIHdyYXBwZXJNZW51LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTtcbiAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaWRlbmF2LW92ZXJsYXknKSkge1xuICAgICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgICAgc2lkZW5hdi5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9XG4gIH0pOyAvLyBFTkQgU2lkZW1lbnVcbiAgLy8gYWNjb3JkaW9uXG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhY2MubGVuZ3RoOyBpKyspIHtcbiAgICBhY2NbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgLyogVG9nZ2xlIGJldHdlZW4gYWRkaW5nIGFuZCByZW1vdmluZyB0aGUgXCJhY3RpdmVcIiBjbGFzcyxcbiAgICAgIHRvIGhpZ2hsaWdodCB0aGUgYnV0dG9uIHRoYXQgY29udHJvbHMgdGhlIHBhbmVsICovXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgICAgLyogVG9nZ2xlIGJldHdlZW4gaGlkaW5nIGFuZCBzaG93aW5nIHRoZSBhY3RpdmUgcGFuZWwgKi9cblxuICAgICAgdmFyIHBhbmVsID0gdGhpcy5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICBwYW5lbC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTtcbiAgICB9KTtcbiAgfSAvLyBFTkQgQWNjb3JkaW9uXG4gIC8vIHBlb3BsZUNhcmRcblxuXG4gIGZ1bmN0aW9uIHBlb3BsZUNhcmQoKSB7XG4gICAgdmFyIHBlb3BsZUNhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWF0ZXJpYWwtY2FyZCA+IC5tYy1idG4tYWN0aW9uJyk7XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcGVvcGxlQ2FyZC5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHBlb3BsZUNhcmRbX2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2FyZCA9IHRoaXMucGFyZW50Tm9kZTtcbiAgICAgICAgdmFyIGljb24gPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoJ2knKTtcbiAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1zcGluLWZhc3QnKTtcblxuICAgICAgICBpZiAoY2FyZC5jbGFzc0xpc3QuY29udGFpbnMoJ21jLWFjdGl2ZScpKSB7XG4gICAgICAgICAgY2FyZC5jbGFzc0xpc3QucmVtb3ZlKCdtYy1hY3RpdmUnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtYXJyb3ctbGVmdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1zcGluLWZhc3QnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtYmFycycpO1xuICAgICAgICAgIH0sIDgwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FyZC5jbGFzc0xpc3QuYWRkKCdtYy1hY3RpdmUnKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtYmFycycpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1zcGluLWZhc3QnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtYXJyb3ctbGVmdCcpO1xuICAgICAgICAgIH0sIDgwMCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHBlb3BsZUNhcmQoKTsgLy8gRU5EIFBlb3BsZUNhcmRcbiAgLy8gR2FsbGVyeVxuXG4gIGlmIChnYWxsZXJ5KSB7XG4gICAgYmFndWV0dGVCb3gucnVuKCcuZ2FsbGVyeS13cmFwJywge1xuICAgICAgYXN5bmM6IHRydWVcbiAgICB9KTtcbiAgfSAvLyBFTkQgR2FsbGVyeVxuICAvLyBGb3JtU3VibWl0XG5cblxuICB2YXIgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdmb3JtJyk7XG5cbiAgdmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoX2kyKSB7XG4gICAgZm9ybXNbX2kyXS5vbnN1Ym1pdCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgZm9ybXNbX2kyXS5jbGFzc0xpc3QuYWRkKCdzaWduZWQnKTtcbiAgICB9O1xuICB9O1xuXG4gIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGZvcm1zLmxlbmd0aDsgX2kyKyspIHtcbiAgICBfbG9vcChfaTIpO1xuICB9IC8vIEVORCBGb3JtU3VibWl0XG4gIC8vIEZpeGVkTmF2XG5cblxuICB2YXIgdG9wT2ZOYXYgPSBuYXYub2Zmc2V0VG9wO1xuXG4gIGZ1bmN0aW9uIGZpeE5hdigpIHtcbiAgICBpZiAod2luZG93LnNjcm9sbFkgPj0gdG9wT2ZOYXYpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IG5hdi5vZmZzZXRIZWlnaHQgKyAncHgnO1xuICAgICAgbmF2LmNsYXNzTGlzdC5hZGQoJ2ZpeGVkLW5hdicpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuYXYuY2xhc3NMaXN0LnJlbW92ZSgnZml4ZWQtbmF2Jyk7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmdUb3AgPSAwO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmaXhOYXYpOyAvLyBFTkQgRml4ZWROYXZcbiAgLy8gc2Nyb2xsLWRvd25cblxuICB2YXIgYnRuU2Nyb2xsRG93biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY3JvbGwtZG93bicpO1xuXG4gIGZ1bmN0aW9uIHNjcm9sbERvd24oKSB7XG4gICAgdmFyIHdpbmRvd0Nvb3JkcyA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSA1MDtcbiAgICBjb25zb2xlLmxvZyh3aW5kb3dDb29yZHMpO1xuXG4gICAgKGZ1bmN0aW9uIHNjcm9sbCgpIHtcbiAgICAgIGlmICh3aW5kb3cucGFnZVlPZmZzZXQgPCB3aW5kb3dDb29yZHMpIHtcbiAgICAgICAgd2luZG93LnNjcm9sbEJ5KDAsIDEwKTtcbiAgICAgICAgc2V0VGltZW91dChzY3JvbGwsIDApO1xuICAgICAgfVxuXG4gICAgICBpZiAod2luZG93LnBhZ2VZT2Zmc2V0ID4gd2luZG93Q29vcmRzKSB7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCB3aW5kb3dDb29yZHMpO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH1cblxuICBpZiAoYnRuU2Nyb2xsRG93bikge1xuICAgIGJ0blNjcm9sbERvd24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzY3JvbGxEb3duKTtcbiAgfSAvLyBFTkQgc2Nyb2xsLWRvd25cbiAgLy8gTWVudSBkcm9wZG93blxuXG5cbiAgdmFyIGRyb3Bkb3duSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZml4ZWQtd2lkdGgnKTtcblxuICB2YXIgX2xvb3AyID0gZnVuY3Rpb24gX2xvb3AyKF9pMykge1xuICAgIGRyb3Bkb3duSXRlbXNbX2kzXS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICAgIHZhciBzdWJNZW51ID0gZHJvcGRvd25JdGVtc1tfaTNdLnF1ZXJ5U2VsZWN0b3IoJy5tZW51Jyk7XG5cbiAgICAgICAgZHJvcGRvd25JdGVtc1tfaTNdLmNsYXNzTGlzdC50b2dnbGUoJ2ZpeGVkLXdpZHRoLS1zaG93Jyk7XG5cbiAgICAgICAgc3ViTWVudS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHN1Yk1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgZHJvcGRvd25JdGVtcy5sZW5ndGg7IF9pMysrKSB7XG4gICAgX2xvb3AyKF9pMyk7XG4gIH0gLy8gRU5EIE1lbnUgZHJvcGRvd25cbiAgLy8gQmxpbmRcblxuXG4gIHZhciBibGluZHRyaWdnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc3RhcmJsaW5kLXRyaWdnZXInKTtcbiAgdmFyIG1haW5XcmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4td3JhcHBlcicpO1xuICBibGluZHRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgbWFpbldyYXBwZXIuY2xhc3NMaXN0LnRvZ2dsZSgnc3RhcmJsaW5kJyk7XG4gICAgZG9jdW1lbnQucm9vO1xuICB9KTtcbn0pOyAvLyB2YXIgaHRtbEVsZW1lbnQgPSBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGU7XG4vLyBodG1sRWxlbWVudC5zdHlsZS5mb250U2l6ZSA9ICcyOHB4J1xuLy8gY29uc29sZS5sb2coaHRtbEVsZW1lbnQpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgYmFja1RvcCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ2pzLWNkLXRvcCcpWzBdO1xuICB2YXIgb2Zmc2V0ID0gMzAwO1xuICB2YXIgb2Zmc2V0T3BhY2l0eSA9IDEyMDA7XG4gIHZhciBzY3JvbGxEdXJhdGlvbiA9IDcwMDtcbiAgdmFyIHNjcm9sbGluZyA9IGZhbHNlO1xuXG4gIGlmIChiYWNrVG9wKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKCFzY3JvbGxpbmcpIHtcbiAgICAgICAgc2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyBzZXRUaW1lb3V0KGNoZWNrQmFja1RvVG9wLCAyNTApIDogd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjaGVja0JhY2tUb1RvcCk7XG4gICAgICB9XG4gICAgfSk7IC8vc21vb3RoIHNjcm9sbCB0byB0b3BcblxuICAgIGJhY2tUb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IHdpbmRvdy5zY3JvbGxUbygwLCAwKSA6IHNjcm9sbFRvcChzY3JvbGxEdXJhdGlvbik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0JhY2tUb1RvcCgpIHtcbiAgICB2YXIgd2luZG93VG9wID0gd2luZG93LnNjcm9sbFkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXQgPyBhZGRDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JykgOiByZW1vdmVDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JywgJ2NkLXRvcC0tZmFkZS1vdXQnKTtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXRPcGFjaXR5ICYmIGFkZENsYXNzKGJhY2tUb3AsICdjZC10b3AtLWZhZGUtb3V0Jyk7XG4gICAgc2Nyb2xsaW5nID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxUb3AoZHVyYXRpb24pIHtcbiAgICB2YXIgc3RhcnQgPSB3aW5kb3cuc2Nyb2xsWSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIHZhciBjdXJyZW50VGltZSA9IG51bGw7XG5cbiAgICB2YXIgYW5pbWF0ZVNjcm9sbCA9IGZ1bmN0aW9uIGFuaW1hdGVTY3JvbGwodGltZXN0YW1wKSB7XG4gICAgICBpZiAoIWN1cnJlbnRUaW1lKSBjdXJyZW50VGltZSA9IHRpbWVzdGFtcDtcbiAgICAgIHZhciBwcm9ncmVzcyA9IHRpbWVzdGFtcCAtIGN1cnJlbnRUaW1lO1xuICAgICAgdmFyIHZhbCA9IE1hdGgubWF4KE1hdGguZWFzZUluT3V0UXVhZChwcm9ncmVzcywgc3RhcnQsIC1zdGFydCwgZHVyYXRpb24pLCAwKTtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCB2YWwpO1xuXG4gICAgICBpZiAocHJvZ3Jlc3MgPCBkdXJhdGlvbikge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICB9XG5cbiAgTWF0aC5lYXNlSW5PdXRRdWFkID0gZnVuY3Rpb24gKHQsIGIsIGMsIGQpIHtcbiAgICB0IC89IGQgLyAyO1xuICAgIGlmICh0IDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKyBiO1xuICAgIHQtLTtcbiAgICByZXR1cm4gLWMgLyAyICogKHQgKiAodCAtIDIpIC0gMSkgKyBiO1xuICB9OyAvL2NsYXNzIG1hbmlwdWxhdGlvbnMgLSBuZWVkZWQgaWYgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWRcblxuXG4gIGZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSk7ZWxzZSByZXR1cm4gISFlbC5jbGFzc05hbWUubWF0Y2gobmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc05hbWUsIFwiKFxcXFxzfCQpXCIpKSk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgdmFyIGNsYXNzTGlzdCA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIGVsLmNsYXNzTGlzdC5hZGQoY2xhc3NMaXN0WzBdKTtlbHNlIGlmICghaGFzQ2xhc3MoZWwsIGNsYXNzTGlzdFswXSkpIGVsLmNsYXNzTmFtZSArPSBcIiBcIi5jb25jYXQoY2xhc3NMaXN0WzBdKTtcbiAgICBpZiAoY2xhc3NMaXN0Lmxlbmd0aCA+IDEpIGFkZENsYXNzKGVsLCBjbGFzc0xpc3Quc2xpY2UoMSkuam9pbignICcpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICB2YXIgY2xhc3NMaXN0ID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgZWwuY2xhc3NMaXN0LnJlbW92ZShjbGFzc0xpc3RbMF0pO2Vsc2UgaWYgKGhhc0NsYXNzKGVsLCBjbGFzc0xpc3RbMF0pKSB7XG4gICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc0xpc3RbMF0sIFwiKFxcXFxzfCQpXCIpKTtcbiAgICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKHJlZywgJyAnKTtcbiAgICB9XG4gICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPiAxKSByZW1vdmVDbGFzcyhlbCwgY2xhc3NMaXN0LnNsaWNlKDEpLmpvaW4oJyAnKSk7XG4gIH1cbn0pKCk7Il19
