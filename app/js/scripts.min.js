"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}window.addEventListener("load",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=q?(document.body.style.paddingTop=y.offsetHeight+"px",y.classList.add("fixed-nav")):(y.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}function o(){if(_.classList.contains("starblind")){var e=_toConsumableArray(j.querySelectorAll("button")),t=j.querySelector(".blind-fontSize--low"),o=j.querySelector(".blind-fontSize--normal"),n=j.querySelector(".blind-fontSize--big"),s=document.querySelector("html"),a=window.getComputedStyle(s,null).getPropertyValue("font-size"),r=parseFloat(a);console.log(r),e.forEach(function(t){t.addEventListener("click",function(){e.filter(function(e){return t.getAttribute("data-group")==e.getAttribute("data-group")}).map(function(e){_.classList.remove(e.getAttribute("data-test"))}),t.hasAttribute("data-test")&&_.classList.add(t.getAttribute("data-test"))})}),t.onclick=function(){s.style.fontSize=r-2+"px"},o.onclick=function(){s.style.fontSize=r+"px"},n.onclick=function(){s.style.fontSize=r+6+"px"}}}var n=document.getElementById("preloader");n&&setTimeout(function(){n.classList.add("active"),document.body.style.overflow="visible"},100);var s=document.querySelector(".js-hero-slider"),a=document.querySelector(".blog-slider"),r=document.querySelector(".news-slider"),i=document.getElementById("map"),l=document.querySelector(".js-header-info__writeToUs-link"),c=document.querySelector(".modal"),d=c.querySelector(".modal-close__btn"),u=c.querySelector("[name=login]"),m=document.querySelector(".wrapper-menu"),f=document.querySelector(".js-sidenav"),g=document.querySelector(".sidenav-overlay"),p=document.getElementsByClassName("acc-header"),w=document.querySelector(".testimonials-slider"),v=document.querySelector(".gallery"),y=document.querySelector("#nav-main");if(function(){var e=document.querySelector(".modal-overlay");l.addEventListener("click",function(t){t.preventDefault(),c.classList.toggle("modal-show"),e.classList.toggle("show"),u.focus()}),d.addEventListener("click",function(t){t.preventDefault(),c.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(c.classList.remove("modal-show"),e.classList.toggle("show"))})}(),s){new Swiper(".swiper-container",{loop:!0,parallax:!0,autoplay:{delay:5e3},speed:1e3,mousewheelControl:!0})}if(a){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(r){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"3",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1230:{slidesPerView:3},900:{slidesPerView:2},650:{slidesPerView:1,spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(w){new Swiper(w,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}if(i){var L=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(L)}setTimeout(e,100),m&&m.addEventListener("click",function(){m.classList.toggle("open"),f.classList.toggle("show"),g.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(m.classList.toggle("open"),f.classList.toggle("show"),g.classList.toggle("show"))});for(var b=0;b<p.length;b++)p[b].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),v&&baguetteBox.run(".gallery-wrap",{async:!0});for(var S=document.querySelectorAll("form"),h=0;h<S.length;h++)!function(e){S[e].onsubmit=function(t){t.preventDefault(),S[e].classList.add("signed")}}(h);var q=y.offsetTop;window.addEventListener("scroll",t);for(var E=document.querySelectorAll(".fixed-width"),A=0;A<E.length;A++)!function(e){E[e].addEventListener("keyup",function(t){if(13===t.keyCode){var o=E[e].querySelector(".menu");E[e].classList.toggle("fixed-width--show"),o.addEventListener("blur",function(){o.style.display="none"})}})}(A);var k=document.querySelector(".js-starblind-trigger"),_=document.querySelector(".main-wrapper"),T=document.querySelectorAll(".js-sliderNews--blind"),x=document.querySelector(".js-blindTestimonials"),C=document.querySelector(".js-organizationBlind"),j=document.querySelector(".js-blindHeaderPanel");if(!localStorage.getItem("blindClasses")){var B=["font1","kerning1","color1"],z=JSON.stringify(B);localStorage.setItem("blindClasses",z);for(var I=0;I<B.length;I++)_.classList.add(B[I])}k.addEventListener("click",function(){if(j.classList.toggle("blindHeaderPanel--show"),_.classList.toggle("starblind"),x&&x.classList.toggle("cd-testimonials__blind--show"),T)for(var e=0;e<T.length;e++)T[e].classList.toggle("blindSliderNews--show");C&&C.classList.toggle("organizations-main__wrapper--blind"),o()})}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>r?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>i&&n(a,"cd-top--fade-out"),l=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,r=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,r),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],r=300,i=1200,l=!1;a&&(window.addEventListener("scroll",function(t){l||(l=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJfdG9Db25zdW1hYmxlQXJyYXkiLCJhcnIiLCJfYXJyYXlXaXRob3V0SG9sZXMiLCJfaXRlcmFibGVUb0FycmF5IiwiX25vbkl0ZXJhYmxlU3ByZWFkIiwiVHlwZUVycm9yIiwiaXRlciIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwiQXJyYXkiLCJmcm9tIiwiaXNBcnJheSIsImkiLCJhcnIyIiwibGVuZ3RoIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImFkZFRpbWVGb290ZXIiLCJkYXRlIiwiRGF0ZSIsIm9wdGlvbnMiLCJ5ZWFyIiwibW9udGgiLCJkYXkiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJ0b0xvY2FsZVN0cmluZyIsImZpeE5hdiIsInNjcm9sbFkiLCJ0b3BPZk5hdiIsImJvZHkiLCJzdHlsZSIsInBhZGRpbmdUb3AiLCJuYXYiLCJvZmZzZXRIZWlnaHQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJ0ZXN0IiwiY29udGFpbnMiLCJidXR0b25zIiwiYmxpbmRQYW5lbCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25Mb3dGb250U2l6ZSIsImJ1dHRvbk5vcm1hbEZvbnRTaXplIiwiYnV0dG9uQmlnRm9udFNpemUiLCJodG1sRWxlbSIsImdldENvbXB1dGVkU3R5bGUiLCJnZXRQcm9wZXJ0eVZhbHVlIiwiZGVmYXVsdEZvbnRTaXplIiwicGFyc2VGbG9hdCIsImNvbnNvbGUiLCJsb2ciLCJmb3JFYWNoIiwiYnV0dG9uIiwiZmlsdGVyIiwib2JqIiwiZ2V0QXR0cmlidXRlIiwibWFwIiwiaGFzQXR0cmlidXRlIiwib25jbGljayIsImZvbnRTaXplIiwicHJlbG9hZGVyIiwiZ2V0RWxlbWVudEJ5SWQiLCJzZXRUaW1lb3V0Iiwib3ZlcmZsb3ciLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ3cmFwcGVyTWVudSIsInNpZGVuYXYiLCJvdmVybGF5IiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsInRlc3RpbW9uaWFsc1NsaWRlciIsImdhbGxlcnkiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidG9nZ2xlIiwiZm9jdXMiLCJlIiwidGFyZ2V0IiwiU3dpcGVyIiwibG9vcCIsInBhcmFsbGF4IiwiYXV0b3BsYXkiLCJkZWxheSIsInNwZWVkIiwibW91c2V3aGVlbENvbnRyb2wiLCJzcGFjZUJldHdlZW4iLCJlZmZlY3QiLCJncmFiQ3Vyc29yIiwicGFnaW5hdGlvbiIsImVsIiwiY2xpY2thYmxlIiwiY2VudGVyZWRTbGlkZXMiLCJrZXlib2FyZCIsInNsaWRlc1BlclZpZXciLCJjb3ZlcmZsb3dFZmZlY3QiLCJyb3RhdGUiLCJzdHJldGNoIiwiZGVwdGgiLCJtb2RpZmllciIsInNsaWRlU2hhZG93cyIsImJyZWFrcG9pbnRzIiwiMTIzMCIsIjkwMCIsIjY1MCIsInNpbXVsYXRlVG91Y2giLCJuYXZpZ2F0aW9uIiwibmV4dEVsIiwicHJldkVsIiwiYXV0b0hlaWdodCIsImluaXQiLCJteU1hcCIsInltYXBzIiwiTWFwIiwiY2VudGVyIiwiY29udHJvbHMiLCJ6b29tIiwiZ2V0Iiwicm91dGVQYW5lbCIsInN0YXRlIiwic2V0IiwibXlQbGFjZW1hcmsiLCJQbGFjZW1hcmsiLCJoaW50Q29udGVudCIsImJhbGxvb25Db250ZW50IiwicHJlc2V0IiwiZ2VvT2JqZWN0cyIsInJlYWR5IiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsInBlb3BsZUNhcmQiLCJfaSIsImNhcmQiLCJwYXJlbnROb2RlIiwiaWNvbiIsImJhZ3VldHRlQm94IiwicnVuIiwiYXN5bmMiLCJmb3JtcyIsIl9pMiIsIm9uc3VibWl0Iiwib2Zmc2V0VG9wIiwiZHJvcGRvd25JdGVtcyIsIl9pMyIsImtleUNvZGUiLCJzdWJNZW51IiwiZGlzcGxheSIsImJsaW5kdHJpZ2dlciIsInNsaWRlck5ld3NCbGluZCIsInRlc3RpbW9uYWxzQmxpbmQiLCJvcmdhbml6YXRpb25CbGluZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJjbGFzc0FyciIsIkpTT04iLCJzdHJpbmdpZnkiLCJzZXRJdGVtIiwiX2k0IiwiX2k1IiwiY2hlY2tCYWNrVG9Ub3AiLCJ3aW5kb3dUb3AiLCJkb2N1bWVudEVsZW1lbnQiLCJzY3JvbGxUb3AiLCJvZmZzZXQiLCJhZGRDbGFzcyIsImJhY2tUb3AiLCJyZW1vdmVDbGFzcyIsIm9mZnNldE9wYWNpdHkiLCJzY3JvbGxpbmciLCJkdXJhdGlvbiIsInN0YXJ0IiwiY3VycmVudFRpbWUiLCJhbmltYXRlU2Nyb2xsIiwidGltZXN0YW1wIiwicHJvZ3Jlc3MiLCJ2YWwiLCJNYXRoIiwibWF4IiwiZWFzZUluT3V0UXVhZCIsInNjcm9sbFRvIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiaGFzQ2xhc3MiLCJjbGFzc05hbWUiLCJtYXRjaCIsIlJlZ0V4cCIsImNvbmNhdCIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwicmVnIiwicmVwbGFjZSIsInQiLCJiIiwiYyIsImQiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUEsU0FBQUEsb0JBQUFDLEdBQUEsTUFBQUMsb0JBQUFELElBQUFFLGlCQUFBRixJQUFBRyxxQkFFQSxRQUFBQSxzQkFBQSxLQUFBLElBQUFDLFdBQUEsbURBRUEsUUFBQUYsa0JBQUFHLEdBQUEsR0FBQUMsT0FBQUMsV0FBQUMsUUFBQUgsSUFBQSx1QkFBQUcsT0FBQUMsVUFBQUMsU0FBQUMsS0FBQU4sR0FBQSxNQUFBTyxPQUFBQyxLQUFBUixHQUVBLFFBQUFKLG9CQUFBRCxHQUFBLEdBQUFZLE1BQUFFLFFBQUFkLEdBQUEsQ0FBQSxJQUFBLEdBQUFlLEdBQUEsRUFBQUMsRUFBQSxHQUFBSixPQUFBWixFQUFBaUIsUUFBQUYsRUFBQWYsRUFBQWlCLE9BQUFGLElBQUFDLEVBQUFE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O1xuXG5mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH1cblxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2VcIik7IH1cblxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7IGlmIChTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KGl0ZXIpIHx8IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVyKSA9PT0gXCJbb2JqZWN0IEFyZ3VtZW50c11cIikgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7IH1cblxuZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikgeyBpZiAoQXJyYXkuaXNBcnJheShhcnIpKSB7IGZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGFyci5sZW5ndGgpOyBpIDwgYXJyLmxlbmd0aDsgaSsrKSB7IGFycjJbaV0gPSBhcnJbaV07IH0gcmV0dXJuIGFycjI7IH0gfVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIGZ1bmN0aW9uICgpIHtcbiAgLy8gcHJlbG9hZGVyXG4gIHZhciBwcmVsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlbG9hZGVyJyk7XG5cbiAgaWYgKHByZWxvYWRlcikge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgcHJlbG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICd2aXNpYmxlJztcbiAgICB9LCAxMDApO1xuICB9IC8vIEVORCBQcmVsb2FkZXJcblxuXG4gIHZhciBzbGlkZXJDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtaGVyby1zbGlkZXInKTtcbiAgdmFyIGJsb2dTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvZy1zbGlkZXInKTtcbiAgdmFyIG5ld3NTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3cy1zbGlkZXInKTtcbiAgdmFyIG1hcENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcbiAgdmFyIGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtaGVhZGVyLWluZm9fX3dyaXRlVG9Vcy1saW5rJyk7XG4gIHZhciBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtY2xvc2VfX2J0bicpO1xuICB2YXIgbG9naW4gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKCdbbmFtZT1sb2dpbl0nKTtcbiAgdmFyIHdyYXBwZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXItbWVudScpO1xuICB2YXIgc2lkZW5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1zaWRlbmF2Jyk7XG4gIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGVuYXYtb3ZlcmxheScpO1xuICB2YXIgYWNjID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWNjLWhlYWRlcicpO1xuICB2YXIgdGVzdGltb25pYWxzU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlc3RpbW9uaWFscy1zbGlkZXInKTtcbiAgdmFyIGdhbGxlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FsbGVyeScpO1xuICB2YXIgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi1tYWluJyk7IC8vIE1vZGFsXG5cbiAgdmFyIG1vZGFsID0gZnVuY3Rpb24gbW9kYWwoKSB7XG4gICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwtb3ZlcmxheScpO1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QudG9nZ2xlKCdtb2RhbC1zaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIGxvZ2luLmZvY3VzKCk7XG4gICAgfSk7XG4gICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbC1zaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbC1vdmVybGF5JykpIHtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWwtc2hvdycpO1xuICAgICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBtb2RhbCgpOyAvLyBFTkQgTW9kYWxcbiAgLy8gU2xpZGVyc1xuXG4gIGlmIChzbGlkZXJDb250YWluZXIpIHtcbiAgICB2YXIgbXlTd2lwZXIgPSBuZXcgU3dpcGVyKCcuc3dpcGVyLWNvbnRhaW5lcicsIHtcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBwYXJhbGxheDogdHJ1ZSxcbiAgICAgIGF1dG9wbGF5OiB7XG4gICAgICAgIGRlbGF5OiA1MDAwXG4gICAgICB9LFxuICAgICAgc3BlZWQ6IDEwMDAsXG4gICAgICBtb3VzZXdoZWVsQ29udHJvbDogdHJ1ZVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGJsb2dTbGlkZXIpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcignLmJsb2ctc2xpZGVyJywge1xuICAgICAgc3BhY2VCZXR3ZWVuOiAzMCxcbiAgICAgIGVmZmVjdDogJ2ZhZGUnLFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgIGdyYWJDdXJzb3I6IHRydWUsXG4gICAgICBhdXRvcGxheToge1xuICAgICAgICBkZWxheTogNzAwMFxuICAgICAgfSxcbiAgICAgIC8vIGF1dG9IZWlnaHQ6IHRydWUsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLmJsb2ctc2xpZGVyX19wYWdpbmF0aW9uJyxcbiAgICAgICAgY2xpY2thYmxlOiB0cnVlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpZiAobmV3c1NsaWRlcikge1xuICAgIHZhciBuZXdzU3dpcGVyID0gbmV3IFN3aXBlcignLm5ld3Mtc2xpZGVyJywge1xuICAgICAgZWZmZWN0OiAnY292ZXJmbG93JyxcbiAgICAgIGdyYWJDdXJzb3I6IHRydWUsXG4gICAgICBsb29wOiBmYWxzZSxcbiAgICAgIGNlbnRlcmVkU2xpZGVzOiBmYWxzZSxcbiAgICAgIGtleWJvYXJkOiB0cnVlLFxuICAgICAgc3BhY2VCZXR3ZWVuOiAxMCxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICczJyxcbiAgICAgIHNwZWVkOiAzMDAsXG4gICAgICBjb3ZlcmZsb3dFZmZlY3Q6IHtcbiAgICAgICAgcm90YXRlOiAwLFxuICAgICAgICBzdHJldGNoOiAwLFxuICAgICAgICBkZXB0aDogMCxcbiAgICAgICAgbW9kaWZpZXI6IDEsXG4gICAgICAgIHNsaWRlU2hhZG93czogZmFsc2VcbiAgICAgIH0sXG4gICAgICBicmVha3BvaW50czoge1xuICAgICAgICAxMjMwOiB7XG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogM1xuICAgICAgICB9LFxuICAgICAgICA5MDA6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAyXG4gICAgICAgIH0sXG4gICAgICAgIDY1MDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICAgIGNlbnRlcmVkU2xpZGVzOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzaW11bGF0ZVRvdWNoOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcubmV3cy1zbGlkZXItbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5uZXdzLXNsaWRlci1wcmV2J1xuICAgICAgfSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcubmV3cy1zbGlkZXJfX3BhZ2luYXRpb24nLFxuICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmICh0ZXN0aW1vbmlhbHNTbGlkZXIpIHtcbiAgICB2YXIgZmVlZFN3aXBlciA9IG5ldyBTd2lwZXIodGVzdGltb25pYWxzU2xpZGVyLCB7XG4gICAgICBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgbG9vcDogdHJ1ZSxcbiAgICAgIG5hdmlnYXRpb246IHtcbiAgICAgICAgbmV4dEVsOiAnLnN3aXBlci1idXR0b24tbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5zd2lwZXItYnV0dG9uLXByZXYnXG4gICAgICB9XG4gICAgfSk7XG4gIH0gLy8gRU5EIFNsaWRlcnNcbiAgLy8gTWFwXG5cblxuICBpZiAobWFwQ29udGFpbmVyKSB7XG4gICAgdmFyIGluaXQgPSBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgdmFyIG15TWFwID0gbmV3IHltYXBzLk1hcCgnbWFwJywge1xuICAgICAgICBjZW50ZXI6IFs0Ny41Mzk2LCA0Mi4wMTUxXSxcbiAgICAgICAgY29udHJvbHM6IFsndHlwZVNlbGVjdG9yJywgJ2Z1bGxzY3JlZW5Db250cm9sJywgJ2dlb2xvY2F0aW9uQ29udHJvbCcsICdydWxlckNvbnRyb2wnLCAncm91dGVCdXR0b25Db250cm9sJ10sXG4gICAgICAgIHpvb206IDE2XG4gICAgICB9KTtcbiAgICAgIHZhciBjb250cm9sID0gbXlNYXAuY29udHJvbHMuZ2V0KCdyb3V0ZUJ1dHRvbkNvbnRyb2wnKTtcbiAgICAgIGNvbnRyb2wucm91dGVQYW5lbC5zdGF0ZS5zZXQoJ2Zyb20nLCAn0KDQvtC80LDQvdC+0LLRgdC60LDRjyDRgdC+0Y7Qt9C90YvQuSA5N9CwJyk7XG4gICAgICB2YXIgbXlQbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs0Ny41Mzk4LCA0Mi4wMTUzXSwge1xuICAgICAgICBoaW50Q29udGVudDogJ9Cj0LsuINCh0L7RjtC30L3QsNGPIDk30LAnLFxuICAgICAgICBiYWxsb29uQ29udGVudDogJ9Cf0L7Qu9C40LrQu9C40L3QuNC60LAnXG4gICAgICB9LCB7XG4gICAgICAgIHByZXNldDogJ2lzbGFuZHMjYmx1ZU1lZGljYWxJY29uJ1xuICAgICAgfSk7XG4gICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XG4gICAgfTtcblxuICAgIHltYXBzLnJlYWR5KGluaXQpO1xuICB9IC8vIEVORCBNYXBcbiAgLy8gVGltZSB0byBmb290ZXJcblxuXG4gIGZ1bmN0aW9uIGFkZFRpbWVGb290ZXIoKSB7XG4gICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgeWVhcjogJ251bWVyaWMnLFxuICAgICAgbW9udGg6ICdsb25nJyxcbiAgICAgIGRheTogJ251bWVyaWMnXG4gICAgfTtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWZvb3Rlci1pbmZvX19kYXRlJyk7XG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoJ3J1Jywgb3B0aW9ucyk7XG4gIH1cblxuICBzZXRUaW1lb3V0KGFkZFRpbWVGb290ZXIsIDEwMCk7IC8vIEVORCBUaW1lIHRvIGZvb3RlclxuICAvLyBTaWRlbWVudVxuXG4gIGlmICh3cmFwcGVyTWVudSkgd3JhcHBlck1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgIHNpZGVuYXYuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICB9KTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3NpZGVuYXYtb3ZlcmxheScpKSB7XG4gICAgICB3cmFwcGVyTWVudS5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJyk7XG4gICAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgIH1cbiAgfSk7IC8vIEVORCBTaWRlbWVudVxuICAvLyBhY2NvcmRpb25cblxuICBmb3IgKHZhciBpID0gMDsgaSA8IGFjYy5sZW5ndGg7IGkrKykge1xuICAgIGFjY1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBhZGRpbmcgYW5kIHJlbW92aW5nIHRoZSBcImFjdGl2ZVwiIGNsYXNzLFxuICAgICAgdG8gaGlnaGxpZ2h0IHRoZSBidXR0b24gdGhhdCBjb250cm9scyB0aGUgcGFuZWwgKi9cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBoaWRpbmcgYW5kIHNob3dpbmcgdGhlIGFjdGl2ZSBwYW5lbCAqL1xuXG4gICAgICB2YXIgcGFuZWwgPSB0aGlzLm5leHRFbGVtZW50U2libGluZztcbiAgICAgIHBhbmVsLmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpO1xuICAgIH0pO1xuICB9IC8vIEVORCBBY2NvcmRpb25cbiAgLy8gcGVvcGxlQ2FyZFxuXG5cbiAgZnVuY3Rpb24gcGVvcGxlQ2FyZCgpIHtcbiAgICB2YXIgcGVvcGxlQ2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYXRlcmlhbC1jYXJkID4gLm1jLWJ0bi1hY3Rpb24nKTtcblxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBwZW9wbGVDYXJkLmxlbmd0aDsgX2krKykge1xuICAgICAgcGVvcGxlQ2FyZFtfaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjYXJkID0gdGhpcy5wYXJlbnROb2RlO1xuICAgICAgICB2YXIgaWNvbiA9IHRoaXMucXVlcnlTZWxlY3RvcignaScpO1xuICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLXNwaW4tZmFzdCcpO1xuXG4gICAgICAgIGlmIChjYXJkLmNsYXNzTGlzdC5jb250YWlucygnbWMtYWN0aXZlJykpIHtcbiAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5yZW1vdmUoJ21jLWFjdGl2ZScpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1hcnJvdy1sZWZ0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLXNwaW4tZmFzdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1iYXJzJyk7XG4gICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ21jLWFjdGl2ZScpO1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QucmVtb3ZlKCdmYS1iYXJzJyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLXNwaW4tZmFzdCcpO1xuICAgICAgICAgICAgaWNvbi5jbGFzc0xpc3QuYWRkKCdmYS1hcnJvdy1sZWZ0Jyk7XG4gICAgICAgICAgfSwgODAwKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcGVvcGxlQ2FyZCgpOyAvLyBFTkQgUGVvcGxlQ2FyZFxuICAvLyBHYWxsZXJ5XG5cbiAgaWYgKGdhbGxlcnkpIHtcbiAgICBiYWd1ZXR0ZUJveC5ydW4oJy5nYWxsZXJ5LXdyYXAnLCB7XG4gICAgICBhc3luYzogdHJ1ZVxuICAgIH0pO1xuICB9IC8vIEVORCBHYWxsZXJ5XG4gIC8vIEZvcm1TdWJtaXRcblxuXG4gIHZhciBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKTtcblxuICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChfaTIpIHtcbiAgICBmb3Jtc1tfaTJdLm9uc3VibWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBmb3Jtc1tfaTJdLmNsYXNzTGlzdC5hZGQoJ3NpZ25lZCcpO1xuICAgIH07XG4gIH07XG5cbiAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgZm9ybXMubGVuZ3RoOyBfaTIrKykge1xuICAgIF9sb29wKF9pMik7XG4gIH0gLy8gRU5EIEZvcm1TdWJtaXRcbiAgLy8gRml4ZWROYXZcblxuXG4gIHZhciB0b3BPZk5hdiA9IG5hdi5vZmZzZXRUb3A7XG5cbiAgZnVuY3Rpb24gZml4TmF2KCkge1xuICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+PSB0b3BPZk5hdikge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nVG9wID0gbmF2Lm9mZnNldEhlaWdodCArICdweCc7XG4gICAgICBuYXYuY2xhc3NMaXN0LmFkZCgnZml4ZWQtbmF2Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZC1uYXYnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IDA7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZpeE5hdik7IC8vIEVORCBGaXhlZE5hdlxuICAvLyBNZW51IGRyb3Bkb3duXG5cbiAgdmFyIGRyb3Bkb3duSXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZml4ZWQtd2lkdGgnKTtcblxuICB2YXIgX2xvb3AyID0gZnVuY3Rpb24gX2xvb3AyKF9pMykge1xuICAgIGRyb3Bkb3duSXRlbXNbX2kzXS5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICAgIHZhciBzdWJNZW51ID0gZHJvcGRvd25JdGVtc1tfaTNdLnF1ZXJ5U2VsZWN0b3IoJy5tZW51Jyk7XG5cbiAgICAgICAgZHJvcGRvd25JdGVtc1tfaTNdLmNsYXNzTGlzdC50b2dnbGUoJ2ZpeGVkLXdpZHRoLS1zaG93Jyk7XG5cbiAgICAgICAgc3ViTWVudS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHN1Yk1lbnUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgZHJvcGRvd25JdGVtcy5sZW5ndGg7IF9pMysrKSB7XG4gICAgX2xvb3AyKF9pMyk7XG4gIH0gLy8gRU5EIE1lbnUgZHJvcGRvd25cbiAgLy8gQmxpbmRcblxuXG4gIHZhciBibGluZHRyaWdnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtc3RhcmJsaW5kLXRyaWdnZXInKTtcbiAgdmFyIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbi13cmFwcGVyJyk7XG4gIHZhciBzbGlkZXJOZXdzQmxpbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuanMtc2xpZGVyTmV3cy0tYmxpbmQnKTtcbiAgdmFyIHRlc3RpbW9uYWxzQmxpbmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtYmxpbmRUZXN0aW1vbmlhbHMnKTtcbiAgdmFyIG9yZ2FuaXphdGlvbkJsaW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLW9yZ2FuaXphdGlvbkJsaW5kJyk7XG4gIHZhciBibGluZFBhbmVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWJsaW5kSGVhZGVyUGFuZWwnKTtcblxuICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYmxpbmRDbGFzc2VzXCIpKSB7XG4gICAgdmFyIGFyciA9IFsnZm9udDEnLCAna2VybmluZzEnLCAnY29sb3IxJ107XG4gICAgdmFyIGNsYXNzQXJyID0gSlNPTi5zdHJpbmdpZnkoYXJyKTtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYmxpbmRDbGFzc2VzJywgY2xhc3NBcnIpO1xuXG4gICAgZm9yICh2YXIgX2k0ID0gMDsgX2k0IDwgYXJyLmxlbmd0aDsgX2k0KyspIHtcbiAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZChhcnJbX2k0XSk7XG4gICAgfVxuICB9XG5cbiAgYmxpbmR0cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGJsaW5kUGFuZWwuY2xhc3NMaXN0LnRvZ2dsZSgnYmxpbmRIZWFkZXJQYW5lbC0tc2hvdycpO1xuICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnc3RhcmJsaW5kJyk7XG5cbiAgICBpZiAodGVzdGltb25hbHNCbGluZCkge1xuICAgICAgdGVzdGltb25hbHNCbGluZC5jbGFzc0xpc3QudG9nZ2xlKCdjZC10ZXN0aW1vbmlhbHNfX2JsaW5kLS1zaG93Jyk7XG4gICAgfVxuXG4gICAgaWYgKHNsaWRlck5ld3NCbGluZCkge1xuICAgICAgZm9yICh2YXIgX2k1ID0gMDsgX2k1IDwgc2xpZGVyTmV3c0JsaW5kLmxlbmd0aDsgX2k1KyspIHtcbiAgICAgICAgc2xpZGVyTmV3c0JsaW5kW19pNV0uY2xhc3NMaXN0LnRvZ2dsZSgnYmxpbmRTbGlkZXJOZXdzLS1zaG93Jyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9yZ2FuaXphdGlvbkJsaW5kKSB7XG4gICAgICBvcmdhbml6YXRpb25CbGluZC5jbGFzc0xpc3QudG9nZ2xlKCdvcmdhbml6YXRpb25zLW1haW5fX3dyYXBwZXItLWJsaW5kJyk7XG4gICAgfVxuXG4gICAgdGVzdCgpO1xuICB9KTtcblxuICBmdW5jdGlvbiB0ZXN0KCkge1xuICAgIGlmIChib2R5LmNsYXNzTGlzdC5jb250YWlucygnc3RhcmJsaW5kJykpIHtcbiAgICAgIHZhciBidXR0b25zID0gX3RvQ29uc3VtYWJsZUFycmF5KGJsaW5kUGFuZWwucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJykpO1xuXG4gICAgICB2YXIgYnV0dG9uTG93Rm9udFNpemUgPSBibGluZFBhbmVsLnF1ZXJ5U2VsZWN0b3IoJy5ibGluZC1mb250U2l6ZS0tbG93Jyk7XG4gICAgICB2YXIgYnV0dG9uTm9ybWFsRm9udFNpemUgPSBibGluZFBhbmVsLnF1ZXJ5U2VsZWN0b3IoJy5ibGluZC1mb250U2l6ZS0tbm9ybWFsJyk7XG4gICAgICB2YXIgYnV0dG9uQmlnRm9udFNpemUgPSBibGluZFBhbmVsLnF1ZXJ5U2VsZWN0b3IoJy5ibGluZC1mb250U2l6ZS0tYmlnJyk7XG4gICAgICB2YXIgaHRtbEVsZW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdodG1sJyk7XG4gICAgICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShodG1sRWxlbSwgbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZSgnZm9udC1zaXplJyk7XG4gICAgICB2YXIgZGVmYXVsdEZvbnRTaXplID0gcGFyc2VGbG9hdChzdHlsZSk7IC8vIG5vdyB5b3UgaGF2ZSBhIHByb3BlciBmbG9hdCBmb3IgdGhlIGZvbnQgc2l6ZSAoeWVzLCBpdCBjYW4gYmUgYSBmbG9hdCwgbm90IGp1c3QgYW4gaW50ZWdlcilcbiAgICAgIC8vIGh0bWxFbGVtLnN0eWxlLmZvbnRTaXplID0gKGRlZmF1bHRGb250U2l6ZSArIDEwKSArICdweCc7XG5cbiAgICAgIGNvbnNvbGUubG9nKGRlZmF1bHRGb250U2l6ZSk7XG4gICAgICBidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgYnV0dG9ucy5maWx0ZXIoZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5nZXRBdHRyaWJ1dGUoJ2RhdGEtZ3JvdXAnKSA9PSBvYmouZ2V0QXR0cmlidXRlKCdkYXRhLWdyb3VwJyk7XG4gICAgICAgICAgfSkubWFwKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZShvYmouZ2V0QXR0cmlidXRlKCdkYXRhLXRlc3QnKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpZiAoYnV0dG9uLmhhc0F0dHJpYnV0ZSgnZGF0YS10ZXN0JykpIHtcbiAgICAgICAgICAgIGJvZHkuY2xhc3NMaXN0LmFkZChidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLXRlc3QnKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBidXR0b25Mb3dGb250U2l6ZS5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBodG1sRWxlbS5zdHlsZS5mb250U2l6ZSA9IGRlZmF1bHRGb250U2l6ZSAtIDIgKyAncHgnO1xuICAgICAgfTtcblxuICAgICAgYnV0dG9uTm9ybWFsRm9udFNpemUub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaHRtbEVsZW0uc3R5bGUuZm9udFNpemUgPSBkZWZhdWx0Rm9udFNpemUgKyAncHgnO1xuICAgICAgfTtcblxuICAgICAgYnV0dG9uQmlnRm9udFNpemUub25jbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaHRtbEVsZW0uc3R5bGUuZm9udFNpemUgPSBkZWZhdWx0Rm9udFNpemUgKyA2ICsgJ3B4JztcbiAgICAgIH07XG4gICAgfVxuICB9XG59KTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGJhY2tUb3AgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdqcy1jZC10b3AnKVswXTtcbiAgdmFyIG9mZnNldCA9IDMwMDtcbiAgdmFyIG9mZnNldE9wYWNpdHkgPSAxMjAwO1xuICB2YXIgc2Nyb2xsRHVyYXRpb24gPSA3MDA7XG4gIHZhciBzY3JvbGxpbmcgPSBmYWxzZTtcblxuICBpZiAoYmFja1RvcCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICghc2Nyb2xsaW5nKSB7XG4gICAgICAgIHNjcm9sbGluZyA9IHRydWU7XG4gICAgICAgICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gc2V0VGltZW91dChjaGVja0JhY2tUb1RvcCwgMjUwKSA6IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2hlY2tCYWNrVG9Ub3ApO1xuICAgICAgfVxuICAgIH0pOyAvL3Ntb290aCBzY3JvbGwgdG8gdG9wXG5cbiAgICBiYWNrVG9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyB3aW5kb3cuc2Nyb2xsVG8oMCwgMCkgOiBzY3JvbGxUb3Aoc2Nyb2xsRHVyYXRpb24pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tCYWNrVG9Ub3AoKSB7XG4gICAgdmFyIHdpbmRvd1RvcCA9IHdpbmRvdy5zY3JvbGxZIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgd2luZG93VG9wID4gb2Zmc2V0ID8gYWRkQ2xhc3MoYmFja1RvcCwgJ2NkLXRvcC0tc2hvdycpIDogcmVtb3ZlQ2xhc3MoYmFja1RvcCwgJ2NkLXRvcC0tc2hvdycsICdjZC10b3AtLWZhZGUtb3V0Jyk7XG4gICAgd2luZG93VG9wID4gb2Zmc2V0T3BhY2l0eSAmJiBhZGRDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1mYWRlLW91dCcpO1xuICAgIHNjcm9sbGluZyA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gc2Nyb2xsVG9wKGR1cmF0aW9uKSB7XG4gICAgdmFyIHN0YXJ0ID0gd2luZG93LnNjcm9sbFkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB2YXIgY3VycmVudFRpbWUgPSBudWxsO1xuXG4gICAgdmFyIGFuaW1hdGVTY3JvbGwgPSBmdW5jdGlvbiBhbmltYXRlU2Nyb2xsKHRpbWVzdGFtcCkge1xuICAgICAgaWYgKCFjdXJyZW50VGltZSkgY3VycmVudFRpbWUgPSB0aW1lc3RhbXA7XG4gICAgICB2YXIgcHJvZ3Jlc3MgPSB0aW1lc3RhbXAgLSBjdXJyZW50VGltZTtcbiAgICAgIHZhciB2YWwgPSBNYXRoLm1heChNYXRoLmVhc2VJbk91dFF1YWQocHJvZ3Jlc3MsIHN0YXJ0LCAtc3RhcnQsIGR1cmF0aW9uKSwgMCk7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgdmFsKTtcblxuICAgICAgaWYgKHByb2dyZXNzIDwgZHVyYXRpb24pIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlU2Nyb2xsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlU2Nyb2xsKTtcbiAgfVxuXG4gIE1hdGguZWFzZUluT3V0UXVhZCA9IGZ1bmN0aW9uICh0LCBiLCBjLCBkKSB7XG4gICAgdCAvPSBkIC8gMjtcbiAgICBpZiAodCA8IDEpIHJldHVybiBjIC8gMiAqIHQgKiB0ICsgYjtcbiAgICB0LS07XG4gICAgcmV0dXJuIC1jIC8gMiAqICh0ICogKHQgLSAyKSAtIDEpICsgYjtcbiAgfTsgLy9jbGFzcyBtYW5pcHVsYXRpb25zIC0gbmVlZGVkIGlmIGNsYXNzTGlzdCBpcyBub3Qgc3VwcG9ydGVkXG5cblxuICBmdW5jdGlvbiBoYXNDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgcmV0dXJuIGVsLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpO2Vsc2UgcmV0dXJuICEhZWwuY2xhc3NOYW1lLm1hdGNoKG5ldyBSZWdFeHAoXCIoXFxcXHN8XilcIi5jb25jYXQoY2xhc3NOYW1lLCBcIihcXFxcc3wkKVwiKSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xuICAgIHZhciBjbGFzc0xpc3QgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSBlbC5jbGFzc0xpc3QuYWRkKGNsYXNzTGlzdFswXSk7ZWxzZSBpZiAoIWhhc0NsYXNzKGVsLCBjbGFzc0xpc3RbMF0pKSBlbC5jbGFzc05hbWUgKz0gXCIgXCIuY29uY2F0KGNsYXNzTGlzdFswXSk7XG4gICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPiAxKSBhZGRDbGFzcyhlbCwgY2xhc3NMaXN0LnNsaWNlKDEpLmpvaW4oJyAnKSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgdmFyIGNsYXNzTGlzdCA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NMaXN0WzBdKTtlbHNlIGlmIChoYXNDbGFzcyhlbCwgY2xhc3NMaXN0WzBdKSkge1xuICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoXCIoXFxcXHN8XilcIi5jb25jYXQoY2xhc3NMaXN0WzBdLCBcIihcXFxcc3wkKVwiKSk7XG4gICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUucmVwbGFjZShyZWcsICcgJyk7XG4gICAgfVxuICAgIGlmIChjbGFzc0xpc3QubGVuZ3RoID4gMSkgcmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTGlzdC5zbGljZSgxKS5qb2luKCcgJykpO1xuICB9XG59KSgpOyJdfQ==
