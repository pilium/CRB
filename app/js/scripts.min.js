"use strict";document.addEventListener("DOMContentLoaded",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=E?(document.body.style.paddingTop=S.offsetHeight+"px",S.classList.add("fixed-nav")):(S.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}function o(){var e=document.documentElement.clientHeight-50;console.log(e),function t(){window.pageYOffset<e&&(window.scrollBy(0,10),setTimeout(t,0)),window.pageYOffset>e&&window.scrollTo(0,e)}()}var n=document.getElementById("preloader");n&&setTimeout(function(){n.classList.add("active"),document.body.style.overflow="visible"},3e3);var s=document.querySelector(".js-hero-slider"),a=document.querySelector(".blog-slider"),i=document.querySelector(".news-slider"),l=document.getElementById("map"),c=document.querySelector(".js-header-info__writeToUs-link"),r=document.querySelector(".modal"),d=r.querySelector(".modal-close__btn"),u=r.querySelector("[name=login]"),m=document.querySelector(".testimonials-slider");if(s){new Swiper(".swiper-container",{loop:!0,parallax:!0,speed:1e3,mousewheelControl:!0})}if(a){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(l){var f=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(f)}var w=document.querySelector(".wrapper-menu"),v=document.querySelector(".js-sidenav"),p=document.querySelector(".sidenav-overlay");w&&w.addEventListener("click",function(){w.classList.toggle("open"),v.classList.toggle("show"),p.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(w.classList.toggle("open"),v.classList.toggle("show"),p.classList.toggle("show"))});var g,L=document.getElementsByClassName("acc-header");for(g=0;g<L.length;g++)L[g].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});if(setTimeout(e,100),function(){var e=document.querySelector(".modal-overlay");c.addEventListener("click",function(t){t.preventDefault(),r.classList.toggle("modal-show"),e.classList.toggle("show"),u.focus()}),d.addEventListener("click",function(t){t.preventDefault(),r.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(r.classList.remove("modal-show"),e.classList.toggle("show"))})}(),i){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"4",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1230:{slidesPerView:3},900:{slidesPerView:2},650:{slidesPerView:1,spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(m){new Swiper(m,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),document.querySelector(".gallery")&&baguetteBox.run(".gallery-wrap",{async:!0});for(var y=document.querySelectorAll("form"),h=0;h<y.length;h++)!function(e){y[e].onsubmit=function(t){t.preventDefault(),y[e].classList.add("signed")}}(h);var S=document.querySelector("#nav-main"),E=S.offsetTop;window.addEventListener("scroll",t);var b=document.querySelector(".scroll-down");b&&b.addEventListener("click",o);for(var q=document.querySelectorAll(".fixed-width"),k=0;k<q.length;k++)!function(e){q[e].addEventListener("keyup",function(t){if(13===t.keyCode){var o=q[e].querySelector(".menu");q[e].classList.toggle("fixed-width--show"),o.addEventListener("blur",function(){o.style.display="none"})}})}(k)}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>i?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>l&&n(a,"cd-top--fade-out"),c=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,i=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,i),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],i=300,l=1200,c=!1;a&&(window.addEventListener("scroll",function(t){c||(c=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRUaW1lRm9vdGVyIiwiZGF0ZSIsIkRhdGUiLCJvcHRpb25zIiwieWVhciIsIm1vbnRoIiwiZGF5IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRvTG9jYWxlU3RyaW5nIiwiZml4TmF2Iiwid2luZG93Iiwic2Nyb2xsWSIsInRvcE9mTmF2IiwiYm9keSIsInN0eWxlIiwicGFkZGluZ1RvcCIsIm5hdiIsIm9mZnNldEhlaWdodCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInNjcm9sbERvd24iLCJ3aW5kb3dDb29yZHMiLCJkb2N1bWVudEVsZW1lbnQiLCJjbGllbnRIZWlnaHQiLCJjb25zb2xlIiwibG9nIiwic2Nyb2xsIiwicGFnZVlPZmZzZXQiLCJzY3JvbGxCeSIsInNldFRpbWVvdXQiLCJzY3JvbGxUbyIsInByZWxvYWRlciIsImdldEVsZW1lbnRCeUlkIiwib3ZlcmZsb3ciLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ0ZXN0aW1vbmlhbHNTbGlkZXIiLCJTd2lwZXIiLCJsb29wIiwicGFyYWxsYXgiLCJzcGVlZCIsIm1vdXNld2hlZWxDb250cm9sIiwic3BhY2VCZXR3ZWVuIiwiZWZmZWN0IiwiZ3JhYkN1cnNvciIsImF1dG9wbGF5IiwiZGVsYXkiLCJwYWdpbmF0aW9uIiwiZWwiLCJjbGlja2FibGUiLCJpbml0IiwibXlNYXAiLCJ5bWFwcyIsIk1hcCIsImNlbnRlciIsImNvbnRyb2xzIiwiem9vbSIsImdldCIsInJvdXRlUGFuZWwiLCJzdGF0ZSIsInNldCIsIm15UGxhY2VtYXJrIiwiUGxhY2VtYXJrIiwiaGludENvbnRlbnQiLCJiYWxsb29uQ29udGVudCIsInByZXNldCIsImdlb09iamVjdHMiLCJyZWFkeSIsIndyYXBwZXJNZW51Iiwic2lkZW5hdiIsIm92ZXJsYXkiLCJ0b2dnbGUiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJpIiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxlbmd0aCIsInByZXZlbnREZWZhdWx0IiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsImV2ZW50IiwiZm9jdXMiLCJjZW50ZXJlZFNsaWRlcyIsImtleWJvYXJkIiwic2xpZGVzUGVyVmlldyIsImNvdmVyZmxvd0VmZmVjdCIsInJvdGF0ZSIsInN0cmV0Y2giLCJkZXB0aCIsIm1vZGlmaWVyIiwic2xpZGVTaGFkb3dzIiwiYnJlYWtwb2ludHMiLCIxMjMwIiwiOTAwIiwiNjUwIiwic2ltdWxhdGVUb3VjaCIsIm5hdmlnYXRpb24iLCJuZXh0RWwiLCJwcmV2RWwiLCJhdXRvSGVpZ2h0IiwicGVvcGxlQ2FyZCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfaSIsImNhcmQiLCJwYXJlbnROb2RlIiwiaWNvbiIsImJhZ3VldHRlQm94IiwicnVuIiwiYXN5bmMiLCJmb3JtcyIsIl9pMiIsIm9uc3VibWl0Iiwib2Zmc2V0VG9wIiwiYnRuU2Nyb2xsRG93biIsImRyb3Bkb3duSXRlbXMiLCJfaTMiLCJrZXlDb2RlIiwic3ViTWVudSIsImRpc3BsYXkiLCJjaGVja0JhY2tUb1RvcCIsIndpbmRvd1RvcCIsInNjcm9sbFRvcCIsIm9mZnNldCIsImFkZENsYXNzIiwiYmFja1RvcCIsInJlbW92ZUNsYXNzIiwib2Zmc2V0T3BhY2l0eSIsInNjcm9sbGluZyIsImR1cmF0aW9uIiwic3RhcnQiLCJjdXJyZW50VGltZSIsImFuaW1hdGVTY3JvbGwiLCJ0aW1lc3RhbXAiLCJwcm9ncmVzcyIsInZhbCIsIk1hdGgiLCJtYXgiLCJlYXNlSW5PdXRRdWFkIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiaGFzQ2xhc3MiLCJjbGFzc05hbWUiLCJtYXRjaCIsIlJlZ0V4cCIsImNvbmNhdCIsInNwbGl0Iiwic2xpY2UiLCJqb2luIiwicmVnIiwicmVwbGFjZSIsInQiLCJiIiwiYyIsImQiXSwibWFwcGluZ3MiOiJBQUFBLFlBRUFBLFVBQUFDLGlCQUFBLG1CQUFBLFdBNkZBLFFBQUFDLEtBQ0EsR0FBQUMsR0FBQSxHQUFBQyxNQUNBQyxHQUNBQyxLQUFBLFVBQ0FDLE1BQUEsT0FDQUMsSUFBQSxVQUVBUixVQUFBUyxjQUFBLHlCQUNBQyxVQUFBUCxFQUFBUSxlQUFBLEtBQUFOLEdBb0pBLFFBQUFPLEtBQ0FDLE9BQUFDLFNBQUFDLEdBQ0FmLFNBQUFnQixLQUFBQyxNQUFBQyxXQUFBQyxFQUFBQyxhQUFBLEtBQ0FELEVBQUFFLFVBQUFDLElBQUEsZUFFQUgsRUFBQUUsVUFBQUUsT0FBQSxhQUNBdkIsU0FBQWdCLEtBQUFDLE1BQUFDLFdBQUEsR0FRQSxRQUFBTSxLQUNBLEdBQUFDLEdBQUF6QixTQUFBMEIsZ0JBQUFDLGFBQUEsRUFDQUMsU0FBQUMsSUFBQUosR0FFQSxRQUFBSyxLQUNBakIsT0FBQWtCLFlBQUFOLElBQ0FaLE9BQUFtQixTQUFBLEVBQUEsSUFDQUMsV0FBQUgsRUFBQSxJQUdBakIsT0FBQWtCLFlBQUFOLEdBQ0FaLE9BQUFxQixTQUFBLEVBQUFULE1BaFJBLEdBQUFVLEdBQUFuQyxTQUFBb0MsZUFBQSxZQUVBRCxJQUNBRixXQUFBLFdBQ0FFLEVBQUFkLFVBQUFDLElBQUEsVUFDQXRCLFNBQUFnQixLQUFBQyxNQUFBb0IsU0FBQSxXQUNBLElBSUEsSUFBQUMsR0FBQXRDLFNBQUFTLGNBQUEsbUJBQ0E4QixFQUFBdkMsU0FBQVMsY0FBQSxnQkFDQStCLEVBQUF4QyxTQUFBUyxjQUFBLGdCQUNBZ0MsRUFBQXpDLFNBQUFvQyxlQUFBLE9BQ0FNLEVBQUExQyxTQUFBUyxjQUFBLG1DQUNBa0MsRUFBQTNDLFNBQUFTLGNBQUEsVUFDQW1DLEVBQUFELEVBQUFsQyxjQUFBLHFCQUNBb0MsRUFBQUYsRUFBQWxDLGNBQUEsZ0JBQ0FxQyxFQUFBOUMsU0FBQVMsY0FBQSx1QkF1QkEsSUFBQTZCLEVBQ0EsQ0FBQSxHQUFBUyxRQUFBLHFCQUNBQyxNQUFBLEVBQ0FDLFVBQUEsRUFJQUMsTUFBQSxJQUNBQyxtQkFBQSxJQUlBLEdBQUFaLEVBQ0EsQ0FBQSxHQUFBUSxRQUFBLGdCQUNBSyxhQUFBLEdBQ0FDLE9BQUEsT0FDQUwsTUFBQSxFQUNBTSxZQUFBLEVBQ0FDLFVBQ0FDLE1BQUEsS0FHQUMsWUFDQUMsR0FBQSwyQkFDQUMsV0FBQSxLQUtBLEdBQUFsQixFQUFBLENBQ0EsR0FBQW1CLEdBQUEsV0FDQSxHQUFBQyxHQUFBLEdBQUFDLE9BQUFDLElBQUEsT0FDQUMsUUFBQSxRQUFBLFNBQ0FDLFVBQUEsZUFBQSxvQkFBQSxxQkFBQSxlQUFBLHNCQUNBQyxLQUFBLElBRUFMLEdBQUFJLFNBQUFFLElBQUEsc0JBQ0FDLFdBQUFDLE1BQUFDLElBQUEsT0FBQSwwQkFDQSxJQUFBQyxHQUFBLEdBQUFULE9BQUFVLFdBQUEsUUFBQSxVQUNBQyxZQUFBLGtCQUNBQyxlQUFBLGdCQUVBQyxPQUFBLDJCQUVBZCxHQUFBZSxXQUFBdEQsSUFBQWlELEdBR0FULE9BQUFlLE1BQUFqQixHQWVBLEdBQUFrQixHQUFBOUUsU0FBQVMsY0FBQSxpQkFDQXNFLEVBQUEvRSxTQUFBUyxjQUFBLGVBQ0F1RSxFQUFBaEYsU0FBQVMsY0FBQSxtQkFDQXFFLElBQUFBLEVBQUE3RSxpQkFBQSxRQUFBLFdBQ0E2RSxFQUFBekQsVUFBQTRELE9BQUEsUUFDQUYsRUFBQTFELFVBQUE0RCxPQUFBLFFBQ0FELEVBQUEzRCxVQUFBNEQsT0FBQSxVQUVBakYsU0FBQUMsaUJBQUEsUUFBQSxTQUFBaUYsR0FDQUEsRUFBQUMsT0FBQTlELFVBQUErRCxTQUFBLHFCQUNBTixFQUFBekQsVUFBQTRELE9BQUEsUUFDQUYsRUFBQTFELFVBQUE0RCxPQUFBLFFBQ0FELEVBQUEzRCxVQUFBNEQsT0FBQSxVQUlBLElBQ0FJLEdBREFDLEVBQUF0RixTQUFBdUYsdUJBQUEsYUFHQSxLQUFBRixFQUFBLEVBQUFBLEVBQUFDLEVBQUFFLE9BQUFILElBQ0FDLEVBQUFELEdBQUFwRixpQkFBQSxRQUFBLFNBQUFpRixHQUdBQSxFQUFBTyxpQkFDQUMsS0FBQXJFLFVBQUE0RCxPQUFBLFVBR0FTLEtBQUFDLG1CQUNBdEUsVUFBQTRELE9BQUEsV0FPQSxJQUhBaEQsV0FBQS9CLEVBQUEsS0FuSEEsV0FDQSxHQUFBOEUsR0FBQWhGLFNBQUFTLGNBQUEsaUJBQ0FpQyxHQUFBekMsaUJBQUEsUUFBQSxTQUFBMkYsR0FDQUEsRUFBQUgsaUJBQ0E5QyxFQUFBdEIsVUFBQTRELE9BQUEsY0FDQUQsRUFBQTNELFVBQUE0RCxPQUFBLFFBQ0FwQyxFQUFBZ0QsVUFFQWpELEVBQUEzQyxpQkFBQSxRQUFBLFNBQUEyRixHQUNBQSxFQUFBSCxpQkFDQTlDLEVBQUF0QixVQUFBRSxPQUFBLGNBQ0F5RCxFQUFBM0QsVUFBQTRELE9BQUEsVUFFQWpGLFNBQUFDLGlCQUFBLFFBQUEsU0FBQWlGLEdBQ0FBLEVBQUFDLE9BQUE5RCxVQUFBK0QsU0FBQSxtQkFDQXpDLEVBQUF0QixVQUFBRSxPQUFBLGNBQ0F5RCxFQUFBM0QsVUFBQTRELE9BQUEsY0FzR0F6QyxFQUNBLENBQUEsR0FBQU8sUUFBQSxnQkFDQU0sT0FBQSxZQUNBQyxZQUFBLEVBQ0FOLE1BQUEsRUFDQThDLGdCQUFBLEVBQ0FDLFVBQUEsRUFDQTNDLGFBQUEsR0FDQTRDLGNBQUEsSUFDQTlDLE1BQUEsSUFDQStDLGlCQUNBQyxPQUFBLEVBQ0FDLFFBQUEsRUFDQUMsTUFBQSxFQUNBQyxTQUFBLEVBQ0FDLGNBQUEsR0FFQUMsYUFDQUMsTUFDQVIsY0FBQSxHQUVBUyxLQUNBVCxjQUFBLEdBRUFVLEtBQ0FWLGNBQUEsRUFDQTVDLGFBQUEsRUFDQTBDLGdCQUFBLElBR0FhLGVBQUEsRUFDQUMsWUFDQUMsT0FBQSxvQkFDQUMsT0FBQSxxQkFFQXJELFlBQ0FDLEdBQUEsMkJBQ0FDLFdBQUEsS0FLQSxHQUFBYixFQUNBLENBQUEsR0FBQUMsUUFBQUQsR0FDQWlFLFlBQUEsRUFDQS9ELE1BQUEsRUFDQTRELFlBQ0FDLE9BQUEsc0JBQ0FDLE9BQUEsMEJBTUEsV0FHQSxJQUFBLEdBRkFFLEdBQUFoSCxTQUFBaUgsaUJBQUEsbUNBRUFDLEVBQUEsRUFBQUEsRUFBQUYsRUFBQXhCLE9BQUEwQixJQUNBRixFQUFBRSxHQUFBakgsaUJBQUEsUUFBQSxXQUNBLEdBQUFrSCxHQUFBekIsS0FBQTBCLFdBQ0FDLEVBQUEzQixLQUFBakYsY0FBQSxJQUNBNEcsR0FBQWhHLFVBQUFDLElBQUEsZ0JBRUE2RixFQUFBOUYsVUFBQStELFNBQUEsY0FDQStCLEVBQUE5RixVQUFBRSxPQUFBLGFBQ0FVLFdBQUEsV0FDQW9GLEVBQUFoRyxVQUFBRSxPQUFBLGlCQUNBOEYsRUFBQWhHLFVBQUFFLE9BQUEsZ0JBQ0E4RixFQUFBaEcsVUFBQUMsSUFBQSxZQUNBLE9BRUE2RixFQUFBOUYsVUFBQUMsSUFBQSxhQUNBVyxXQUFBLFdBQ0FvRixFQUFBaEcsVUFBQUUsT0FBQSxXQUNBOEYsRUFBQWhHLFVBQUFFLE9BQUEsZ0JBQ0E4RixFQUFBaEcsVUFBQUMsSUFBQSxrQkFDQSxXQVFBdEIsU0FBQVMsY0FBQSxhQUdBNkcsWUFBQUMsSUFBQSxpQkFDQUMsT0FBQSxHQWNBLEtBQUEsR0FWQUMsR0FBQXpILFNBQUFpSCxpQkFBQSxRQVVBUyxFQUFBLEVBQUFBLEVBQUFELEVBQUFqQyxPQUFBa0MsS0FSQSxTQUFBQSxHQUNBRCxFQUFBQyxHQUFBQyxTQUFBLFNBQUEvQixHQUNBQSxFQUFBSCxpQkFFQWdDLEVBQUFDLEdBQUFyRyxVQUFBQyxJQUFBLFlBS0FvRyxFQUdBLElBQUF2RyxHQUFBbkIsU0FBQVMsY0FBQSxhQUNBTSxFQUFBSSxFQUFBeUcsU0FZQS9HLFFBQUFaLGlCQUFBLFNBQUFXLEVBRUEsSUFBQWlILEdBQUE3SCxTQUFBUyxjQUFBLGVBa0JBb0gsSUFDQUEsRUFBQTVILGlCQUFBLFFBQUF1QixFQW1CQSxLQUFBLEdBaEJBc0csR0FBQTlILFNBQUFpSCxpQkFBQSxnQkFnQkFjLEVBQUEsRUFBQUEsRUFBQUQsRUFBQXRDLE9BQUF1QyxLQWRBLFNBQUFBLEdBQ0FELEVBQUFDLEdBQUE5SCxpQkFBQSxRQUFBLFNBQUEyRixHQUNBLEdBQUEsS0FBQUEsRUFBQW9DLFFBQUEsQ0FDQSxHQUFBQyxHQUFBSCxFQUFBQyxHQUFBdEgsY0FBQSxRQUVBcUgsR0FBQUMsR0FBQTFHLFVBQUE0RCxPQUFBLHFCQUVBZ0QsRUFBQWhJLGlCQUFBLE9BQUEsV0FDQWdJLEVBQUFoSCxNQUFBaUgsUUFBQSxhQU9BSCxLQUlBLFdBcUJBLFFBQUFJLEtBQ0EsR0FBQUMsR0FBQXZILE9BQUFDLFNBQUFkLFNBQUEwQixnQkFBQTJHLFNBQ0FELEdBQUFFLEVBQUFDLEVBQUFDLEVBQUEsZ0JBQUFDLEVBQUFELEVBQUEsZUFBQSxvQkFDQUosRUFBQU0sR0FBQUgsRUFBQUMsRUFBQSxvQkFDQUcsR0FBQSxFQUdBLFFBQUFOLEdBQUFPLEdBQ0EsR0FBQUMsR0FBQWhJLE9BQUFDLFNBQUFkLFNBQUEwQixnQkFBQTJHLFVBQ0FTLEVBQUEsS0FFQUMsRUFBQSxRQUFBQSxHQUFBQyxHQUNBRixJQUFBQSxFQUFBRSxFQUNBLElBQUFDLEdBQUFELEVBQUFGLEVBQ0FJLEVBQUFDLEtBQUFDLElBQUFELEtBQUFFLGNBQUFKLEVBQUFKLEdBQUFBLEVBQUFELEdBQUEsRUFDQS9ILFFBQUFxQixTQUFBLEVBQUFnSCxHQUVBRCxFQUFBTCxHQUNBL0gsT0FBQXlJLHNCQUFBUCxHQUlBbEksUUFBQXlJLHNCQUFBUCxHQVdBLFFBQUFRLEdBQUE3RixFQUFBOEYsR0FDQSxNQUFBOUYsR0FBQXJDLFVBQUFxQyxFQUFBckMsVUFBQStELFNBQUFvRSxLQUFBOUYsRUFBQThGLFVBQUFDLE1BQUEsR0FBQUMsUUFBQSxVQUFBQyxPQUFBSCxFQUFBLGFBR0EsUUFBQWpCLEdBQUE3RSxFQUFBOEYsR0FDQSxHQUFBbkksR0FBQW1JLEVBQUFJLE1BQUEsSUFDQWxHLEdBQUFyQyxVQUFBcUMsRUFBQXJDLFVBQUFDLElBQUFELEVBQUEsSUFBQWtJLEVBQUE3RixFQUFBckMsRUFBQSxNQUFBcUMsRUFBQThGLFdBQUEsSUFBQUcsT0FBQXRJLEVBQUEsS0FDQUEsRUFBQW1FLE9BQUEsR0FBQStDLEVBQUE3RSxFQUFBckMsRUFBQXdJLE1BQUEsR0FBQUMsS0FBQSxNQUdBLFFBQUFyQixHQUFBL0UsRUFBQThGLEdBQ0EsR0FBQW5JLEdBQUFtSSxFQUFBSSxNQUFBLElBQ0EsSUFBQWxHLEVBQUFyQyxVQUFBcUMsRUFBQXJDLFVBQUFFLE9BQUFGLEVBQUEsUUFBQSxJQUFBa0ksRUFBQTdGLEVBQUFyQyxFQUFBLElBQUEsQ0FDQSxHQUFBMEksR0FBQSxHQUFBTCxRQUFBLFVBQUFDLE9BQUF0SSxFQUFBLEdBQUEsV0FDQXFDLEdBQUE4RixVQUFBOUYsRUFBQThGLFVBQUFRLFFBQUFELEVBQUEsS0FFQTFJLEVBQUFtRSxPQUFBLEdBQUFpRCxFQUFBL0UsRUFBQXJDLEVBQUF3SSxNQUFBLEdBQUFDLEtBQUEsTUFyRUEsR0FBQXRCLEdBQUF4SSxTQUFBdUYsdUJBQUEsYUFBQSxHQUNBK0MsRUFBQSxJQUNBSSxFQUFBLEtBRUFDLEdBQUEsQ0FFQUgsS0FDQTNILE9BQUFaLGlCQUFBLFNBQUEsU0FBQTJGLEdBQ0ErQyxJQUNBQSxHQUFBLEVBQ0E5SCxPQUFBeUksc0JBQUF6SSxPQUFBeUksc0JBQUFuQixHQUFBbEcsV0FBQWtHLEVBQUEsUUFJQUssRUFBQXZJLGlCQUFBLFFBQUEsU0FBQTJGLEdBQ0FBLEVBQUFILGlCQUNBNUUsT0FBQXlJLHNCQUFBakIsRUFiQSxLQWFBeEgsT0FBQXFCLFNBQUEsRUFBQSxNQTZCQWlILEtBQUFFLGNBQUEsU0FBQVksRUFBQUMsRUFBQUMsRUFBQUMsR0FFQSxPQURBSCxHQUFBRyxFQUFBLEdBQ0EsRUFBQUQsRUFBQSxFQUFBRixFQUFBQSxFQUFBQyxHQUNBRCxLQUNBRSxFQUFBLEdBQUFGLEdBQUFBLEVBQUEsR0FBQSxHQUFBQyIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gIC8vIHByZWxvYWRlclxuICB2YXIgcHJlbG9hZGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ByZWxvYWRlcicpO1xuXG4gIGlmIChwcmVsb2FkZXIpIHtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHByZWxvYWRlci5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAndmlzaWJsZSc7XG4gICAgfSwgMzAwMCk7XG4gIH0gLy8gRU5EIFByZWxvYWRlclxuXG5cbiAgdmFyIHNsaWRlckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1oZXJvLXNsaWRlcicpO1xuICB2YXIgYmxvZ1NsaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5ibG9nLXNsaWRlcicpO1xuICB2YXIgbmV3c1NsaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uZXdzLXNsaWRlcicpO1xuICB2YXIgbWFwQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xuICB2YXIgbGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuanMtaGVhZGVyLWluZm9fX3dyaXRlVG9Vcy1saW5rXCIpO1xuICB2YXIgcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsXCIpO1xuICB2YXIgY2xvc2UgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLWNsb3NlX19idG5cIik7XG4gIHZhciBsb2dpbiA9IHBvcHVwLnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZT1sb2dpbl1cIik7XG4gIHZhciB0ZXN0aW1vbmlhbHNTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGVzdGltb25pYWxzLXNsaWRlcicpO1xuXG4gIHZhciBtb2RhbCA9IGZ1bmN0aW9uIG1vZGFsKCkge1xuICAgIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsLW92ZXJsYXknKTtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBwb3B1cC5jbGFzc0xpc3QudG9nZ2xlKFwibW9kYWwtc2hvd1wiKTtcbiAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgICAgbG9naW4uZm9jdXMoKTtcbiAgICB9KTtcbiAgICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsLXNob3dcIik7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbC1vdmVybGF5JykpIHtcbiAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsLXNob3dcIik7XG4gICAgICAgIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIGlmIChzbGlkZXJDb250YWluZXIpIHtcbiAgICB2YXIgbXlTd2lwZXIgPSBuZXcgU3dpcGVyKCcuc3dpcGVyLWNvbnRhaW5lcicsIHtcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBwYXJhbGxheDogdHJ1ZSxcbiAgICAgIC8vIGF1dG9wbGF5OiB7XG4gICAgICAvLyBcdGRlbGF5OiA1MDAwLFxuICAgICAgLy8gfSxcbiAgICAgIHNwZWVkOiAxMDAwLFxuICAgICAgbW91c2V3aGVlbENvbnRyb2w6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChibG9nU2xpZGVyKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5ibG9nLXNsaWRlcicsIHtcbiAgICAgIHNwYWNlQmV0d2VlbjogMzAsXG4gICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgYXV0b3BsYXk6IHtcbiAgICAgICAgZGVsYXk6IDcwMDBcbiAgICAgIH0sXG4gICAgICAvLyBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5ibG9nLXNsaWRlcl9fcGFnaW5hdGlvbicsXG4gICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG1hcENvbnRhaW5lcikge1xuICAgIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xuICAgICAgICBjZW50ZXI6IFs0Ny41Mzk2LCA0Mi4wMTUxXSxcbiAgICAgICAgY29udHJvbHM6IFsndHlwZVNlbGVjdG9yJywgJ2Z1bGxzY3JlZW5Db250cm9sJywgJ2dlb2xvY2F0aW9uQ29udHJvbCcsICdydWxlckNvbnRyb2wnLCAncm91dGVCdXR0b25Db250cm9sJ10sXG4gICAgICAgIHpvb206IDE2XG4gICAgICB9KTtcbiAgICAgIHZhciBjb250cm9sID0gbXlNYXAuY29udHJvbHMuZ2V0KCdyb3V0ZUJ1dHRvbkNvbnRyb2wnKTtcbiAgICAgIGNvbnRyb2wucm91dGVQYW5lbC5zdGF0ZS5zZXQoJ2Zyb20nLCAn0KDQvtC80LDQvdC+0LLRgdC60LDRjyDRgdC+0Y7Qt9C90YvQuSA5N9CwJyk7XG4gICAgICB2YXIgbXlQbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs0Ny41Mzk4LCA0Mi4wMTUzXSwge1xuICAgICAgICBoaW50Q29udGVudDogJ9Cj0LsuINCh0L7RjtC30L3QsNGPIDk30LAnLFxuICAgICAgICBiYWxsb29uQ29udGVudDogJ9Cf0L7Qu9C40LrQu9C40L3QuNC60LAnXG4gICAgICB9LCB7XG4gICAgICAgIHByZXNldDogJ2lzbGFuZHMjYmx1ZU1lZGljYWxJY29uJ1xuICAgICAgfSk7XG4gICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XG4gICAgfTtcblxuICAgIHltYXBzLnJlYWR5KGluaXQpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkVGltZUZvb3RlcigpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICBtb250aDogJ2xvbmcnLFxuICAgICAgZGF5OiAnbnVtZXJpYydcbiAgICB9O1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtZm9vdGVyLWluZm9fX2RhdGUnKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gZGF0ZS50b0xvY2FsZVN0cmluZyhcInJ1XCIsIG9wdGlvbnMpO1xuICB9IC8vIEhhbWJ1cmdlclxuXG5cbiAgdmFyIHdyYXBwZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXItbWVudScpO1xuICB2YXIgc2lkZW5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5qcy1zaWRlbmF2Jyk7XG4gIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGVuYXYtb3ZlcmxheScpO1xuICBpZiAod3JhcHBlck1lbnUpIHdyYXBwZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIHdyYXBwZXJNZW51LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTtcbiAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaWRlbmF2LW92ZXJsYXknKSkge1xuICAgICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgICAgc2lkZW5hdi5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9XG4gIH0pOyAvLyBhY2NvcmRpb25cblxuICB2YXIgYWNjID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImFjYy1oZWFkZXJcIik7XG4gIHZhciBpO1xuXG4gIGZvciAoaSA9IDA7IGkgPCBhY2MubGVuZ3RoOyBpKyspIHtcbiAgICBhY2NbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBhZGRpbmcgYW5kIHJlbW92aW5nIHRoZSBcImFjdGl2ZVwiIGNsYXNzLFxuICAgICAgdG8gaGlnaGxpZ2h0IHRoZSBidXR0b24gdGhhdCBjb250cm9scyB0aGUgcGFuZWwgKi9cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiKTtcbiAgICAgIC8qIFRvZ2dsZSBiZXR3ZWVuIGhpZGluZyBhbmQgc2hvd2luZyB0aGUgYWN0aXZlIHBhbmVsICovXG5cbiAgICAgIHZhciBwYW5lbCA9IHRoaXMubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgcGFuZWwuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgfSk7XG4gIH1cblxuICBzZXRUaW1lb3V0KGFkZFRpbWVGb290ZXIsIDEwMCk7XG4gIG1vZGFsKCk7IC8vIHN3aXBlciBzbGlkZXJ0ZXN0XG5cbiAgaWYgKG5ld3NTbGlkZXIpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcignLm5ld3Mtc2xpZGVyJywge1xuICAgICAgZWZmZWN0OiAnY292ZXJmbG93JyxcbiAgICAgIGdyYWJDdXJzb3I6IHRydWUsXG4gICAgICBsb29wOiBmYWxzZSxcbiAgICAgIGNlbnRlcmVkU2xpZGVzOiBmYWxzZSxcbiAgICAgIGtleWJvYXJkOiB0cnVlLFxuICAgICAgc3BhY2VCZXR3ZWVuOiAxMCxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICc0JyxcbiAgICAgIHNwZWVkOiAzMDAsXG4gICAgICBjb3ZlcmZsb3dFZmZlY3Q6IHtcbiAgICAgICAgcm90YXRlOiAwLFxuICAgICAgICBzdHJldGNoOiAwLFxuICAgICAgICBkZXB0aDogMCxcbiAgICAgICAgbW9kaWZpZXI6IDEsXG4gICAgICAgIHNsaWRlU2hhZG93czogZmFsc2VcbiAgICAgIH0sXG4gICAgICBicmVha3BvaW50czoge1xuICAgICAgICAxMjMwOiB7XG4gICAgICAgICAgc2xpZGVzUGVyVmlldzogM1xuICAgICAgICB9LFxuICAgICAgICA5MDA6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAyXG4gICAgICAgIH0sXG4gICAgICAgIDY1MDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICAgIGNlbnRlcmVkU2xpZGVzOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzaW11bGF0ZVRvdWNoOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcubmV3cy1zbGlkZXItbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5uZXdzLXNsaWRlci1wcmV2J1xuICAgICAgfSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcubmV3cy1zbGlkZXJfX3BhZ2luYXRpb24nLFxuICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmICh0ZXN0aW1vbmlhbHNTbGlkZXIpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcih0ZXN0aW1vbmlhbHNTbGlkZXIsIHtcbiAgICAgIGF1dG9IZWlnaHQ6IHRydWUsXG4gICAgICBsb29wOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcuc3dpcGVyLWJ1dHRvbi1uZXh0JyxcbiAgICAgICAgcHJldkVsOiAnLnN3aXBlci1idXR0b24tcHJldidcbiAgICAgIH1cbiAgICB9KTtcbiAgfSAvLyBwZW9wbGVDYXJkXG5cblxuICBmdW5jdGlvbiBwZW9wbGVDYXJkKCkge1xuICAgIHZhciBwZW9wbGVDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1hdGVyaWFsLWNhcmQgPiAubWMtYnRuLWFjdGlvbicpO1xuXG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHBlb3BsZUNhcmQubGVuZ3RoOyBfaSsrKSB7XG4gICAgICBwZW9wbGVDYXJkW19pXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNhcmQgPSB0aGlzLnBhcmVudE5vZGU7XG4gICAgICAgIHZhciBpY29uID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtc3Bpbi1mYXN0Jyk7XG5cbiAgICAgICAgaWYgKGNhcmQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtYy1hY3RpdmUnKSkge1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbWMtYWN0aXZlJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWFycm93LWxlZnQnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtc3Bpbi1mYXN0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWJhcnMnKTtcbiAgICAgICAgICB9LCA4MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LmFkZCgnbWMtYWN0aXZlJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWJhcnMnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtc3Bpbi1mYXN0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWFycm93LWxlZnQnKTtcbiAgICAgICAgICB9LCA4MDApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICA7XG4gIHBlb3BsZUNhcmQoKTtcbiAgdmFyIGdhbGxlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FsbGVyeScpO1xuXG4gIGlmIChnYWxsZXJ5KSB7XG4gICAgYmFndWV0dGVCb3gucnVuKCcuZ2FsbGVyeS13cmFwJywge1xuICAgICAgYXN5bmM6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIHZhciBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKTtcblxuICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChfaTIpIHtcbiAgICBmb3Jtc1tfaTJdLm9uc3VibWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBmb3Jtc1tfaTJdLmNsYXNzTGlzdC5hZGQoJ3NpZ25lZCcpO1xuICAgIH07XG4gIH07XG5cbiAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgZm9ybXMubGVuZ3RoOyBfaTIrKykge1xuICAgIF9sb29wKF9pMik7XG4gIH1cblxuICB2YXIgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi1tYWluJyk7XG4gIHZhciB0b3BPZk5hdiA9IG5hdi5vZmZzZXRUb3A7XG5cbiAgZnVuY3Rpb24gZml4TmF2KCkge1xuICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+PSB0b3BPZk5hdikge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nVG9wID0gbmF2Lm9mZnNldEhlaWdodCArICdweCc7XG4gICAgICBuYXYuY2xhc3NMaXN0LmFkZCgnZml4ZWQtbmF2Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZC1uYXYnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IDA7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZpeE5hdik7IC8vIHNjcm9sbC1kb3duXG5cbiAgdmFyIGJ0blNjcm9sbERvd24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Nyb2xsLWRvd24nKTtcblxuICBmdW5jdGlvbiBzY3JvbGxEb3duKCkge1xuICAgIHZhciB3aW5kb3dDb29yZHMgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gNTA7XG4gICAgY29uc29sZS5sb2cod2luZG93Q29vcmRzKTtcblxuICAgIChmdW5jdGlvbiBzY3JvbGwoKSB7XG4gICAgICBpZiAod2luZG93LnBhZ2VZT2Zmc2V0IDwgd2luZG93Q29vcmRzKSB7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxCeSgwLCAxMCk7XG4gICAgICAgIHNldFRpbWVvdXQoc2Nyb2xsLCAwKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdpbmRvdy5wYWdlWU9mZnNldCA+IHdpbmRvd0Nvb3Jkcykge1xuICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgd2luZG93Q29vcmRzKTtcbiAgICAgIH1cbiAgICB9KSgpO1xuICB9XG5cbiAgaWYgKGJ0blNjcm9sbERvd24pIHtcbiAgICBidG5TY3JvbGxEb3duLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2Nyb2xsRG93bik7XG4gIH1cblxuICB2YXIgZHJvcGRvd25JdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5maXhlZC13aWR0aCcpO1xuXG4gIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoX2kzKSB7XG4gICAgZHJvcGRvd25JdGVtc1tfaTNdLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgICAgdmFyIHN1Yk1lbnUgPSBkcm9wZG93bkl0ZW1zW19pM10ucXVlcnlTZWxlY3RvcignLm1lbnUnKTtcblxuICAgICAgICBkcm9wZG93bkl0ZW1zW19pM10uY2xhc3NMaXN0LnRvZ2dsZSgnZml4ZWQtd2lkdGgtLXNob3cnKTtcblxuICAgICAgICBzdWJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgc3ViTWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBkcm9wZG93bkl0ZW1zLmxlbmd0aDsgX2kzKyspIHtcbiAgICBfbG9vcDIoX2kzKTtcbiAgfVxufSk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBiYWNrVG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnanMtY2QtdG9wJylbMF07XG4gIHZhciBvZmZzZXQgPSAzMDA7XG4gIHZhciBvZmZzZXRPcGFjaXR5ID0gMTIwMDtcbiAgdmFyIHNjcm9sbER1cmF0aW9uID0gNzAwO1xuICB2YXIgc2Nyb2xsaW5nID0gZmFsc2U7XG5cbiAgaWYgKGJhY2tUb3ApIHtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICghc2Nyb2xsaW5nKSB7XG4gICAgICAgIHNjcm9sbGluZyA9IHRydWU7XG4gICAgICAgICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID8gc2V0VGltZW91dChjaGVja0JhY2tUb1RvcCwgMjUwKSA6IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2hlY2tCYWNrVG9Ub3ApO1xuICAgICAgfVxuICAgIH0pOyAvL3Ntb290aCBzY3JvbGwgdG8gdG9wXG5cbiAgICBiYWNrVG9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyB3aW5kb3cuc2Nyb2xsVG8oMCwgMCkgOiBzY3JvbGxUb3Aoc2Nyb2xsRHVyYXRpb24pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2hlY2tCYWNrVG9Ub3AoKSB7XG4gICAgdmFyIHdpbmRvd1RvcCA9IHdpbmRvdy5zY3JvbGxZIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgd2luZG93VG9wID4gb2Zmc2V0ID8gYWRkQ2xhc3MoYmFja1RvcCwgJ2NkLXRvcC0tc2hvdycpIDogcmVtb3ZlQ2xhc3MoYmFja1RvcCwgJ2NkLXRvcC0tc2hvdycsICdjZC10b3AtLWZhZGUtb3V0Jyk7XG4gICAgd2luZG93VG9wID4gb2Zmc2V0T3BhY2l0eSAmJiBhZGRDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1mYWRlLW91dCcpO1xuICAgIHNjcm9sbGluZyA9IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gc2Nyb2xsVG9wKGR1cmF0aW9uKSB7XG4gICAgdmFyIHN0YXJ0ID0gd2luZG93LnNjcm9sbFkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB2YXIgY3VycmVudFRpbWUgPSBudWxsO1xuXG4gICAgdmFyIGFuaW1hdGVTY3JvbGwgPSBmdW5jdGlvbiBhbmltYXRlU2Nyb2xsKHRpbWVzdGFtcCkge1xuICAgICAgaWYgKCFjdXJyZW50VGltZSkgY3VycmVudFRpbWUgPSB0aW1lc3RhbXA7XG4gICAgICB2YXIgcHJvZ3Jlc3MgPSB0aW1lc3RhbXAgLSBjdXJyZW50VGltZTtcbiAgICAgIHZhciB2YWwgPSBNYXRoLm1heChNYXRoLmVhc2VJbk91dFF1YWQocHJvZ3Jlc3MsIHN0YXJ0LCAtc3RhcnQsIGR1cmF0aW9uKSwgMCk7XG4gICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgdmFsKTtcblxuICAgICAgaWYgKHByb2dyZXNzIDwgZHVyYXRpb24pIHtcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlU2Nyb2xsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlU2Nyb2xsKTtcbiAgfVxuXG4gIE1hdGguZWFzZUluT3V0UXVhZCA9IGZ1bmN0aW9uICh0LCBiLCBjLCBkKSB7XG4gICAgdCAvPSBkIC8gMjtcbiAgICBpZiAodCA8IDEpIHJldHVybiBjIC8gMiAqIHQgKiB0ICsgYjtcbiAgICB0LS07XG4gICAgcmV0dXJuIC1jIC8gMiAqICh0ICogKHQgLSAyKSAtIDEpICsgYjtcbiAgfTsgLy9jbGFzcyBtYW5pcHVsYXRpb25zIC0gbmVlZGVkIGlmIGNsYXNzTGlzdCBpcyBub3Qgc3VwcG9ydGVkXG5cblxuICBmdW5jdGlvbiBoYXNDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgcmV0dXJuIGVsLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc05hbWUpO2Vsc2UgcmV0dXJuICEhZWwuY2xhc3NOYW1lLm1hdGNoKG5ldyBSZWdFeHAoXCIoXFxcXHN8XilcIi5jb25jYXQoY2xhc3NOYW1lLCBcIihcXFxcc3wkKVwiKSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkQ2xhc3MoZWwsIGNsYXNzTmFtZSkge1xuICAgIHZhciBjbGFzc0xpc3QgPSBjbGFzc05hbWUuc3BsaXQoJyAnKTtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSBlbC5jbGFzc0xpc3QuYWRkKGNsYXNzTGlzdFswXSk7ZWxzZSBpZiAoIWhhc0NsYXNzKGVsLCBjbGFzc0xpc3RbMF0pKSBlbC5jbGFzc05hbWUgKz0gXCIgXCIuY29uY2F0KGNsYXNzTGlzdFswXSk7XG4gICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPiAxKSBhZGRDbGFzcyhlbCwgY2xhc3NMaXN0LnNsaWNlKDEpLmpvaW4oJyAnKSk7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgdmFyIGNsYXNzTGlzdCA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIGVsLmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NMaXN0WzBdKTtlbHNlIGlmIChoYXNDbGFzcyhlbCwgY2xhc3NMaXN0WzBdKSkge1xuICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoXCIoXFxcXHN8XilcIi5jb25jYXQoY2xhc3NMaXN0WzBdLCBcIihcXFxcc3wkKVwiKSk7XG4gICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUucmVwbGFjZShyZWcsICcgJyk7XG4gICAgfVxuICAgIGlmIChjbGFzc0xpc3QubGVuZ3RoID4gMSkgcmVtb3ZlQ2xhc3MoZWwsIGNsYXNzTGlzdC5zbGljZSgxKS5qb2luKCcgJykpO1xuICB9XG59KSgpOyJdfQ==
