"use strict";document.addEventListener("DOMContentLoaded",function(){function e(){var e=new Date,t={year:"numeric",month:"long",day:"numeric"};document.querySelector(".js-footer-info__date").innerHTML=e.toLocaleString("ru",t)}function t(){window.scrollY>=b?(document.body.style.paddingTop=q.offsetHeight+"px",q.classList.add("fixed-nav")):(q.classList.remove("fixed-nav"),document.body.style.paddingTop=0)}var o=document.getElementById("preloader");o&&setTimeout(function(){o.classList.add("active"),document.body.style.overflow="visible"},3e3);var n=document.querySelector(".header-actions__search"),s=n.querySelector(".icon-magnifier-tool"),a=n.querySelector("[type=text]"),i=document.querySelector(".swiper-container"),c=document.querySelector(".blog-slider"),l=document.querySelector(".news-slider"),r=document.getElementById("map"),d=document.querySelector(".js-header-info__writeToUs-link"),u=document.querySelector(".modal"),m=u.querySelector(".modal-close__btn"),f=u.querySelector("[name=login]"),v=document.querySelector(".testimonials-slider");if(i){new Swiper(".swiper-container",{loop:!0,parallax:!0,autoplay:{delay:5e3},speed:1e3,mousewheelControl:!0})}if(c){new Swiper(".blog-slider",{spaceBetween:30,effect:"fade",loop:!0,grabCursor:!0,autoplay:{delay:7e3},pagination:{el:".blog-slider__pagination",clickable:!0}})}if(r){var w=function(){var e=new ymaps.Map("map",{center:[47.5396,42.0151],controls:["typeSelector","fullscreenControl","geolocationControl","rulerControl","routeButtonControl"],zoom:16});e.controls.get("routeButtonControl").routePanel.state.set("from","Романовская союзный 97а");var t=new ymaps.Placemark([47.5398,42.0153],{hintContent:"Ул. Союзная 97а",balloonContent:"Поликлиника"},{preset:"islands#blueMedicalIcon"});e.geoObjects.add(t)};ymaps.ready(w)}var p=document.querySelector(".wrapper-menu"),g=document.querySelector(".sidenav"),L=document.querySelector(".sidenav-overlay");p&&p.addEventListener("click",function(){p.classList.toggle("open"),g.classList.toggle("show"),L.classList.toggle("show")}),document.addEventListener("click",function(e){e.target.classList.contains("sidenav-overlay")&&(p.classList.toggle("open"),g.classList.toggle("show"),L.classList.toggle("show"))});var y,h=document.getElementsByClassName("acc-header");for(y=0;y<h.length;y++)h[y].addEventListener("click",function(e){e.preventDefault(),this.classList.toggle("active"),this.nextElementSibling.classList.toggle("active")});if(setTimeout(e,100),function(){s.addEventListener("click",function(){e(),a.focus()}),document.addEventListener("keydown",function(e){27==e.keyCode&&n.classList.contains("active")&&n.classList.remove("active")}),document.addEventListener("click",function(t){var o=t.target,s=o==n||n.contains(o),a=n.classList.contains("active");!s&&a&&e()});var e=function(){n.classList.toggle("active")}}(),function(){var e=document.querySelector(".modal-overlay");d.addEventListener("click",function(t){t.preventDefault(),u.classList.toggle("modal-show"),e.classList.toggle("show"),f.focus()}),m.addEventListener("click",function(t){t.preventDefault(),u.classList.remove("modal-show"),e.classList.toggle("show")}),document.addEventListener("click",function(t){t.target.classList.contains("modal-overlay")&&(u.classList.remove("modal-show"),e.classList.toggle("show"))})}(),l){new Swiper(".news-slider",{effect:"coverflow",grabCursor:!0,loop:!1,centeredSlides:!1,keyboard:!0,spaceBetween:10,slidesPerView:"3",speed:300,coverflowEffect:{rotate:0,stretch:0,depth:0,modifier:1,slideShadows:!1},breakpoints:{1024:{slidesPerView:2},800:{slidesPerView:1},480:{spaceBetween:0,centeredSlides:!0}},simulateTouch:!0,navigation:{nextEl:".news-slider-next",prevEl:".news-slider-prev"},pagination:{el:".news-slider__pagination",clickable:!0}})}if(v){new Swiper(v,{autoHeight:!0,loop:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}!function(){for(var e=document.querySelectorAll(".material-card > .mc-btn-action"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.parentNode,t=this.querySelector("i");t.classList.add("fa-spin-fast"),e.classList.contains("mc-active")?(e.classList.remove("mc-active"),setTimeout(function(){t.classList.remove("fa-arrow-left"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-bars")},800)):(e.classList.add("mc-active"),setTimeout(function(){t.classList.remove("fa-bars"),t.classList.remove("fa-spin-fast"),t.classList.add("fa-arrow-left")},800))})}(),document.querySelector(".gallery")&&baguetteBox.run(".gallery-wrap",{async:!0});for(var S=document.querySelectorAll("form"),E=0;E<S.length;E++)!function(e){S[e].onsubmit=function(t){t.preventDefault(),S[e].classList.add("signed")}}(E);var q=document.querySelector("#nav-main"),b=q.offsetTop;window.addEventListener("scroll",t)}),function(){function e(){var e=window.scrollY||document.documentElement.scrollTop;e>i?n(a,"cd-top--show"):s(a,"cd-top--show","cd-top--fade-out"),e>c&&n(a,"cd-top--fade-out"),l=!1}function t(e){var t=window.scrollY||document.documentElement.scrollTop,o=null,n=function n(s){o||(o=s);var a=s-o,i=Math.max(Math.easeInOutQuad(a,t,-t,e),0);window.scrollTo(0,i),a<e&&window.requestAnimationFrame(n)};window.requestAnimationFrame(n)}function o(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)".concat(t,"(\\s|$)")))}function n(e,t){var s=t.split(" ");e.classList?e.classList.add(s[0]):o(e,s[0])||(e.className+=" ".concat(s[0])),s.length>1&&n(e,s.slice(1).join(" "))}function s(e,t){var n=t.split(" ");if(e.classList)e.classList.remove(n[0]);else if(o(e,n[0])){var a=new RegExp("(\\s|^)".concat(n[0],"(\\s|$)"));e.className=e.className.replace(a," ")}n.length>1&&s(e,n.slice(1).join(" "))}var a=document.getElementsByClassName("js-cd-top")[0],i=300,c=1200,l=!1;a&&(window.addEventListener("scroll",function(t){l||(l=!0,window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,250))}),a.addEventListener("click",function(e){e.preventDefault(),window.requestAnimationFrame?t(700):window.scrollTo(0,0)})),Math.easeInOutQuad=function(e,t,o,n){return(e/=n/2)<1?o/2*e*e+t:(e--,-o/2*(e*(e-2)-1)+t)}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5qcyJdLCJuYW1lcyI6WyJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRUaW1lRm9vdGVyIiwiZGF0ZSIsIkRhdGUiLCJvcHRpb25zIiwieWVhciIsIm1vbnRoIiwiZGF5IiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsInRvTG9jYWxlU3RyaW5nIiwiZml4TmF2Iiwid2luZG93Iiwic2Nyb2xsWSIsInRvcE9mTmF2IiwiYm9keSIsInN0eWxlIiwicGFkZGluZ1RvcCIsIm5hdiIsIm9mZnNldEhlaWdodCIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsInByZWxvYWRlciIsImdldEVsZW1lbnRCeUlkIiwic2V0VGltZW91dCIsIm92ZXJmbG93IiwiY29udGFpbmVyIiwic2VhcmNoIiwiaW5wdXQiLCJzbGlkZXJDb250YWluZXIiLCJibG9nU2xpZGVyIiwibmV3c1NsaWRlciIsIm1hcENvbnRhaW5lciIsImxpbmsiLCJwb3B1cCIsImNsb3NlIiwibG9naW4iLCJ0ZXN0aW1vbmlhbHNTbGlkZXIiLCJTd2lwZXIiLCJsb29wIiwicGFyYWxsYXgiLCJhdXRvcGxheSIsImRlbGF5Iiwic3BlZWQiLCJtb3VzZXdoZWVsQ29udHJvbCIsInNwYWNlQmV0d2VlbiIsImVmZmVjdCIsImdyYWJDdXJzb3IiLCJwYWdpbmF0aW9uIiwiZWwiLCJjbGlja2FibGUiLCJpbml0IiwibXlNYXAiLCJ5bWFwcyIsIk1hcCIsImNlbnRlciIsImNvbnRyb2xzIiwiem9vbSIsImdldCIsInJvdXRlUGFuZWwiLCJzdGF0ZSIsInNldCIsIm15UGxhY2VtYXJrIiwiUGxhY2VtYXJrIiwiaGludENvbnRlbnQiLCJiYWxsb29uQ29udGVudCIsInByZXNldCIsImdlb09iamVjdHMiLCJyZWFkeSIsIndyYXBwZXJNZW51Iiwic2lkZW5hdiIsIm92ZXJsYXkiLCJ0b2dnbGUiLCJlIiwidGFyZ2V0IiwiY29udGFpbnMiLCJpIiwiYWNjIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxlbmd0aCIsInByZXZlbnREZWZhdWx0IiwidGhpcyIsIm5leHRFbGVtZW50U2libGluZyIsInRvZ2dsZV9zZWFyY2hfY2xhc3MiLCJmb2N1cyIsImV2ZW50Iiwia2V5Q29kZSIsIml0c19jb250YWluZXIiLCJzZWFyY2hfaXNfYWN0aXZlIiwiY2VudGVyZWRTbGlkZXMiLCJrZXlib2FyZCIsInNsaWRlc1BlclZpZXciLCJjb3ZlcmZsb3dFZmZlY3QiLCJyb3RhdGUiLCJzdHJldGNoIiwiZGVwdGgiLCJtb2RpZmllciIsInNsaWRlU2hhZG93cyIsImJyZWFrcG9pbnRzIiwiMTAyNCIsIjgwMCIsIjQ4MCIsInNpbXVsYXRlVG91Y2giLCJuYXZpZ2F0aW9uIiwibmV4dEVsIiwicHJldkVsIiwiYXV0b0hlaWdodCIsInBlb3BsZUNhcmQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiX2kiLCJjYXJkIiwicGFyZW50Tm9kZSIsImljb24iLCJiYWd1ZXR0ZUJveCIsInJ1biIsImFzeW5jIiwiZm9ybXMiLCJfaTIiLCJvbnN1Ym1pdCIsIm9mZnNldFRvcCIsImNoZWNrQmFja1RvVG9wIiwid2luZG93VG9wIiwiZG9jdW1lbnRFbGVtZW50Iiwic2Nyb2xsVG9wIiwib2Zmc2V0IiwiYWRkQ2xhc3MiLCJiYWNrVG9wIiwicmVtb3ZlQ2xhc3MiLCJvZmZzZXRPcGFjaXR5Iiwic2Nyb2xsaW5nIiwiZHVyYXRpb24iLCJzdGFydCIsImN1cnJlbnRUaW1lIiwiYW5pbWF0ZVNjcm9sbCIsInRpbWVzdGFtcCIsInByb2dyZXNzIiwidmFsIiwiTWF0aCIsIm1heCIsImVhc2VJbk91dFF1YWQiLCJzY3JvbGxUbyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImhhc0NsYXNzIiwiY2xhc3NOYW1lIiwibWF0Y2giLCJSZWdFeHAiLCJjb25jYXQiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsInJlZyIsInJlcGxhY2UiLCJ0IiwiYiIsImMiLCJkIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUVBQSxVQUFBQyxpQkFBQSxtQkFB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QUEsQ0FDQSxHQUFBbUksR0FBQSxHQUFBTCxRQUFBLFVBQUFDLE9BQUEvSCxFQUFBLEdBQUEsV0FDQThCLEdBQUE4RixVQUFBOUYsRUFBQThGLFVBQUFRLFFBQUFELEVBQUEsS0FFQW5JLEVBQUE0RCxPQUFBLEdBQUFnRCxFQUFBOUUsRUFBQTlCLEVBQUFpSSxNQUFBLEdBQUFDLEtBQUEsTUFyRUEsR0FBQXZCLEdBQUFoSSxTQUFBZ0YsdUJBQUEsYUFBQSxHQUNBOEMsRUFBQSxJQUNBSSxFQUFBLEtBRUFDLEdBQUEsQ0FFQUgsS0FDQW5ILE9BQUFaLGlCQUFBLFNBQUEsU0FBQXNGLEdBQ0E0QyxJQUNBQSxHQUFBLEVBQ0F0SCxPQUFBa0ksc0JBQUFsSSxPQUFBa0ksc0JBQUFyQixHQUFBaEcsV0FBQWdHLEVBQUEsUUFJQU0sRUFBQS9ILGlCQUFBLFFBQUEsU0FBQXNGLEdBQ0FBLEVBQUFMLGlCQUNBckUsT0FBQWtJLHNCQUFBbEIsRUFiQSxLQWFBaEgsT0FBQWlJLFNBQUEsRUFBQSxNQTZCQUgsS0FBQUUsY0FBQSxTQUFBYSxFQUFBQyxFQUFBQyxFQUFBQyxHQUVBLE9BREFILEdBQUFHLEVBQUEsR0FDQSxFQUFBRCxFQUFBLEVBQUFGLEVBQUFBLEVBQUFDLEdBQ0FELEtBQ0FFLEVBQUEsR0FBQUYsR0FBQUEsRUFBQSxHQUFBLEdBQUFDIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgLy8gcHJlbG9hZGVyXG4gIHZhciBwcmVsb2FkZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJlbG9hZGVyJyk7XG5cbiAgaWYgKHByZWxvYWRlcikge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgcHJlbG9hZGVyLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5vdmVyZmxvdyA9ICd2aXNpYmxlJztcbiAgICB9LCAzMDAwKTtcbiAgfSAvLyBFTkQgUHJlbG9hZGVyXG5cblxuICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlci1hY3Rpb25zX19zZWFyY2gnKTtcbiAgdmFyIHNlYXJjaCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuaWNvbi1tYWduaWZpZXItdG9vbCcpO1xuICB2YXIgaW5wdXQgPSBjb250YWluZXIucXVlcnlTZWxlY3RvcihcIlt0eXBlPXRleHRdXCIpO1xuICB2YXIgc2xpZGVyQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN3aXBlci1jb250YWluZXInKTtcbiAgdmFyIGJsb2dTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYmxvZy1zbGlkZXInKTtcbiAgdmFyIG5ld3NTbGlkZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3cy1zbGlkZXInKTtcbiAgdmFyIG1hcENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcbiAgdmFyIGxpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmpzLWhlYWRlci1pbmZvX193cml0ZVRvVXMtbGlua1wiKTtcbiAgdmFyIHBvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbFwiKTtcbiAgdmFyIGNsb3NlID0gcG9wdXAucXVlcnlTZWxlY3RvcihcIi5tb2RhbC1jbG9zZV9fYnRuXCIpO1xuICB2YXIgbG9naW4gPSBwb3B1cC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9bG9naW5dXCIpO1xuICB2YXIgdGVzdGltb25pYWxzU2xpZGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRlc3RpbW9uaWFscy1zbGlkZXInKTtcblxuICB2YXIgc2VhcmNoX3RvZ2dsZSA9IGZ1bmN0aW9uIHNlYXJjaF90b2dnbGUoKSB7XG4gICAgc2VhcmNoLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdG9nZ2xlX3NlYXJjaF9jbGFzcygpO1xuICAgICAgaW5wdXQuZm9jdXMoKTtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmIChldmVudC5rZXlDb2RlID09IDI3KSB7XG4gICAgICAgIGlmIChjb250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYWN0aXZlXCIpKSB7XG4gICAgICAgICAgY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICB2YXIgaXRzX2NvbnRhaW5lciA9IHRhcmdldCA9PSBjb250YWluZXIgfHwgY29udGFpbmVyLmNvbnRhaW5zKHRhcmdldCk7XG4gICAgICB2YXIgc2VhcmNoX2lzX2FjdGl2ZSA9IGNvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoJ2FjdGl2ZScpO1xuXG4gICAgICBpZiAoIWl0c19jb250YWluZXIgJiYgc2VhcmNoX2lzX2FjdGl2ZSkge1xuICAgICAgICB0b2dnbGVfc2VhcmNoX2NsYXNzKCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgdG9nZ2xlX3NlYXJjaF9jbGFzcyA9IGZ1bmN0aW9uIHRvZ2dsZV9zZWFyY2hfY2xhc3MoKSB7XG4gICAgICBjb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgfTtcbiAgfTtcblxuICB2YXIgbW9kYWwgPSBmdW5jdGlvbiBtb2RhbCgpIHtcbiAgICB2YXIgb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1vdmVybGF5Jyk7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgcG9wdXAuY2xhc3NMaXN0LnRvZ2dsZShcIm1vZGFsLXNob3dcIik7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIGxvZ2luLmZvY3VzKCk7XG4gICAgfSk7XG4gICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbC1zaG93XCIpO1xuICAgICAgb3ZlcmxheS5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWwtb3ZlcmxheScpKSB7XG4gICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbC1zaG93XCIpO1xuICAgICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTsgLy8gaWYgKHNsaWRlckNvbnRhaW5lcikge1xuICAvLyAgICAgbmV3IEdsaWRlKHNsaWRlckNvbnRhaW5lciwge1xuICAvLyAgICAgdHlwZTogJ3NsaWRlcicsXG4gIC8vICAgICBhdXRvcGxheTogODAwMCxcbiAgLy8gICAgIGtleWJvcmQ6IHRydWUsXG4gIC8vICAgICBob3ZlcnBhdXNlOiB0cnVlLFxuICAvLyAgICAgcmV3aW5kOiB0cnVlLFxuICAvLyAgICAgcmV3aW5kRHVyYXRpb246IDEwMDAsXG4gIC8vICAgICBhbmltYXRpb25UaW1pbmdGdW5jOiAnYm91bmNlJ1xuICAvLyB9KS5tb3VudCgpO1xuICAvLyB9XG5cblxuICBpZiAoc2xpZGVyQ29udGFpbmVyKSB7XG4gICAgdmFyIG15U3dpcGVyID0gbmV3IFN3aXBlcignLnN3aXBlci1jb250YWluZXInLCB7XG4gICAgICBsb29wOiB0cnVlLFxuICAgICAgcGFyYWxsYXg6IHRydWUsXG4gICAgICBhdXRvcGxheToge1xuICAgICAgICBkZWxheTogNTAwMFxuICAgICAgfSxcbiAgICAgIHNwZWVkOiAxMDAwLFxuICAgICAgbW91c2V3aGVlbENvbnRyb2w6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIGlmIChibG9nU2xpZGVyKSB7XG4gICAgdmFyIHN3aXBlciA9IG5ldyBTd2lwZXIoJy5ibG9nLXNsaWRlcicsIHtcbiAgICAgIHNwYWNlQmV0d2VlbjogMzAsXG4gICAgICBlZmZlY3Q6ICdmYWRlJyxcbiAgICAgIGxvb3A6IHRydWUsXG4gICAgICBncmFiQ3Vyc29yOiB0cnVlLFxuICAgICAgYXV0b3BsYXk6IHtcbiAgICAgICAgZGVsYXk6IDcwMDBcbiAgICAgIH0sXG4gICAgICAvLyBhdXRvSGVpZ2h0OiB0cnVlLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5ibG9nLXNsaWRlcl9fcGFnaW5hdGlvbicsXG4gICAgICAgIGNsaWNrYWJsZTogdHJ1ZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG1hcENvbnRhaW5lcikge1xuICAgIHZhciBpbml0ID0gZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgIHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xuICAgICAgICBjZW50ZXI6IFs0Ny41Mzk2LCA0Mi4wMTUxXSxcbiAgICAgICAgY29udHJvbHM6IFsndHlwZVNlbGVjdG9yJywgJ2Z1bGxzY3JlZW5Db250cm9sJywgJ2dlb2xvY2F0aW9uQ29udHJvbCcsICdydWxlckNvbnRyb2wnLCAncm91dGVCdXR0b25Db250cm9sJ10sXG4gICAgICAgIHpvb206IDE2XG4gICAgICB9KTtcbiAgICAgIHZhciBjb250cm9sID0gbXlNYXAuY29udHJvbHMuZ2V0KCdyb3V0ZUJ1dHRvbkNvbnRyb2wnKTtcbiAgICAgIGNvbnRyb2wucm91dGVQYW5lbC5zdGF0ZS5zZXQoJ2Zyb20nLCAn0KDQvtC80LDQvdC+0LLRgdC60LDRjyDRgdC+0Y7Qt9C90YvQuSA5N9CwJyk7XG4gICAgICB2YXIgbXlQbGFjZW1hcmsgPSBuZXcgeW1hcHMuUGxhY2VtYXJrKFs0Ny41Mzk4LCA0Mi4wMTUzXSwge1xuICAgICAgICBoaW50Q29udGVudDogJ9Cj0LsuINCh0L7RjtC30L3QsNGPIDk30LAnLFxuICAgICAgICBiYWxsb29uQ29udGVudDogJ9Cf0L7Qu9C40LrQu9C40L3QuNC60LAnXG4gICAgICB9LCB7XG4gICAgICAgIHByZXNldDogJ2lzbGFuZHMjYmx1ZU1lZGljYWxJY29uJ1xuICAgICAgfSk7XG4gICAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteVBsYWNlbWFyayk7XG4gICAgfTtcblxuICAgIHltYXBzLnJlYWR5KGluaXQpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkVGltZUZvb3RlcigpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICBtb250aDogJ2xvbmcnLFxuICAgICAgZGF5OiAnbnVtZXJpYydcbiAgICB9O1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuanMtZm9vdGVyLWluZm9fX2RhdGUnKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gZGF0ZS50b0xvY2FsZVN0cmluZyhcInJ1XCIsIG9wdGlvbnMpO1xuICB9IC8vIEhhbWJ1cmdlclxuXG5cbiAgdmFyIHdyYXBwZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLndyYXBwZXItbWVudScpO1xuICB2YXIgc2lkZW5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zaWRlbmF2Jyk7XG4gIHZhciBvdmVybGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNpZGVuYXYtb3ZlcmxheScpO1xuICBpZiAod3JhcHBlck1lbnUpIHdyYXBwZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIHdyYXBwZXJNZW51LmNsYXNzTGlzdC50b2dnbGUoJ29wZW4nKTtcbiAgICBzaWRlbmF2LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgfSk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaWRlbmF2LW92ZXJsYXknKSkge1xuICAgICAgd3JhcHBlck1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnb3BlbicpO1xuICAgICAgc2lkZW5hdi5jbGFzc0xpc3QudG9nZ2xlKCdzaG93Jyk7XG4gICAgICBvdmVybGF5LmNsYXNzTGlzdC50b2dnbGUoJ3Nob3cnKTtcbiAgICB9XG4gIH0pOyAvLyBhY2NvcmRpb25cblxuICB2YXIgYWNjID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcImFjYy1oZWFkZXJcIik7XG4gIHZhciBpO1xuXG4gIGZvciAoaSA9IDA7IGkgPCBhY2MubGVuZ3RoOyBpKyspIHtcbiAgICBhY2NbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAvKiBUb2dnbGUgYmV0d2VlbiBhZGRpbmcgYW5kIHJlbW92aW5nIHRoZSBcImFjdGl2ZVwiIGNsYXNzLFxuICAgICAgdG8gaGlnaGxpZ2h0IHRoZSBidXR0b24gdGhhdCBjb250cm9scyB0aGUgcGFuZWwgKi9cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiKTtcbiAgICAgIC8qIFRvZ2dsZSBiZXR3ZWVuIGhpZGluZyBhbmQgc2hvd2luZyB0aGUgYWN0aXZlIHBhbmVsICovXG5cbiAgICAgIHZhciBwYW5lbCA9IHRoaXMubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgcGFuZWwuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XG4gICAgfSk7XG4gIH1cblxuICBzZXRUaW1lb3V0KGFkZFRpbWVGb290ZXIsIDEwMCk7XG4gIHNlYXJjaF90b2dnbGUoKTtcbiAgbW9kYWwoKTsgLy8gc3dpcGVyIHNsaWRlcnRlc3RcblxuICBpZiAobmV3c1NsaWRlcikge1xuICAgIHZhciBzd2lwZXIgPSBuZXcgU3dpcGVyKCcubmV3cy1zbGlkZXInLCB7XG4gICAgICBlZmZlY3Q6ICdjb3ZlcmZsb3cnLFxuICAgICAgZ3JhYkN1cnNvcjogdHJ1ZSxcbiAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgY2VudGVyZWRTbGlkZXM6IGZhbHNlLFxuICAgICAga2V5Ym9hcmQ6IHRydWUsXG4gICAgICBzcGFjZUJldHdlZW46IDEwLFxuICAgICAgc2xpZGVzUGVyVmlldzogJzMnLFxuICAgICAgc3BlZWQ6IDMwMCxcbiAgICAgIGNvdmVyZmxvd0VmZmVjdDoge1xuICAgICAgICByb3RhdGU6IDAsXG4gICAgICAgIHN0cmV0Y2g6IDAsXG4gICAgICAgIGRlcHRoOiAwLFxuICAgICAgICBtb2RpZmllcjogMSxcbiAgICAgICAgc2xpZGVTaGFkb3dzOiBmYWxzZVxuICAgICAgfSxcbiAgICAgIGJyZWFrcG9pbnRzOiB7XG4gICAgICAgIDEwMjQ6IHtcbiAgICAgICAgICBzbGlkZXNQZXJWaWV3OiAyXG4gICAgICAgIH0sXG4gICAgICAgIDgwMDoge1xuICAgICAgICAgIHNsaWRlc1BlclZpZXc6IDFcbiAgICAgICAgfSxcbiAgICAgICAgNDgwOiB7XG4gICAgICAgICAgc3BhY2VCZXR3ZWVuOiAwLFxuICAgICAgICAgIGNlbnRlcmVkU2xpZGVzOiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzaW11bGF0ZVRvdWNoOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcubmV3cy1zbGlkZXItbmV4dCcsXG4gICAgICAgIHByZXZFbDogJy5uZXdzLXNsaWRlci1wcmV2J1xuICAgICAgfSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcubmV3cy1zbGlkZXJfX3BhZ2luYXRpb24nLFxuICAgICAgICBjbGlja2FibGU6IHRydWVcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmICh0ZXN0aW1vbmlhbHNTbGlkZXIpIHtcbiAgICB2YXIgc3dpcGVyID0gbmV3IFN3aXBlcih0ZXN0aW1vbmlhbHNTbGlkZXIsIHtcbiAgICAgIGF1dG9IZWlnaHQ6IHRydWUsXG4gICAgICBsb29wOiB0cnVlLFxuICAgICAgbmF2aWdhdGlvbjoge1xuICAgICAgICBuZXh0RWw6ICcuc3dpcGVyLWJ1dHRvbi1uZXh0JyxcbiAgICAgICAgcHJldkVsOiAnLnN3aXBlci1idXR0b24tcHJldidcbiAgICAgIH1cbiAgICB9KTtcbiAgfSAvLyBwZW9wbGVDYXJkXG5cblxuICBmdW5jdGlvbiBwZW9wbGVDYXJkKCkge1xuICAgIHZhciBwZW9wbGVDYXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1hdGVyaWFsLWNhcmQgPiAubWMtYnRuLWFjdGlvbicpO1xuXG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHBlb3BsZUNhcmQubGVuZ3RoOyBfaSsrKSB7XG4gICAgICBwZW9wbGVDYXJkW19pXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGNhcmQgPSB0aGlzLnBhcmVudE5vZGU7XG4gICAgICAgIHZhciBpY29uID0gdGhpcy5xdWVyeVNlbGVjdG9yKCdpJyk7XG4gICAgICAgIGljb24uY2xhc3NMaXN0LmFkZCgnZmEtc3Bpbi1mYXN0Jyk7XG5cbiAgICAgICAgaWYgKGNhcmQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtYy1hY3RpdmUnKSkge1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnbWMtYWN0aXZlJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWFycm93LWxlZnQnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtc3Bpbi1mYXN0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWJhcnMnKTtcbiAgICAgICAgICB9LCA4MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LmFkZCgnbWMtYWN0aXZlJyk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhLWJhcnMnKTtcbiAgICAgICAgICAgIGljb24uY2xhc3NMaXN0LnJlbW92ZSgnZmEtc3Bpbi1mYXN0Jyk7XG4gICAgICAgICAgICBpY29uLmNsYXNzTGlzdC5hZGQoJ2ZhLWFycm93LWxlZnQnKTtcbiAgICAgICAgICB9LCA4MDApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICA7XG4gIHBlb3BsZUNhcmQoKTtcbiAgdmFyIGdhbGxlcnkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZ2FsbGVyeScpO1xuXG4gIGlmIChnYWxsZXJ5KSB7XG4gICAgYmFndWV0dGVCb3gucnVuKCcuZ2FsbGVyeS13cmFwJywge1xuICAgICAgYXN5bmM6IHRydWVcbiAgICB9KTtcbiAgfVxuXG4gIHZhciBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Zvcm0nKTtcblxuICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChfaTIpIHtcbiAgICBmb3Jtc1tfaTJdLm9uc3VibWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBmb3Jtc1tfaTJdLmNsYXNzTGlzdC5hZGQoJ3NpZ25lZCcpO1xuICAgIH07XG4gIH07XG5cbiAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgZm9ybXMubGVuZ3RoOyBfaTIrKykge1xuICAgIF9sb29wKF9pMik7XG4gIH1cblxuICB2YXIgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI25hdi1tYWluJyk7XG4gIHZhciB0b3BPZk5hdiA9IG5hdi5vZmZzZXRUb3A7XG5cbiAgZnVuY3Rpb24gZml4TmF2KCkge1xuICAgIGlmICh3aW5kb3cuc2Nyb2xsWSA+PSB0b3BPZk5hdikge1xuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5wYWRkaW5nVG9wID0gbmF2Lm9mZnNldEhlaWdodCArICdweCc7XG4gICAgICBuYXYuY2xhc3NMaXN0LmFkZCgnZml4ZWQtbmF2Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZC1uYXYnKTtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUucGFkZGluZ1RvcCA9IDA7XG4gICAgfVxuICB9XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGZpeE5hdik7XG59KTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGJhY2tUb3AgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdqcy1jZC10b3AnKVswXTtcbiAgdmFyIG9mZnNldCA9IDMwMDtcbiAgdmFyIG9mZnNldE9wYWNpdHkgPSAxMjAwO1xuICB2YXIgc2Nyb2xsRHVyYXRpb24gPSA3MDA7XG4gIHZhciBzY3JvbGxpbmcgPSBmYWxzZTtcblxuICBpZiAoYmFja1RvcCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKCFzY3JvbGxpbmcpIHtcbiAgICAgICAgc2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgIXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPyBzZXRUaW1lb3V0KGNoZWNrQmFja1RvVG9wLCAyNTApIDogd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShjaGVja0JhY2tUb1RvcCk7XG4gICAgICB9XG4gICAgfSk7IC8vc21vb3RoIHNjcm9sbCB0byB0b3BcblxuICAgIGJhY2tUb3AuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAhd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA/IHdpbmRvdy5zY3JvbGxUbygwLCAwKSA6IHNjcm9sbFRvcChzY3JvbGxEdXJhdGlvbik7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0JhY2tUb1RvcCgpIHtcbiAgICB2YXIgd2luZG93VG9wID0gd2luZG93LnNjcm9sbFkgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcDtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXQgPyBhZGRDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JykgOiByZW1vdmVDbGFzcyhiYWNrVG9wLCAnY2QtdG9wLS1zaG93JywgJ2NkLXRvcC0tZmFkZS1vdXQnKTtcbiAgICB3aW5kb3dUb3AgPiBvZmZzZXRPcGFjaXR5ICYmIGFkZENsYXNzKGJhY2tUb3AsICdjZC10b3AtLWZhZGUtb3V0Jyk7XG4gICAgc2Nyb2xsaW5nID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxUb3AoZHVyYXRpb24pIHtcbiAgICB2YXIgc3RhcnQgPSB3aW5kb3cuc2Nyb2xsWSB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIHZhciBjdXJyZW50VGltZSA9IG51bGw7XG5cbiAgICB2YXIgYW5pbWF0ZVNjcm9sbCA9IGZ1bmN0aW9uIGFuaW1hdGVTY3JvbGwodGltZXN0YW1wKSB7XG4gICAgICBpZiAoIWN1cnJlbnRUaW1lKSBjdXJyZW50VGltZSA9IHRpbWVzdGFtcDtcbiAgICAgIHZhciBwcm9ncmVzcyA9IHRpbWVzdGFtcCAtIGN1cnJlbnRUaW1lO1xuICAgICAgdmFyIHZhbCA9IE1hdGgubWF4KE1hdGguZWFzZUluT3V0UXVhZChwcm9ncmVzcywgc3RhcnQsIC1zdGFydCwgZHVyYXRpb24pLCAwKTtcbiAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCB2YWwpO1xuXG4gICAgICBpZiAocHJvZ3Jlc3MgPCBkdXJhdGlvbikge1xuICAgICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGVTY3JvbGwpO1xuICB9XG5cbiAgTWF0aC5lYXNlSW5PdXRRdWFkID0gZnVuY3Rpb24gKHQsIGIsIGMsIGQpIHtcbiAgICB0IC89IGQgLyAyO1xuICAgIGlmICh0IDwgMSkgcmV0dXJuIGMgLyAyICogdCAqIHQgKyBiO1xuICAgIHQtLTtcbiAgICByZXR1cm4gLWMgLyAyICogKHQgKiAodCAtIDIpIC0gMSkgKyBiO1xuICB9OyAvL2NsYXNzIG1hbmlwdWxhdGlvbnMgLSBuZWVkZWQgaWYgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWRcblxuXG4gIGZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSByZXR1cm4gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzTmFtZSk7ZWxzZSByZXR1cm4gISFlbC5jbGFzc05hbWUubWF0Y2gobmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc05hbWUsIFwiKFxcXFxzfCQpXCIpKSk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRDbGFzcyhlbCwgY2xhc3NOYW1lKSB7XG4gICAgdmFyIGNsYXNzTGlzdCA9IGNsYXNzTmFtZS5zcGxpdCgnICcpO1xuICAgIGlmIChlbC5jbGFzc0xpc3QpIGVsLmNsYXNzTGlzdC5hZGQoY2xhc3NMaXN0WzBdKTtlbHNlIGlmICghaGFzQ2xhc3MoZWwsIGNsYXNzTGlzdFswXSkpIGVsLmNsYXNzTmFtZSArPSBcIiBcIi5jb25jYXQoY2xhc3NMaXN0WzBdKTtcbiAgICBpZiAoY2xhc3NMaXN0Lmxlbmd0aCA+IDEpIGFkZENsYXNzKGVsLCBjbGFzc0xpc3Quc2xpY2UoMSkuam9pbignICcpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsYXNzKGVsLCBjbGFzc05hbWUpIHtcbiAgICB2YXIgY2xhc3NMaXN0ID0gY2xhc3NOYW1lLnNwbGl0KCcgJyk7XG4gICAgaWYgKGVsLmNsYXNzTGlzdCkgZWwuY2xhc3NMaXN0LnJlbW92ZShjbGFzc0xpc3RbMF0pO2Vsc2UgaWYgKGhhc0NsYXNzKGVsLCBjbGFzc0xpc3RbMF0pKSB7XG4gICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChcIihcXFxcc3xeKVwiLmNvbmNhdChjbGFzc0xpc3RbMF0sIFwiKFxcXFxzfCQpXCIpKTtcbiAgICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKHJlZywgJyAnKTtcbiAgICB9XG4gICAgaWYgKGNsYXNzTGlzdC5sZW5ndGggPiAxKSByZW1vdmVDbGFzcyhlbCwgY2xhc3NMaXN0LnNsaWNlKDEpLmpvaW4oJyAnKSk7XG4gIH1cbn0pKCk7Il19
